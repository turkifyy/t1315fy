<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة السنافر - مشاهدة المسلسلات والأفلام</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Slick Carousel -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">
    <style>
        /* متغيرات التصميم */
        :root {
            --primary-color: #E50914;
            --dark-color: #141414;
            --light-color: #f4f4f4;
            --secondary-color: #6D6D6D;
            --ad-color: #FFA500;
            --navbar-height: 70px;
            --transition-speed: 0.3s;
        }

        /* إعادة تعيين الأنماط */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--dark-color);
            color: var(--light-color);
            line-height: 1.6;
            padding-top: var(--navbar-height);
            transition: all var(--transition-speed);
        }

        /* شريط التنقل العلوي */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--navbar-height);
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .navbar-container {
            width: 100%;
            max-width: 1600px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-img {
            height: 40px;
            width: auto;
            transition: transform var(--transition-speed);
        }

        .logo-img:hover {
            transform: scale(1.05);
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            margin: 0 15px;
            position: relative;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            transition: color var(--transition-speed);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color);
        }

        .nav-link i {
            font-size: 0.9em;
        }

        .search-box {
            display: flex;
            align-items: center;
            position: relative;
            margin-left: 20px;
        }

        .search-box input {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            width: 200px;
            transition: width var(--transition-speed);
            font-size: 0.9rem;
        }

        .search-box input:focus {
            width: 300px;
            outline: none;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .search-box button {
            background: none;
            border: none;
            color: white;
            margin-right: -35px;
            z-index: 1;
            cursor: pointer;
            transition: color var(--transition-speed);
        }

        .search-box button:hover {
            color: var(--primary-color);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        .auth-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .auth-btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .auth-btn.secondary {
            background-color: transparent;
            border: 1px solid var(--primary-color);
        }

        /* أقسام الصفحة */
        .page {
            display: none;
            padding: 20px 0;
            min-height: calc(100vh - var(--navbar-height));
        }

        .page.active {
            display: block;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* قسم البطل (Hero Slider) */
        .hero-slider {
            width: 100%;
            height: 70vh;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .slider-container {
            width: 100%;
            height: 100%;
        }

        .slider-item {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex !important;
            align-items: center;
            padding: 0 60px;
        }

        .slider-content {
            max-width: 600px;
            z-index: 2;
            position: relative;
        }

        .slider-title {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: 700;
        }

        .slider-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            line-height: 1.5;
        }

        .slider-rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: #FFD700;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .slider-play-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-speed);
            font-weight: 600;
        }

        .slider-play-btn:hover {
            background-color: #f40612;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
        }

        .slider-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.2) 100%);
            z-index: 1;
        }

        /* مشغل الفيديو */
        .player-section {
            width: 100%;
            background-color: #000;
            position: relative;
            display: none;
        }

        .video-container {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* نسبة 16:9 */
            position: relative;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* الإعلانات */
        .ad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: none;
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .ad-content {
            width: 100%;
            height: 100%;
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .ad-skip {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 30;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            border: none;
            transition: all var(--transition-speed);
        }

        .ad-skip:hover {
            background-color: rgba(0, 0, 0, 0.9);
        }

        .ad-countdown {
            position: absolute;
            bottom: 20px;
            left: 120px;
            color: white;
            font-size: 0.9rem;
        }

        .channel-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            height: 50px;
            width: auto;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-radius: 5px;
        }

        /* إعلان شريطي */
        .banner-ad {
            width: 100%;
            height: 90px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        /* معلومات التشغيل الحالي */
        .now-playing-info {
            padding: 20px 40px;
            background-color: rgba(20, 20, 20, 0.9);
            border-bottom: 1px solid #333;
            display: none;
        }

        .now-playing-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .imdb-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-weight: bold;
        }

        .now-playing-meta {
            display: flex;
            gap: 15px;
            color: var(--secondary-color);
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .episode-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: 1.2rem;
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .stat:hover {
            color: var(--primary-color);
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* أقسام المحتوى */
        .section {
            padding: 40px 0;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-tabs {
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .tab-btn:hover, .tab-btn.active {
            background-color: var(--primary-color);
        }

        /* شبكات المحتوى */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .content-card {
            position: relative;
            cursor: pointer;
            transition: transform var(--transition-speed);
            border-radius: 5px;
            overflow: hidden;
            background-color: #222;
        }

        .content-card:hover {
            transform: scale(1.05);
            z-index: 2;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .content-thumbnail {
            width: 100%;
            height: 0;
            padding-bottom: 150%;
            background-color: #333;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .episode-thumbnail {
            padding-bottom: 56.25%; /* نسبة 16:9 للحلقات */
        }

        .content-info {
            padding: 15px 10px;
            background-color: rgba(20, 20, 20, 0.9);
        }

        .content-title {
            font-size: 1rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: bold;
        }

        .content-meta {
            font-size: 0.8rem;
            color: var(--secondary-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .content-stats {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--secondary-color);
        }

        .progress-container {
            width: 100%;
            height: 3px;
            background-color: #444;
            margin-top: 8px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
        }

        .episode-number {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid var(--primary-color);
        }

        .free-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* لوحة الإدارة */
        .admin-panel {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 30px;
            margin: 20px;
            border-radius: 10px;
            display: none;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
            overflow-y: auto;
            max-height: 90vh;
            position: fixed;
            top: var(--navbar-height);
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .admin-tab {
            background: none;
            border: none;
            color: white;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 4px;
            transition: all var(--transition-speed);
        }

        .admin-tab:hover, .admin-tab.active {
            background-color: var(--primary-color);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .admin-label {
            font-size: 0.9rem;
            color: #ccc;
        }

        .admin-input {
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
            transition: all var(--transition-speed);
        }

        .admin-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .admin-select {
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
        }

        .admin-textarea {
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
        }

        .admin-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity var(--transition-speed);
            font-size: 1rem;
            margin-top: 10px;
        }

        .admin-btn:hover {
            opacity: 0.9;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
        }

        .stat-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .stat-details {
            font-size: 0.9rem;
            color: #ccc;
        }

        .content-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .content-list-item {
            background-color: #444;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color var(--transition-speed);
        }

        .content-list-item:hover {
            background-color: #555;
        }

        .content-list-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .content-list-meta {
            font-size: 0.8rem;
            color: #aaa;
        }

        /* زر تبديل الإدارة */
        .admin-toggle {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            transition: transform var(--transition-speed);
        }

        .admin-toggle:hover {
            transform: scale(1.1);
        }

        /* رسائل التحميل والأخطاء */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 2000;
            display: none;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        /* صفحة الملف الشخصي */
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .profile-email {
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 30px;
        }

        .profile-stat {
            background-color: #222;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .profile-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        .watch-history {
            width: 100%;
            max-width: 1000px;
        }

        /* تصميم متجاوب */
        @media (max-width: 1200px) {
            .content-grid, .episodes-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .slider-title {
                font-size: 2.5rem;
            }
        }
        
        @media (max-width: 992px) {
            .navbar-container {
                flex-wrap: wrap;
                height: auto;
                padding: 10px;
            }
            
            .nav-menu {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
            
            .search-box {
                order: 2;
                width: 100%;
                margin: 10px 0;
            }
            
            .section, .now-playing-info {
                padding: 30px 20px;
            }
            
            .now-playing-title {
                font-size: 1.5rem;
            }
            
            .slider-title {
                font-size: 2rem;
            }
            
            .slider-description {
                font-size: 1rem;
            }
            
            .admin-panel {
                padding: 20px 15px;
                margin: 15px;
            }
            
            .admin-toggle {
                width: 50px;
                height: 50px;
                bottom: 20px;
                left: 20px;
            }
            
            .search-box input {
                width: 100%;
            }
            
            .search-box input:focus {
                width: 100%;
            }
            
            .slider-item {
                padding: 0 30px;
            }
        }
        
        @media (max-width: 768px) {
            .content-grid, .episodes-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .logo-img {
                height: 30px;
            }
            
            .channel-logo {
                height: 40px;
                top: 15px;
                right: 15px;
            }
            
            .now-playing-title {
                font-size: 1.3rem;
            }
            
            .now-playing-meta {
                flex-direction: column;
                gap: 5px;
                font-size: 0.9rem;
            }
            
            .section-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .ad-skip {
                bottom: 10px;
                left: 10px;
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .ad-countdown {
                bottom: 10px;
                left: 90px;
                font-size: 0.8rem;
            }
            
            .stat {
                font-size: 1rem;
                padding: 8px 10px;
            }
            
            .slider-item {
                padding: 0 20px;
            }
            
            .slider-title {
                font-size: 1.5rem;
            }
            
            .slider-description {
                display: none;
            }
            
            .slider-play-btn {
                padding: 10px 15px;
                font-size: 1rem;
            }

            .profile-stats {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .content-grid, .episodes-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .logo-container {
                width: 100%;
                justify-content: center;
            }
            
            .search-box {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
            
            .auth-buttons {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
                justify-content: center;
            }
        }

        /* وضع النهار (تجريبي) */
        body.light-mode {
            background-color: #f5f5f5;
            color: #333;
        }

        body.light-mode .navbar {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body.light-mode .nav-link {
            color: #333;
        }

        body.light-mode .content-info,
        body.light-mode .content-list-item,
        body.light-mode .stat-card {
            background-color: #fff;
            color: #333;
        }

        body.light-mode .content-title,
        body.light-mode .content-list-title {
            color: #333;
        }
    </style>
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo-container">
                <img src="https://via.placeholder.com/150x50?text=SMURFS+LOGO" alt="سنافر" class="logo-img" loading="lazy">
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i> الصفحة الرئيسية</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="series"><i class="fas fa-tv"></i> المسلسلات</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="movies"><i class="fas fa-film"></i> الأفلام</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="profile"><i class="fas fa-user"></i> الملف الشخصي</a></li>
            </ul>
            
            <div class="search-box">
                <input type="text" placeholder="ابحث عن مسلسل أو فيلم...">
                <button><i class="fas fa-search"></i></button>
            </div>
            
            <div class="auth-buttons">
                <button id="signInButton" class="auth-btn"><i class="fas fa-sign-in-alt"></i> تسجيل الدخول</button>
                <button id="signOutButton" class="auth-btn" style="display:none;"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
            </div>
        </div>
    </nav>

    <!-- الصفحة الرئيسية -->
    <div id="home-page" class="page active">
        <!-- شريط البطل -->
        <section class="hero-slider" id="heroSlider">
            <div class="slider-container" id="sliderContainer">
                <!-- سيتم تحميل العناصر ديناميكيًا -->
            </div>
        </section>
        
        <!-- قسم المسلسلات -->
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>أحدث المسلسلات</span>
                </h3>
                <div class="content-grid" id="seriesGrid">
                    <!-- سيتم تحميل المسلسلات ديناميكيًا -->
                </div>
            </div>
        </section>
        
        <!-- قسم الأفلام -->
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>أحدث الأفلام</span>
                </h3>
                <div class="content-grid" id="moviesGrid">
                    <!-- سيتم تحميل الأفلام ديناميكيًا -->
                </div>
            </div>
        </section>
    </div>

    <!-- صفحة المسلسلات -->
    <div id="series-page" class="page">
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>جميع المسلسلات</span>
                </h3>
                <div class="content-grid" id="allSeriesGrid">
                    <!-- سيتم تحميل جميع المسلسلات ديناميكيًا -->
                </div>
            </div>
        </section>
    </div>

    <!-- صفحة الأفلام -->
    <div id="movies-page" class="page">
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>جميع الأفلام</span>
                </h3>
                <div class="content-grid" id="allMoviesGrid">
                    <!-- سيتم تحميل جميع الأفلام ديناميكيًا -->
                </div>
            </div>
        </section>
    </div>

    <!-- صفحة الملف الشخصي -->
    <div id="profile-page" class="page">
        <div class="container profile-container">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="profile-name" id="profileName">زائر</h2>
            <p class="profile-email" id="profileEmail">يجب تسجيل الدخول لعرض المعلومات</p>
            
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="watchedCount">0</div>
                    <div class="profile-stat-label">مشاهدة</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="favoritesCount">0</div>
                    <div class="profile-stat-label">المفضلة</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="watchlistCount">0</div>
                    <div class="profile-stat-label">قائمة المشاهدة</div>
                </div>
            </div>
            
            <div class="watch-history">
                <h3 class="section-title">
                    <span>سجل المشاهدة</span>
                </h3>
                <div class="content-grid" id="watchHistoryGrid">
                    <!-- سيتم تحميل سجل المشاهدة ديناميكيًا -->
                </div>
            </div>
        </div>
    </div>

    <!-- مشغل الفيديو -->
    <section class="player-section" id="playerSection">
        <!-- إعلان ما قبل التشغيل -->
        <div class="ad-overlay" id="adOverlay">
            <div class="ad-content" id="adContent">
                <button class="ad-skip" id="adSkip">
                    <i class="fas fa-forward"></i> تخطي الإعلان
                </button>
                <div class="ad-countdown" id="adCountdown">الإعلان ينتهي بعد 5 ثواني</div>
            </div>
        </div>
        
        <div class="video-container">
            <iframe id="videoPlayer" src="" allowfullscreen></iframe>
            <img src="https://via.placeholder.com/100x50?text=قناة+السنافر" alt="قناة السنافر" class="channel-logo" loading="lazy">
        </div>
    </section>

    <!-- معلومات التشغيل الحالي -->
    <div class="now-playing-info" id="nowPlayingInfo">
        <h2 class="now-playing-title" id="nowPlayingTitle">
            <span id="nowPlayingTitleText">اختر حلقة للمشاهدة</span>
            <span class="badge">Free</span>
            <span class="imdb-rating">
                <i class="fas fa-star"></i>
                <span id="imdbRating">7.5</span>
            </span>
        </h2>
        <div class="now-playing-meta">
            <span id="nowPlayingNumber"></span>
            <span id="nowPlayingDuration"></span>
        </div>
        <div class="episode-stats">
            <div class="stat" id="viewsStat">
                <i class="fas fa-eye"></i>
                <span id="viewsCount">0</span> مشاهدة
            </div>
            <div class="stat" id="likesStat">
                <i class="fas fa-thumbs-up"></i>
                <span id="likesCount">0</span>
            </div>
            <div class="stat" id="dislikesStat">
                <i class="fas fa-thumbs-down"></i>
                <span id="dislikesCount">0</span>
            </div>
        </div>
    </div>

    <!-- لوحة الإدارة -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="series">إدارة المسلسلات</button>
            <button class="admin-tab" data-tab="episodes">إدارة الحلقات</button>
            <button class="admin-tab" data-tab="movies">إدارة الأفلام</button>
            <button class="admin-tab" data-tab="ads">إدارة الإعلانات</button>
            <button class="admin-tab" data-tab="stats">الإحصائيات</button>
            <button class="admin-tab" data-tab="visitors">إحصائيات الزوار</button>
            <button class="admin-tab" data-tab="settings">الإعدادات</button>
        </div>
        
        <!-- تبويب إدارة المسلسلات -->
        <div class="admin-tab-content active" id="seriesTab">
            <h3 class="admin-title">إدارة المسلسلات</h3>
            <button id="addSeriesBtn" class="admin-btn">+ إضافة مسلسل جديد</button>
            
            <div id="seriesForm" style="display: none; margin-top: 20px;">
                <div class="admin-controls">
                    <div class="admin-group">
                        <label class="admin-label">اسم المسلسل:</label>
                        <input type="text" id="seriesTitle" class="admin-input" placeholder="اسم المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">قصة المسلسل:</label>
                        <textarea id="seriesDescription" class="admin-textarea" placeholder="قصة المسلسل..."></textarea>
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">صورة المصغرة:</label>
                        <input type="text" id="seriesThumb" class="admin-input" placeholder="رابط الصورة المصغرة...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">تقييم المسلسل:</label>
                        <input type="number" id="seriesRating" class="admin-input" placeholder="تقييم المسلسل..." min="0" max="10" step="0.1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">نوع المسلسل:</label>
                        <input type="text" id="seriesGenre" class="admin-input" placeholder="نوع المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">عدد الحلقات:</label>
                        <input type="number" id="seriesEpisodes" class="admin-input" placeholder="عدد الحلقات..." min="1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">لغة المسلسل:</label>
                        <input type="text" id="seriesLanguage" class="admin-input" placeholder="لغة المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">دولة المسلسل:</label>
                        <input type="text" id="seriesCountry" class="admin-input" placeholder="دولة المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">رقم الموسم:</label>
                        <input type="number" id="seriesSeason" class="admin-input" placeholder="رقم الموسم..." min="1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">حالة المسلسل:</label>
                        <select id="seriesStatus" class="admin-select">
                            <option value="new">جديد</option>
                            <option value="exclusive">حصري</option>
                            <option value="regular">عادي</option>
                        </select>
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">مميز:</label>
                        <select id="seriesFeatured" class="admin-select">
                            <option value="false">لا</option>
                            <option value="true">نعم</option>
                        </select>
                    </div>
                </div>
                <div class="btn-group">
                    <button id="saveSeries" class="admin-btn">حفظ المسلسل</button>
                    <button id="cancelSeries" class="admin-btn" style="background-color: #666;">إلغاء</button>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">قائمة المسلسلات</div>
            <div class="content-list" id="seriesList">
                <!-- سيتم تحميل قائمة المسلسلات ديناميكيًا -->
            </div>
        </div>
        
        <!-- تبويب إدارة الحلقات -->
        <div class="admin-tab-content" id="episodesTab">
            <h3 class="admin-title">إدارة الحلقات</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">اختر مسلسل:</label>
                    <select id="episodeSeries" class="admin-select">
                        <option value="">اختر مسلسل...</option>
                        <!-- سيتم تحميل خيارات المسلسلات ديناميكيًا -->
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">رقم الحلقة:</label>
                    <input type="number" id="episodeNumber" class="admin-input" placeholder="رقم الحلقة..." min="1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">عنوان الحلقة:</label>
                    <input type="text" id="episodeTitle" class="admin-input" placeholder="عنوان الحلقة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">رابط الحلقة:</label>
                    <input type="text" id="episodeUrl" class="admin-input" placeholder="رابط الحلقة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">رابط الصورة المصغرة:</label>
                    <input type="text" id="episodeThumb" class="admin-input" placeholder="رابط الصورة المصغرة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة الحلقة (دقائق):</label>
                    <input type="number" id="episodeDuration" class="admin-input" placeholder="مدة الحلقة..." min="1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تقييم IMDB:</label>
                    <input type="number" id="episodeImdb" class="admin-input" placeholder="تقييم IMDB..." min="0" max="10" step="0.1">
                </div>
            </div>
            <div class="btn-group">
                <button id="saveEpisode" class="admin-btn">حفظ الحلقة</button>
                <button id="closeAdmin" class="admin-btn" style="background-color: #666;">إغلاق اللوحة</button>
            </div>
        </div>
        
        <!-- تبويب إدارة الأفلام -->
        <div class="admin-tab-content" id="moviesTab">
            <h3 class="admin-title">إدارة الأفلام</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">عنوان الفيلم:</label>
                    <input type="text" id="movieTitle" class="admin-input" placeholder="عنوان الفيلم...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">قصة الفيلم:</label>
                    <textarea id="movieDescription" class="admin-textarea" placeholder="قصة الفيلم..."></textarea>
                </div>
                <div class="admin-group">
                    <label class="admin-label">رابط الفيلم:</label>
                    <input type="text" id="movieUrl" class="admin-input" placeholder="رابط الفيلم...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">رابط الصورة المصغرة:</label>
                    <input type="text" id="movieThumb" class="admin-input" placeholder="رابط الصورة المصغرة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة الفيلم (دقائق):</label>
                    <input type="number" id="movieDuration" class="admin-input" placeholder="مدة الفيلم..." min="1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تقييم IMDB:</label>
                    <input type="number" id="movieImdb" class="admin-input" placeholder="تقييم IMDB..." min="0" max="10" step="0.1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">مميز:</label>
                    <select id="movieFeatured" class="admin-select">
                        <option value="false">لا</option>
                        <option value="true">نعم</option>
                    </select>
                </div>
            </div>
            <div class="btn-group">
                <button id="saveMovie" class="admin-btn">حفظ الفيلم</button>
            </div>
        </div>
        
        <!-- تبويب إدارة الإعلانات -->
        <div class="admin-tab-content" id="adsTab">
            <h3 class="admin-title">إدارة الإعلانات</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">مفتاح Adsterra:</label>
                    <input type="text" id="adsterraKey" class="admin-input" placeholder="أدخل مفتاح Adsterra...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة إعلان ما قبل التشغيل (ثواني):</label>
                    <input type="number" id="preRollDuration" class="admin-input" value="5" min="5">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تمكين الإعلانات في منتصف التشغيل:</label>
                    <select id="midRollEnabled" class="admin-select">
                        <option value="true">نعم</option>
                        <option value="false">لا</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة إعلان منتصف التشغيل (ثواني):</label>
                    <input type="number" id="midRollDuration" class="admin-input" value="10" min="5">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تمكين الإعلانات بعد التشغيل:</label>
                    <select id="postRollEnabled" class="admin-select">
                        <option value="true">نعم</option>
                        <option value="false">لا</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة إعلان بعد التشغيل (ثواني):</label>
                    <input type="number" id="postRollDuration" class="admin-input" value="10" min="5">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تمكين الإعلان الشريطي:</label>
                    <select id="bannerAdEnabled" class="admin-select">
                        <option value="true">نعم</option>
                        <option value="false">لا</option>
                    </select>
                </div>
            </div>
            <div class="btn-group">
                <button id="saveAdsSettings" class="admin-btn">حفظ إعدادات الإعلانات</button>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">إحصائيات الإعلانات</div>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">إجمالي عائد الإعلانات</div>
                    <div class="stat-value">$<span id="totalAdRevenue">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إعلانات ما قبل التشغيل</div>
                    <div class="stat-value"><span id="preRollCount">0</span> مشاهدة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إعلانات منتصف التشغيل</div>
                    <div class="stat-value"><span id="midRollCount">0</span> مشاهدة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إعلانات بعد التشغيل</div>
                    <div class="stat-value"><span id="postRollCount">0</span> مشاهدة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">الإعلانات الشريطية</div>
                    <div class="stat-value"><span id="bannerAdCount">0</span> ظهور</div>
                </div>
            </div>
        </div>
        
        <!-- تبويب الإحصائيات -->
        <div class="admin-tab-content" id="statsTab">
            <h3 class="admin-title">إحصائيات المشاهدات</h3>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">إجمالي المشاهدات</div>
                    <div class="stat-value"><span id="totalViews">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إجمالي الإعجابات</div>
                    <div class="stat-value"><span id="totalLikes">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إجمالي عدم الإعجاب</div>
                    <div class="stat-value"><span id="totalDislikes">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">الحلقات الأكثر مشاهدة</div>
                    <div class="stat-value"><span id="topEpisode">-</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">الأفلام الأكثر مشاهدة</div>
                    <div class="stat-value"><span id="topMovie">-</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">متوسط وقت المشاهدة</div>
                    <div class="stat-value"><span id="avgWatchTime">0</span> دقيقة</div>
                </div>
            </div>
        </div>
        
        <!-- تبويب إحصائيات الزوار -->
        <div class="admin-tab-content" id="visitorsTab">
            <h3 class="admin-title">إحصائيات الزوار</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">الفترة الزمنية:</label>
                    <select id="visitorsTimeRange" class="admin-select">
                        <option value="day">اليوم</option>
                        <option value="week">الأسبوع</option>
                        <option value="month">الشهر</option>
                        <option value="year">السنة</option>
                    </select>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">إجمالي الزوار</div>
                    <div class="stat-value"><span id="totalVisitors">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">زوار جدد</div>
                    <div class="stat-value"><span id="newVisitors">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">زوار متكررون</div>
                    <div class="stat-value"><span id="returningVisitors">0</span></div>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">مصادر الزوار</div>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">فيسبوك</div>
                    <div class="stat-value"><span id="facebookVisitors">0</span></div>
                    <div class="stat-details"><span id="facebookPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">جوجل</div>
                    <div class="stat-value"><span id="googleVisitors">0</span></div>
                    <div class="stat-details"><span id="googlePercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">يوتيوب</div>
                    <div class="stat-value"><span id="youtubeVisitors">0</span></div>
                    <div class="stat-details"><span id="youtubePercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">تيك توك</div>
                    <div class="stat-value"><span id="tiktokVisitors">0</span></div>
                    <div class="stat-details"><span id="tiktokPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">انستغرام</div>
                    <div class="stat-value"><span id="instagramVisitors">0</span></div>
                    <div class="stat-details"><span id="instagramPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">مصادر أخرى</div>
                    <div class="stat-value"><span id="otherVisitors">0</span></div>
                    <div class="stat-details"><span id="otherPercentage">0%</span> من إجمالي الزوار</div>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">أجهزة الزوار</div>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">هواتف</div>
                    <div class="stat-value"><span id="mobileVisitors">0</span></div>
                    <div class="stat-details"><span id="mobilePercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">حواسيب</div>
                    <div class="stat-value"><span id="desktopVisitors">0</span></div>
                    <div class="stat-details"><span id="desktopPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">أجهزة لوحية</div>
                    <div class="stat-value"><span id="tabletVisitors">0</span></div>
                    <div class="stat-details"><span id="tabletPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">تلفزيونات</div>
                    <div class="stat-value"><span id="tvVisitors">0</span></div>
                    <div class="stat-details"><span id="tvPercentage">0%</span> من إجمالي الزوار</div>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">خريطة الزوار</div>
            <div id="visitorsMap" style="width: 100%; height: 400px; background-color: #333; border-radius: 5px; display: flex; justify-content: center; align-items: center; color: #ccc;">
                خريطة تفاعلية للزوار حسب البلدان
            </div>
        </div>
        
        <!-- تبويب الإعدادات -->
        <div class="admin-tab-content" id="settingsTab">
            <h3 class="admin-title">إعدادات النظام</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">عنوان الموقع:</label>
                    <input type="text" id="siteTitle" class="admin-input" placeholder="عنوان الموقع..." value="منصة السنافر">
                </div>
                <div class="admin-group">
                    <label class="admin-label">شعار الموقع:</label>
                    <input type="text" id="siteLogo" class="admin-input" placeholder="رابط الشعار..." value="https://via.placeholder.com/150x50?text=SMURFS+LOGO">
                </div>
                <div class="admin-group">
                    <label class="admin-label">شعار القناة:</label>
                    <input type="text" id="channelLogo" class="admin-input" placeholder="رابط شعار القناة..." value="https://via.placeholder.com/100x50?text=قناة+السنافر">
                </div>
                <div class="admin-group">
                    <label class="admin-label">لون الموقع الأساسي:</label>
                    <input type="color" id="primaryColor" class="admin-input" value="#E50914">
                </div>
                <div class="admin-group">
                    <label class="admin-label">وضع الموقع:</label>
                    <select id="siteMode" class="admin-select">
                        <option value="light">فاتح</option>
                        <option value="dark" selected>داكن</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">كلمة مرور الأدمن:</label>
                    <input type="password" id="adminPassword" class="admin-input" placeholder="كلمة مرور الأدمن..." value="password">
                </div>
            </div>
            <div class="btn-group">
                <button id="saveSettings" class="admin-btn">حفظ الإعدادات</button>
            </div>
        </div>
    </div>
    
    <!-- زر تبديل الإدارة -->
    <div class="admin-toggle" id="adminToggle">
        <i class="fas fa-cog"></i>
    </div>

    <!-- رسائل التحميل والأخطاء -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <div class="error-message" id="errorMessage"></div>

    <!-- مكتبات JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
    
    <!-- تهيئة Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <script>
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تهيئة Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyYOUR_API_KEY",
                authDomain: "your-project.firebaseapp.com",
                projectId: "your-project",
                storageBucket: "your-project.appspot.com",
                messagingSenderId: "1234567890",
                appId: "1:1234567890:web:abcdef1234567890"
            };
            
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            
            // كائنات Firebase
            const auth = firebase.auth();
            const db = firebase.firestore();
            
            // إعدادات التطبيق
            const APP_CONFIG = {
                ADMIN_PASSWORD_HASH: "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8", // sha256 لـ "password"
                DEFAULT_LANGUAGE: "ar",
                SUPPORTED_LANGUAGES: ["ar", "en"],
                ADSTERRA_KEY: "", // سيتم جلبها من Firestore
                ADS_ENABLED: true
            };
            
            // حالة التطبيق
            const appState = {
                currentUser: null,
                series: [],
                episodes: [],
                movies: [],
                watchProgress: {},
                currentContent: null,
                isShowingAd: false
            };
            
            // عناصر DOM
            const elements = {
                // شريط التنقل
                navLinks: document.querySelectorAll('.nav-link'),
                signInButton: document.getElementById('signInButton'),
                signOutButton: document.getElementById('signOutButton'),
                
                // الصفحات
                pages: {
                    home: document.getElementById('home-page'),
                    series: document.getElementById('series-page'),
                    movies: document.getElementById('movies-page'),
                    profile: document.getElementById('profile-page')
                },
                
                // مشغل الفيديو
                playerSection: document.getElementById('playerSection'),
                videoPlayer: document.getElementById('videoPlayer'),
                nowPlayingInfo: document.getElementById('nowPlayingInfo'),
                nowPlayingTitle: document.getElementById('nowPlayingTitleText'),
                nowPlayingNumber: document.getElementById('nowPlayingNumber'),
                nowPlayingDuration: document.getElementById('nowPlayingDuration'),
                viewsCount: document.getElementById('viewsCount'),
                likesCount: document.getElementById('likesCount'),
                dislikesCount: document.getElementById('dislikesCount'),
                imdbRating: document.getElementById('imdbRating'),
                
                // الإعلانات
                adOverlay: document.getElementById('adOverlay'),
                adContent: document.getElementById('adContent'),
                adSkip: document.getElementById('adSkip'),
                adCountdown: document.getElementById('adCountdown'),
                
                // شريط البطل
                heroSlider: document.getElementById('heroSlider'),
                sliderContainer: document.getElementById('sliderContainer'),
                
                // الشبكات
                seriesGrid: document.getElementById('seriesGrid'),
                moviesGrid: document.getElementById('moviesGrid'),
                allSeriesGrid: document.getElementById('allSeriesGrid'),
                allMoviesGrid: document.getElementById('allMoviesGrid'),
                watchHistoryGrid: document.getElementById('watchHistoryGrid'),
                
                // الملف الشخصي
                profileName: document.getElementById('profileName'),
                profileEmail: document.getElementById('profileEmail'),
                watchedCount: document.getElementById('watchedCount'),
                favoritesCount: document.getElementById('favoritesCount'),
                watchlistCount: document.getElementById('watchlistCount'),
                
                // لوحة الإدارة
                adminPanel: document.getElementById('adminPanel'),
                adminToggle: document.getElementById('adminToggle'),
                
                // التحميل والأخطاء
                loadingOverlay: document.getElementById('loadingOverlay'),
                errorMessage: document.getElementById('errorMessage')
            };
            
            // تهيئة التطبيق
            initApp();
            
            // وظائف التطبيق الرئيسية
            function initApp() {
                // إعداد مستمعي الأحداث
                setupEventListeners();
                
                // مراقبة حالة المصادقة
                auth.onAuthStateChanged(user => {
                    if (user) {
                        // المستخدم مسجل الدخول
                        appState.currentUser = user;
                        elements.signInButton.style.display = 'none';
                        elements.signOutButton.style.display = 'block';
                        updateUserProfile(user);
                        loadUserData(user.uid);
                    } else {
                        // لا يوجد مستخدم مسجل
                        appState.currentUser = null;
                        elements.signInButton.style.display = 'block';
                        elements.signOutButton.style.display = 'none';
                        resetUserProfile();
                    }
                });
                
                // تحميل البيانات الأولية
                loadInitialData();
            }
            
            function setupEventListeners() {
                // شريط التنقل
                elements.navLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const page = this.dataset.page;
                        showPage(page);
                    });
                });
                
                // تسجيل الدخول والخروج
                elements.signInButton.addEventListener('click', signInWithGoogle);
                elements.signOutButton.addEventListener('click', signOut);
                
                // لوحة الإدارة
                elements.adminToggle.addEventListener('click', toggleAdminPanel);
                
                // البحث
                document.querySelector('.search-box input').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchContent(this.value);
                    }
                });
                
                document.querySelector('.search-box button').addEventListener('click', function() {
                    const query = document.querySelector('.search-box input').value;
                    searchContent(query);
                });
            }
            
            function showPage(page) {
                // إخفاء جميع الصفحات
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                
                // إزالة التنشيط من جميع روابط التنقل
                elements.navLinks.forEach(link => {
                    link.classList.remove('active');
                });
                
                // تنشيط الصفحة المطلوبة
                if (elements.pages[page]) {
                    elements.pages[page].classList.add('active');
                    document.querySelector(`.nav-link[data-page="${page}"]`).classList.add('active');
                    
                    // تحميل محتوى الصفحة إذا لزم الأمر
                    if (page === 'series') {
                        renderSeriesGrid(appState.series, elements.allSeriesGrid);
                    } else if (page === 'movies') {
                        renderMoviesGrid(appState.movies, elements.allMoviesGrid);
                    } else if (page === 'profile' && appState.currentUser) {
                        loadUserData(appState.currentUser.uid);
                    }
                }
            }
            
            function signInWithGoogle() {
                showLoading();
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .then(result => {
                        // تسجيل بيانات المستخدم في Firestore
                        return db.collection('users').doc(result.user.uid).set({
                            name: result.user.displayName,
                            email: result.user.email,
                            photoURL: result.user.photoURL,
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        }, { merge: true });
                    })
                    .then(() => {
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء تسجيل الدخول: ' + error.message);
                    });
            }
            
            function signOut() {
                showLoading();
                auth.signOut()
                    .then(() => {
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء تسجيل الخروج: ' + error.message);
                    });
            }
            
            function updateUserProfile(user) {
                elements.profileName.textContent = user.displayName || 'مستخدم';
                elements.profileEmail.textContent = user.email || '';
                
                // تحديث صورة المستخدم إذا كانت متوفرة
                if (user.photoURL) {
                    const avatar = document.querySelector('.profile-avatar');
                    avatar.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = user.photoURL;
                    img.alt = user.displayName || 'صورة المستخدم';
                    avatar.appendChild(img);
                }
                
                // تحديث رابط الملف الشخصي في شريط التنقل
                const profileLink = document.querySelector('.nav-link[data-page="profile"]');
                if (profileLink) {
                    profileLink.innerHTML = `<i class="fas fa-user"></i> ${user.displayName || 'الملف الشخصي'}`;
                }
            }
            
            function resetUserProfile() {
                elements.profileName.textContent = 'زائر';
                elements.profileEmail.textContent = 'يجب تسجيل الدخول لعرض المعلومات';
                document.querySelector('.profile-avatar').innerHTML = '<i class="fas fa-user"></i>';
                
                // إعادة تعيين رابط الملف الشخصي في شريط التنقل
                const profileLink = document.querySelector('.nav-link[data-page="profile"]');
                if (profileLink) {
                    profileLink.innerHTML = '<i class="fas fa-user"></i> الملف الشخصي';
                }
            }
            
            function loadUserData(userId) {
                showLoading();
                
                // جلب بيانات المستخدم من Firestore
                db.collection('users').doc(userId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            
                            // جلب سجل المشاهدة
                            return db.collection('users').doc(userId).collection('watchHistory')
                                .orderBy('timestamp', 'desc')
                                .limit(10)
                                .get();
                        }
                        return null;
                    })
                    .then(snapshot => {
                        if (snapshot) {
                            const watchHistory = [];
                            snapshot.forEach(doc => {
                                watchHistory.push(doc.data());
                            });
                            
                            // عرض سجل المشاهدة
                            renderWatchHistory(watchHistory);
                            
                            // تحديث الإحصائيات
                            elements.watchedCount.textContent = watchHistory.length;
                            // يمكنك إضافة المزيد من الإحصائيات هنا
                        }
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ في تحميل بيانات المستخدم: ' + error.message);
                    });
            }
            
            function loadInitialData() {
                showLoading();
                
                // جلب المسلسلات
                db.collection('series').where('featured', '==', true).limit(10).get()
                    .then(snapshot => {
                        appState.series = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        
                        // جلب الحلقات
                        return db.collection('episodes').limit(50).get();
                    })
                    .then(snapshot => {
                        appState.episodes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        
                        // جلب الأفلام
                        return db.collection('movies').where('featured', '==', true).limit(10).get();
                    })
                    .then(snapshot => {
                        appState.movies = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        
                        // عرض البيانات
                        renderHeroSlider([...appState.series.filter(s => s.isFeatured), ...appState.movies.filter(m => m.isFeatured)]);
                        renderSeriesGrid(appState.series, elements.seriesGrid);
                        renderMoviesGrid(appState.movies, elements.moviesGrid);
                        
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ في تحميل البيانات: ' + error.message);
                    });
            }
            
            function renderHeroSlider(items) {
                elements.sliderContainer.innerHTML = '';
                
                if (items.length === 0) {
                    elements.heroSlider.style.display = 'none';
                    return;
                }
                
                items.forEach(item => {
                    const sliderItem = document.createElement('div');
                    sliderItem.className = 'slider-item';
                    sliderItem.style.backgroundImage = `url('${item.thumb}')`;
                    
                    const sliderOverlay = document.createElement('div');
                    sliderOverlay.className = 'slider-overlay';
                    
                    const sliderContent = document.createElement('div');
                    sliderContent.className = 'slider-content';
                    
                    const sliderTitle = document.createElement('h2');
                    sliderTitle.className = 'slider-title';
                    sliderTitle.textContent = item.title;
                    
                    const sliderDescription = document.createElement('p');
                    sliderDescription.className = 'slider-description';
                    sliderDescription.textContent = item.description || 'محتوى مميز وجديد على المنصة';
                    
                    const sliderRating = document.createElement('div');
                    sliderRating.className = 'slider-rating';
                    sliderRating.innerHTML = `
                        <span>${item.rating || item.imdb || '7.5'}</span>
                        <i class="fas fa-star"></i>
                    `;
                    
                    const sliderPlayBtn = document.createElement('button');
                    sliderPlayBtn.className = 'slider-play-btn';
                    sliderPlayBtn.innerHTML = `
                        <i class="fas fa-play"></i>
                        <span>تشغيل</span>
                    `;
                    
                    sliderPlayBtn.addEventListener('click', function() {
                        if (item.number) {
                            // إنها حلقة
                            playEpisode(item);
                        } else if (item.seriesId) {
                            // إنها مسلسل - تشغيل الحلقة الأولى
                            const firstEpisode = appState.episodes.find(ep => ep.seriesId === item.id);
                            if (firstEpisode) {
                                playEpisode(firstEpisode);
                            }
                        } else {
                            // إنه فيلم
                            playMovie(item);
                        }
                    });
                    
                    sliderContent.appendChild(sliderTitle);
                    sliderContent.appendChild(sliderDescription);
                    sliderContent.appendChild(sliderRating);
                    sliderContent.appendChild(sliderPlayBtn);
                    sliderItem.appendChild(sliderOverlay);
                    sliderItem.appendChild(sliderContent);
                    elements.sliderContainer.appendChild(sliderItem);
                });
                
                // تهيئة Slick Slider
                $(elements.sliderContainer).slick({
                    dots: true,
                    infinite: true,
                    speed: 500,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    autoplay: true,
                    autoplaySpeed: 5000,
                    rtl: true
                });
                
                elements.heroSlider.style.display = 'block';
            }
            
            function renderSeriesGrid(series, gridElement = elements.seriesGrid) {
                gridElement.innerHTML = '';
                
                series.forEach(ser => {
                    const seriesCard = createContentCard(ser, 'series');
                    gridElement.appendChild(seriesCard);
                });
            }
            
            function renderMoviesGrid(movies, gridElement = elements.moviesGrid) {
                gridElement.innerHTML = '';
                
                movies.forEach(movie => {
                    const movieCard = createContentCard(movie, 'movie');
                    gridElement.appendChild(movieCard);
                });
            }
            
            function renderWatchHistory(items) {
                elements.watchHistoryGrid.innerHTML = '';
                
                items.forEach(item => {
                    const card = createContentCard(item, item.type || 'episode');
                    elements.watchHistoryGrid.appendChild(card);
                });
            }
            
            function createContentCard(item, type) {
                const card = document.createElement('div');
                card.className = 'content-card';
                card.dataset.id = item.id;
                card.dataset.type = type;
                
                const thumbnail = document.createElement('div');
                thumbnail.className = type === 'episode' ? 'episode-thumbnail' : 'content-thumbnail';
                thumbnail.style.backgroundImage = `url('${item.thumb}')`;
                
                const info = document.createElement('div');
                info.className = 'content-info';
                
                const title = document.createElement('div');
                title.className = 'content-title';
                title.textContent = item.title;
                
                const meta = document.createElement('div');
                meta.className = 'content-meta';
                
                if (type === 'episode') {
                    const episodeNum = document.createElement('div');
                    episodeNum.className = 'episode-number';
                    episodeNum.textContent = item.number;
                    thumbnail.appendChild(episodeNum);
                    
                    meta.innerHTML = `
                        <span>${item.duration || 24} دقيقة</span>
                        <span>•</span>
                        <span>${item.imdb || '7.5'} <i class="fas fa-star" style="color: #FFD700;"></i></span>
                    `;
                } else if (type === 'series') {
                    meta.innerHTML = `
                        <span>${item.rating || '7.5'} <i class="fas fa-star" style="color: #FFD700;"></i></span>
                        <span>•</span>
                        <span>${item.season || 1} موسم</span>
                    `;
                } else if (type === 'movie') {
                    meta.innerHTML = `
                        <span>${item.duration || 90} دقيقة</span>
                        <span>•</span>
                        <span>${item.imdb || '7.5'} <i class="fas fa-star" style="color: #FFD700;"></i></span>
                    `;
                }
                
                const freeBadge = document.createElement('div');
                freeBadge.className = 'free-badge';
                freeBadge.textContent = 'Free';
                thumbnail.appendChild(freeBadge);
                
                const stats = document.createElement('div');
                stats.className = 'content-stats';
                stats.innerHTML = `
                    <span><i class="fas fa-eye"></i> ${item.views || 0}</span>
                    <span><i class="fas fa-thumbs-up"></i> ${item.likes || 0}</span>
                `;
                
                // شريط التقدم
                const progressContainer = document.createElement('div');
                progressContainer.className = 'progress-container';
                
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.style.width = appState.watchProgress[item.id] ? `${appState.watchProgress[item.id].progress}%` : '0%';
                
                progressContainer.appendChild(progressBar);
                
                info.appendChild(title);
                info.appendChild(meta);
                info.appendChild(stats);
                info.appendChild(progressContainer);
                
                card.appendChild(thumbnail);
                card.appendChild(info);
                
                card.addEventListener('click', function() {
                    if (type === 'episode') {
                        playEpisode(item);
                    } else if (type === 'series') {
                        showSeriesEpisodes(item);
                    } else if (type === 'movie') {
                        playMovie(item);
                    }
                });
                
                return card;
            }
            
            function showSeriesEpisodes(series) {
                // جلب حلقات المسلسل
                const seriesEpisodes = appState.episodes.filter(ep => ep.seriesId === series.id);
                
                // تحديث واجهة المستخدم
                elements.pages.home.classList.remove('active');
                elements.pages.series.classList.add('active');
                
                // يمكنك إضافة منطق لعرض الحلقات هنا
                // ...
                
                // العودة إلى الصفحة الرئيسية
                document.querySelector('.nav-link[data-page="home"]').classList.add('active');
            }
            
            function playEpisode(episode) {
                // تحديث حالة التطبيق
                appState.currentContent = {
                    type: 'episode',
                    data: episode
                };
                
                // تحديث واجهة المستخدم
                updateNowPlayingInfo(episode);
                
                // إخفاء جميع الصفحات وإظهار المشغل
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                elements.playerSection.style.display = 'block';
                elements.heroSlider.style.display = 'none';
                
                // تشغيل الحلقة
                playContent(episode.url, episode);
                
                // حفظ سجل المشاهدة إذا كان المستخدم مسجل الدخول
                if (appState.currentUser) {
                    saveWatchHistory(episode, 'episode');
                }
            }
            
            function playMovie(movie) {
                // تحديث حالة التطبيق
                appState.currentContent = {
                    type: 'movie',
                    data: movie
                };
                
                // تحديث واجهة المستخدم
                updateNowPlayingInfo(movie);
                
                // إخفاء جميع الصفحات وإظهار المشغل
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                elements.playerSection.style.display = 'block';
                elements.heroSlider.style.display = 'none';
                
                // تشغيل الفيلم
                playContent(movie.url, movie);
                
                // حفظ سجل المشاهدة إذا كان المستخدم مسجل الدخول
                if (appState.currentUser) {
                    saveWatchHistory(movie, 'movie');
                }
            }
            
            function playContent(url, content) {
                // إعداد رابط الفيديو
                let videoUrl = url;
                const startTime = appState.watchProgress[content.id] ? Math.floor(appState.watchProgress[content.id].time) : 0;
                
                if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                    const videoId = extractYouTubeId(videoUrl);
                    if (videoId) {
                        videoUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&start=${startTime}`;
                    }
                } else if (videoUrl.includes('vimeo.com')) {
                    const videoId = videoUrl.split('/').pop();
                    videoUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
                }
                
                elements.videoPlayer.src = videoUrl;
                
                // بدء تتبع التقدم
                trackProgress(content);
            }
            
            function updateNowPlayingInfo(content) {
                elements.nowPlayingTitle.textContent = content.title;
                elements.nowPlayingNumber.textContent = content.number ? `الحلقة ${content.number}` : '';
                elements.nowPlayingDuration.textContent = content.duration ? `${content.duration} دقيقة` : '';
                elements.viewsCount.textContent = content.views || 0;
                elements.likesCount.textContent = content.likes || 0;
                elements.dislikesCount.textContent = content.dislikes || 0;
                elements.imdbRating.textContent = content.imdb || '7.5';
                
                elements.nowPlayingInfo.style.display = 'block';
                
                // إعداد أزرار التفاعل
                setupInteractionButtons(content);
            }
            
            function setupInteractionButtons(content) {
                elements.likesStat.onclick = function() {
                    content.likes = (content.likes || 0) + 1;
                    updateNowPlayingInfo(content);
                    saveContentInteraction(content, 'like');
                };
                
                elements.dislikesStat.onclick = function() {
                    content.dislikes = (content.dislikes || 0) + 1;
                    updateNowPlayingInfo(content);
                    saveContentInteraction(content, 'dislike');
                };
            }
            
            function trackProgress(content) {
                // في تطبيق حقيقي، ستحتاج إلى استخدام واجهة برمجة تطبيقات مشغل الفيديو
                // لتتبع التقدم الفعلي للمشاهدة
                
                // هذا مثال مبسط يستخدم مؤقتًا
                const duration = content.duration ? content.duration * 60 : 600; // تحويل الدقائق إلى ثواني
                let progress = appState.watchProgress[content.id]?.progress || 0;
                
                const progressInterval = setInterval(() => {
                    progress = Math.min(progress + 0.5, 100);
                    const currentTime = (progress / 100) * duration;
                    
                    appState.watchProgress[content.id] = {
                        progress: progress,
                        time: currentTime,
                        timestamp: new Date().getTime()
                    };
                    
                    // تحديث شريط التقدم
                    const selector = `[data-id="${content.id}"] .progress-bar`;
                    const progressBar = document.querySelector(selector);
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    // إظهار إعلان منتصف التشغيل إذا لزم الأمر
                    if (APP_CONFIG.ADS_ENABLED && progress >= 50 && progress < 55 && !content.midRollShown) {
                        showAd('mid-roll');
                        content.midRollShown = true;
                    }
                    
                    // إظهار إعلان نهاية التشغيل إذا لزم الأمر
                    if (APP_CONFIG.ADS_ENABLED && progress >= 95 && !content.postRollShown) {
                        showAd('post-roll');
                        content.postRollShown = true;
                        clearInterval(progressInterval);
                    }
                }, 3000);
            }
            
            function showAd(adType) {
                if (!APP_CONFIG.ADS_ENABLED) return;
                
                appState.isShowingAd = true;
                elements.adOverlay.style.display = 'flex';
                elements.adSkip.style.display = 'flex';
                
                let duration;
                if (adType === 'pre-roll') duration = 5;
                else if (adType === 'mid-roll') duration = 10;
                else if (adType === 'post-roll') duration = 10;
                
                elements.adCountdown.textContent = `الإعلان ينتهي بعد ${duration} ثواني`;
                
                let seconds = duration;
                const adTimer = setInterval(() => {
                    seconds--;
                    elements.adCountdown.textContent = `الإعلان ينتهي بعد ${seconds} ثواني`;
                    
                    if (seconds <= 0) {
                        clearInterval(adTimer);
                        hideAd();
                    }
                }, 1000);
                
                // زر تخطي الإعلان
                elements.adSkip.onclick = function() {
                    clearInterval(adTimer);
                    hideAd();
                };
                
                // تحميل الإعلان
                loadAd();
            }
            
            function hideAd() {
                appState.isShowingAd = false;
                elements.adOverlay.style.display = 'none';
            }
            
            function loadAd() {
                // في تطبيق حقيقي، ستقوم بتحميل إعلان حقيقي هنا
                elements.adContent.innerHTML = `
                    <div style="color:white; font-size:1.5rem; text-align:center; width:100%; height:100%; display:flex; justify-content:center; align-items:center;">
                        <div>
                            <div style="margin-bottom:20px;">إعلان تجاري</div>
                            <div style="font-size:0.8rem; color:#aaa;">هذا مكان إعلان Adsterra</div>
                        </div>
                    </div>
                `;
            }
            
            function searchContent(query) {
                if (!query.trim()) return;
                
                showLoading();
                
                // البحث في المسلسلات
                const seriesResults = appState.series.filter(s => 
                    s.title.toLowerCase().includes(query.toLowerCase()) || 
                    (s.description && s.description.toLowerCase().includes(query.toLowerCase())));
                
                // البحث في الأفلام
                const movieResults = appState.movies.filter(m => 
                    m.title.toLowerCase().includes(query.toLowerCase()) || 
                    (m.description && m.description.toLowerCase().includes(query.toLowerCase())));
                
                // عرض النتائج
                if (seriesResults.length > 0 || movieResults.length > 0) {
                    // يمكنك إنشاء صفحة نتائج بحث مخصصة أو عرض النتائج في صفحة موجودة
                    // هذا مثال مبسط يعرض النتائج في صفحة المسلسلات
                    elements.allSeriesGrid.innerHTML = '';
                    
                    seriesResults.forEach(ser => {
                        const seriesCard = createContentCard(ser, 'series');
                        elements.allSeriesGrid.appendChild(seriesCard);
                    });
                    
                    movieResults.forEach(movie => {
                        const movieCard = createContentCard(movie, 'movie');
                        elements.allSeriesGrid.appendChild(movieCard);
                    });
                    
                    showPage('series');
                } else {
                    showError('لا توجد نتائج مطابقة للبحث');
                }
                
                hideLoading();
            }
            
            function saveWatchHistory(content, type) {
                if (!appState.currentUser) return;
                
                db.collection('users').doc(appState.currentUser.uid).collection('watchHistory').add({
                    contentId: content.id,
                    title: content.title,
                    thumb: content.thumb,
                    type: type,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .catch(error => {
                    console.error('Error saving watch history:', error);
                });
            }
            
            function saveContentInteraction(content, interactionType) {
                if (!appState.currentUser) return;
                
                const updateData = {};
                if (interactionType === 'like') {
                    updateData.likes = firebase.firestore.FieldValue.increment(1);
                } else if (interactionType === 'dislike') {
                    updateData.dislikes = firebase.firestore.FieldValue.increment(1);
                }
                
                const collection = content.number ? 'episodes' : 'movies';
                db.collection(collection).doc(content.id).update(updateData)
                    .catch(error => {
                        console.error('Error saving interaction:', error);
                    });
            }
            
            function toggleAdminPanel() {
                const password = prompt('أدخل كلمة مرور المدير:');
                if (password) {
                    const hashedPassword = sha256(password);
                    if (hashedPassword === APP_CONFIG.ADMIN_PASSWORD_HASH) {
                        elements.adminPanel.style.display = 'block';
                        loadAdminData();
                    } else {
                        alert('كلمة المرور غير صحيحة');
                    }
                }
            }
            
            function loadAdminData() {
                showLoading();
                
                // جلب الإحصائيات
                db.collection('stats').doc('summary').get()
                    .then(doc => {
                        if (doc.exists) {
                            updateAdminStats(doc.data());
                        }
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ في تحميل بيانات الإدارة: ' + error.message);
                    });
            }
            
            function updateAdminStats(stats) {
                // تحديث إحصائيات الإعلانات
                if (stats.adStats) {
                    document.getElementById('totalAdRevenue').textContent = stats.adStats.totalRevenue?.toFixed(3) || '0';
                    document.getElementById('preRollCount').textContent = stats.adStats.preRollCount || '0';
                    document.getElementById('midRollCount').textContent = stats.adStats.midRollCount || '0';
                    document.getElementById('postRollCount').textContent = stats.adStats.postRollCount || '0';
                    document.getElementById('bannerAdCount').textContent = stats.adStats.bannerAdCount || '0';
                }
                
                // تحديث إحصائيات المشاهدات
                document.getElementById('totalViews').textContent = stats.totalViews || '0';
                document.getElementById('totalLikes').textContent = stats.totalLikes || '0';
                document.getElementById('totalDislikes').textContent = stats.totalDislikes || '0';
                
                // تحديث إحصائيات الزوار
                if (stats.visitors) {
                    document.getElementById('totalVisitors').textContent = stats.visitors.total || '0';
                    document.getElementById('newVisitors').textContent = stats.visitors.new || '0';
                    document.getElementById('returningVisitors').textContent = stats.visitors.returning || '0';
                    
                    // مصادر الزوار
                    if (stats.visitors.sources) {
                        document.getElementById('facebookVisitors').textContent = stats.visitors.sources.facebook || '0';
                        document.getElementById('googleVisitors').textContent = stats.visitors.sources.google || '0';
                        document.getElementById('youtubeVisitors').textContent = stats.visitors.sources.youtube || '0';
                        document.getElementById('tiktokVisitors').textContent = stats.visitors.sources.tiktok || '0';
                        document.getElementById('instagramVisitors').textContent = stats.visitors.sources.instagram || '0';
                        document.getElementById('otherVisitors').textContent = stats.visitors.sources.other || '0';
                    }
                    
                    // أجهزة الزوار
                    if (stats.visitors.devices) {
                        document.getElementById('mobileVisitors').textContent = stats.visitors.devices.mobile || '0';
                        document.getElementById('desktopVisitors').textContent = stats.visitors.devices.desktop || '0';
                        document.getElementById('tabletVisitors').textContent = stats.visitors.devices.tablet || '0';
                        document.getElementById('tvVisitors').textContent = stats.visitors.devices.tv || '0';
                    }
                }
            }
            
            function extractYouTubeId(url) {
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[2].length === 11) ? match[2] : null;
            }
            
            function showLoading() {
                elements.loadingOverlay.style.display = 'flex';
            }
            
            function hideLoading() {
                elements.loadingOverlay.style.display = 'none';
            }
            
            function showError(message) {
                elements.errorMessage.textContent = message;
                elements.errorMessage.style.display = 'block';
                
                setTimeout(() => {
                    elements.errorMessage.style.display = 'none';
                }, 5000);
            }
            
            // إعداد تبويبات لوحة الإدارة
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // تحديث التبويب النشط
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // عرض المحتوى المناسب
                    document.querySelectorAll('.admin-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                });
            });
            
            // إعداد نموذج إضافة مسلسل
            document.getElementById('addSeriesBtn').addEventListener('click', function() {
                document.getElementById('seriesForm').style.display = 'block';
            });
            
            document.getElementById('cancelSeries').addEventListener('click', function() {
                document.getElementById('seriesForm').style.display = 'none';
            });
            
            document.getElementById('saveSeries').addEventListener('click', function() {
                const seriesData = {
                    title: document.getElementById('seriesTitle').value.trim(),
                    description: document.getElementById('seriesDescription').value.trim(),
                    thumb: document.getElementById('seriesThumb').value.trim(),
                    rating: parseFloat(document.getElementById('seriesRating').value) || 7.5,
                    genre: document.getElementById('seriesGenre').value.trim() || 'مغامرات',
                    episodes: parseInt(document.getElementById('seriesEpisodes').value) || 1,
                    language: document.getElementById('seriesLanguage').value.trim() || 'مدبلج',
                    country: document.getElementById('seriesCountry').value.trim() || 'بلجيكا',
                    season: parseInt(document.getElementById('seriesSeason').value) || 1,
                    status: document.getElementById('seriesStatus').value || 'regular',
                    isFeatured: document.getElementById('seriesFeatured').value === 'true',
                    views: 0,
                    likes: 0,
                    dislikes: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!seriesData.title) {
                    showError('الرجاء إدخال عنوان المسلسل');
                    return;
                }
                
                showLoading();
                
                db.collection('series').add(seriesData)
                    .then(docRef => {
                        hideLoading();
                        document.getElementById('seriesForm').style.display = 'none';
                        showError('تم إضافة المسلسل بنجاح');
                        
                        // إضافة المسلسل إلى الحالة المحلية
                        seriesData.id = docRef.id;
                        appState.series.push(seriesData);
                        
                        // تحديث الواجهة
                        renderSeriesGrid(appState.series);
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء إضافة المسلسل: ' + error.message);
                    });
            });
            
            // إعداد نموذج إضافة حلقة
            document.getElementById('saveEpisode').addEventListener('click', function() {
                const seriesId = document.getElementById('episodeSeries').value;
                const episodeData = {
                    seriesId: seriesId,
                    number: parseInt(document.getElementById('episodeNumber').value) || 1,
                    title: document.getElementById('episodeTitle').value.trim() || `الحلقة ${document.getElementById('episodeNumber').value}`,
                    url: document.getElementById('episodeUrl').value.trim(),
                    thumb: document.getElementById('episodeThumb').value.trim(),
                    duration: parseInt(document.getElementById('episodeDuration').value) || 24,
                    imdb: parseFloat(document.getElementById('episodeImdb').value) || 7.5,
                    views: 0,
                    likes: 0,
                    dislikes: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!seriesId) {
                    showError('الرجاء اختيار مسلسل');
                    return;
                }
                
                if (!episodeData.url) {
                    showError('الرجاء إدخال رابط الحلقة');
                    return;
                }
                
                showLoading();
                
                // إذا كانت الصورة المصغرة فارغة، استخدم صورة افتراضية
                if (!episodeData.thumb) {
                    episodeData.thumb = `https://via.placeholder.com/300x170?text=صورة+الحلقة+${episodeData.number}`;
                }
                
                db.collection('episodes').add(episodeData)
                    .then(docRef => {
                        hideLoading();
                        showError('تم إضافة الحلقة بنجاح');
                        
                        // إضافة الحلقة إلى الحالة المحلية
                        episodeData.id = docRef.id;
                        appState.episodes.push(episodeData);
                        
                        // تحديث الواجهة إذا كنا نعرض حلقات هذا المسلسل
                        if (appState.currentContent?.type === 'series' && appState.currentContent.data.id === seriesId) {
                            renderSeriesEpisodes(appState.currentContent.data);
                        }
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء إضافة الحلقة: ' + error.message);
                    });
            });
            
            // إعداد نموذج إضافة فيلم
            document.getElementById('saveMovie').addEventListener('click', function() {
                const movieData = {
                    title: document.getElementById('movieTitle').value.trim(),
                    description: document.getElementById('movieDescription').value.trim(),
                    url: document.getElementById('movieUrl').value.trim(),
                    thumb: document.getElementById('movieThumb').value.trim(),
                    duration: parseInt(document.getElementById('movieDuration').value) || 90,
                    imdb: parseFloat(document.getElementById('movieImdb').value) || 7.0,
                    isFeatured: document.getElementById('movieFeatured').value === 'true',
                    views: 0,
                    likes: 0,
                    dislikes: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!movieData.title) {
                    showError('الرجاء إدخال عنوان الفيلم');
                    return;
                }
                
                if (!movieData.url) {
                    showError('الرجاء إدخال رابط الفيلم');
                    return;
                }
                
                // إذا كانت الصورة المصغرة فارغة، استخدم صورة افتراضية
                if (!movieData.thumb) {
                    movieData.thumb = `https://via.placeholder.com/300x170?text=${encodeURIComponent(movieData.title)}`;
                }
                
                showLoading();
                
                db.collection('movies').add(movieData)
                    .then(docRef => {
                        hideLoading();
                        showError('تم إضافة الفيلم بنجاح');
                        
                        // إضافة الفيلم إلى الحالة المحلية
                        movieData.id = docRef.id;
                        appState.movies.push(movieData);
                        
                        // تحديث الواجهة
                        renderMoviesGrid(appState.movies);
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء إضافة الفيلم: ' + error.message);
                    });
            });
            
            // إعدادات الإعلانات
            document.getElementById('saveAdsSettings').addEventListener('click', function() {
                const adSettings = {
                    adsterraKey: document.getElementById('adsterraKey').value.trim(),
                    preRollDuration: parseInt(document.getElementById('preRollDuration').value) || 5,
                    midRollDuration: parseInt(document.getElementById('midRollDuration').value) || 10,
                    postRollDuration: parseInt(document.getElementById('postRollDuration').value) || 10,
                    midRollEnabled: document.getElementById('midRollEnabled').value === 'true',
                    postRollEnabled: document.getElementById('postRollEnabled').value === 'true',
                    bannerAdEnabled: document.getElementById('bannerAdEnabled').value === 'true'
                };
                
                showLoading();
                
                db.collection('settings').doc('ads').set(adSettings)
                    .then(() => {
                        hideLoading();
                        showError('تم حفظ إعدادات الإعلانات بنجاح');
                        APP_CONFIG.ADSTERRA_KEY = adSettings.adsterraKey;
                        APP_CONFIG.ADS_ENABLED = true;
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء حفظ الإعدادات: ' + error.message);
                    });
            });
            
            // إعدادات النظام
            document.getElementById('saveSettings').addEventListener('click', function() {
                const settings = {
                    siteTitle: document.getElementById('siteTitle').value.trim(),
                    siteLogo: document.getElementById('siteLogo').value.trim(),
                    channelLogo: document.getElementById('channelLogo').value.trim(),
                    primaryColor: document.getElementById('primaryColor').value,
                    siteMode: document.getElementById('siteMode').value,
                    adminPassword: sha256(document.getElementById('adminPassword').value)
                };
                
                showLoading();
                
                db.collection('settings').doc('app').set(settings)
                    .then(() => {
                        hideLoading();
                        showError('تم حفظ الإعدادات بنجاح');
                        
                        // تحديث واجهة المستخدم
                        document.querySelector('.header h1').textContent = settings.siteTitle;
                        document.querySelector('.logo-img').src = settings.siteLogo;
                        document.querySelector('.channel-logo').src = settings.channelLogo;
                        document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
                        
                        // تحديث وضع الموقع
                        document.body.className = settings.siteMode === 'light' ? 'light-mode' : '';
                        
                        // تحديث كلمة مرور المدير
                        APP_CONFIG.ADMIN_PASSWORD_HASH = settings.adminPassword;
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء حفظ الإعدادات: ' + error.message);
                    });
            });
            
            // إغلاق لوحة الإدارة
            document.getElementById('closeAdmin').addEventListener('click', function() {
                elements.adminPanel.style.display = 'none';
            });
        });
    </script>
</body>
</html>