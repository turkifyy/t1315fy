<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Like4Like | Social Exchange Platform</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #1cc88a;
            --dark-color: #5a5c69;
            --light-color: #f8f9fc;
            --danger-color: #e74a3b;
            --warning-color: #f6c23e;
            --facebook-blue: #1877f2;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--light-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .navbar-brand {
            font-weight: 800;
            font-size: 1.5rem;
        }
        
        .navbar-brand span {
            color: var(--primary-color);
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--primary-color) 0%, #224abe 100%);
            color: white;
            padding: 5rem 0;
            margin-bottom: 3rem;
        }
        
        .card {
            border: none;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: #f8f9fc;
            border-bottom: 1px solid #e3e6f0;
            padding: 1rem 1.35rem;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .points-badge {
            background-color: var(--warning-color);
            color: #000;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 0.35rem;
            display: inline-block;
        }
        
        .task-item {
            border-left: 0.25rem solid var(--primary-color);
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        
        .task-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        
        .task-completed {
            border-left-color: var(--secondary-color);
        }
        
        .countdown-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin: 1rem 0;
        }
        
        #authSection {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .hidden {
            display: none !important;
        }
        
        .profile-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Auth styles */
        .auth-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .auth-header h2 {
            color: var(--facebook-blue);
            font-weight: bold;
        }
        
        .auth-form {
            padding: 20px;
        }
        
        .auth-form .form-control {
            height: 50px;
            padding: 0 15px;
            font-size: 16px;
        }
        
        .auth-form .btn {
            height: 50px;
            line-height: 50px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .auth-divider {
            border-top: 1px solid #ddd;
            margin: 20px 0;
            text-align: center;
            position: relative;
        }
        
        .auth-divider span {
            background: white;
            padding: 0 10px;
            position: relative;
            top: -12px;
        }
        
        .auth-footer {
            text-align: center;
            padding: 20px 0;
            border-top: 1px solid #ddd;
        }
        
        /* Landing page styles */
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .testimonial-card {
            border-left: 4px solid var(--primary-color);
        }
        
        .faq-item {
            margin-bottom: 1rem;
        }
        
        .faq-question {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        /* Admin panel styles */
        .admin-sidebar {
            background: #343a40;
            min-height: 100vh;
            color: white;
            padding: 0;
        }
        
        .admin-sidebar .nav-link {
            color: rgba(255,255,255,.8);
        }
        
        .admin-sidebar .nav-link:hover {
            color: white;
        }
        
        .admin-sidebar .nav-link.active {
            color: white;
            background: rgba(255,255,255,.1);
        }
        
        .stat-card {
            border-left: 4px solid var(--primary-color);
        }
        
        /* Ad banner styles */
        .ad-banner {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .ad-label {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        /* Form validation */
        .is-invalid {
            border-color: var(--danger-color);
        }
        
        .invalid-feedback {
            color: var(--danger-color);
        }
        
        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            transition: all 0.3s ease;
        }
        
        /* Loading spinner */
        #loadingSpinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }
        
        /* Image preview */
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            display: block;
            margin: 10px auto;
        }
        
        /* Rate limiting indicator */
        .rate-limit-message {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* Responsive tables */
        .table-responsive {
            overflow-x: auto;
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 3rem 0;
            }
            
            .auth-form {
                padding: 15px;
            }
            
            .admin-sidebar {
                min-height: auto;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#home">
                <span>Like</span>4<span>Like</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="mainNavLinks">
                    <li class="nav-item"><a class="nav-link active" href="#home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#how-it-works">How It Works</a></li>
                    <li class="nav-item"><a class="nav-link" href="#features">Features</a></li>
                    <li class="nav-item"><a class="nav-link" href="#faq">FAQ</a></li>
                </ul>
                <div class="d-flex" id="authButtons">
                    <a href="#login" class="btn btn-outline-light me-2" id="loginBtn">Login</a>
                    <a href="#register" class="btn btn-primary" id="registerBtn">Register</a>
                </div>
                <div class="d-flex align-items-center hidden" id="userMenu">
                    <span class="badge bg-warning text-dark me-2" id="userCredits">0 Points</span>
                    <div class="dropdown">
                        <a class="dropdown-toggle d-flex align-items-center text-white text-decoration-none" href="#" id="userDropdown" data-bs-toggle="dropdown">
                            <img src="https://via.placeholder.com/30" class="profile-img me-2" id="userAvatar">
                            <span id="userEmail"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#dashboard">Dashboard</a></li>
                            <li><a class="dropdown-item" href="#earn-points">Earn Points</a></li>
                            <li><a class="dropdown-item" href="#add-task">Add Task</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#account-settings">Account Settings</a></li>
                            <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Welcome Section -->
    <section class="hero-section text-center" id="home">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">Grow Your Social Media Presence</h1>
            <p class="lead mb-5">Exchange likes, follows, views and more with our community of real users</p>
            <div class="d-flex justify-content-center gap-3">
                <a href="#register" class="btn btn-light text-primary" id="heroRegisterBtn">Get Started - It's Free!</a>
            </div>
        </div>
    </section>

    <!-- How It Works Section -->
    <section class="py-5 bg-white" id="how-it-works">
        <div class="container">
            <h2 class="text-center mb-5">How It Works</h2>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center">
                            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                                <i class="fas fa-user-plus fa-2x text-primary"></i>
                            </div>
                            <h5 class="card-title">1. Create Account</h5>
                            <p class="card-text">Sign up for free in less than a minute. No credit card required. You'll receive 100 free points to start with.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center">
                            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                                <i class="fas fa-tasks fa-2x text-primary"></i>
                            </div>
                            <h5 class="card-title">2. Complete Tasks</h5>
                            <p class="card-text">Earn points by completing simple tasks like liking posts, following accounts, or watching videos on various social platforms.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center">
                            <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                                <i class="fas fa-exchange-alt fa-2x text-primary"></i>
                            </div>
                            <h5 class="card-title">3. Get Engagement</h5>
                            <p class="card-text">Use your earned points to get real likes, follows and views on your own social media content from our active community.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="text-center mb-4">Why Choose Like4Like?</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> 100% Real Users - No bots or fake accounts</li>
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> Instant Engagement - Get likes and follows within minutes</li>
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> Multiple Platforms - Support for all major social networks</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group list-group-flush">
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> Free to Join - Start with 100 free points</li>
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> Easy to Use - Simple and intuitive interface</li>
                                        <li class="list-group-item"><i class="fas fa-check text-success me-2"></i> Secure - Your data is always protected</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="py-5 bg-light" id="features">
        <div class="container">
            <h2 class="text-center mb-5">Our Powerful Features</h2>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-bolt feature-icon"></i>
                            <h4>Fast Results</h4>
                            <p>Get real engagement on your social media profiles within minutes of posting your tasks.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-globe feature-icon"></i>
                            <h4>Multiple Platforms</h4>
                            <p>Support for Instagram, Facebook, YouTube, Twitter, TikTok, Pinterest, LinkedIn and more.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-shield-alt feature-icon"></i>
                            <h4>Safe & Secure</h4>
                            <p>Our system ensures all engagement comes from real users in a safe and organic way.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-chart-line feature-icon"></i>
                            <h4>Advanced Analytics</h4>
                            <p>Track your growth with detailed statistics and performance metrics.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-users feature-icon"></i>
                            <h4>Active Community</h4>
                            <p>Thousands of active users ready to engage with your content 24/7.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-headset feature-icon"></i>
                            <h4>Premium Support</h4>
                            <p>Our support team is available 24/7 to help with any questions or issues.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="py-5 bg-white" id="testimonials">
        <div class="container">
            <h2 class="text-center mb-5">What Our Users Say</h2>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100 testimonial-card">
                        <div class="card-body">
                            <div class="mb-3">
                                <i class="fas fa-quote-left text-muted"></i>
                            </div>
                            <p class="card-text">"Like4Like helped me grow my Instagram from 500 to 10,000 followers in just 3 months. The engagement is real and my account has never looked better!"</p>
                            <div class="d-flex align-items-center mt-4">
                                <img src="https://randomuser.me/api/portraits/women/32.jpg" class="rounded-circle me-3" width="50" height="50">
                                <div>
                                    <h6 class="mb-0">Sarah Johnson</h6>
                                    <small class="text-muted">Instagram Influencer</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 testimonial-card">
                        <div class="card-body">
                            <div class="mb-3">
                                <i class="fas fa-quote-left text-muted"></i>
                            </div>
                            <p class="card-text">"As a small business owner, getting visibility is tough. Like4Like gave me the boost I needed to get my products in front of real potential customers."</p>
                            <div class="d-flex align-items-center mt-4">
                                <img src="https://randomuser.me/api/portraits/men/45.jpg" class="rounded-circle me-3" width="50" height="50">
                                <div>
                                    <h6 class="mb-0">Michael Chen</h6>
                                    <small class="text-muted">Small Business Owner</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card h-100 testimonial-card">
                        <div class="card-body">
                            <div class="mb-3">
                                <i class="fas fa-quote-left text-muted"></i>
                            </div>
                            <p class="card-text">"I was skeptical at first, but after trying Like4Like I'm amazed at how quickly I gained real followers who actually engage with my content."</p>
                            <div class="d-flex align-items-center mt-4">
                                <img src="https://randomuser.me/api/portraits/women/68.jpg" class="rounded-circle me-3" width="50" height="50">
                                <div>
                                    <h6 class="mb-0">Emily Rodriguez</h6>
                                    <small class="text-muted">Content Creator</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="py-5 bg-light" id="faq">
        <div class="container">
            <h2 class="text-center mb-5">Frequently Asked Questions</h2>
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    <i class="fas fa-question-circle me-2"></i> Is Like4Like free to use?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Yes! Like4Like is completely free to join and use. We give all new users 100 free points to get started. You can earn more points by completing tasks for other users.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    <i class="fas fa-question-circle me-2"></i> Is this service safe for my social media accounts?
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Absolutely. Like4Like uses only real users to provide engagement, which is completely safe and complies with all social media platform policies. We never use bots or fake accounts that could put your account at risk.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    <i class="fas fa-question-circle me-2"></i> How quickly will I see results?
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Most tasks start receiving engagement within minutes of being posted. The speed depends on how many points you allocate to your task - higher point tasks get completed faster.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    <i class="fas fa-question-circle me-2"></i> Can I use Like4Like for multiple social media accounts?
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Yes, you can add and manage multiple social media accounts from different platforms within your Like4Like dashboard. Each account can have its own tasks and engagement tracking.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingFive">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
                                    <i class="fas fa-question-circle me-2"></i> How do I earn more points?
                                </button>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    You can earn points by completing tasks for other users in the "Earn Points" section. Each completed task awards you the points specified by the task creator. You can also earn bonus points by referring friends or watching ads.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingSix">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
                                    <i class="fas fa-question-circle me-2"></i> What social media platforms do you support?
                                </button>
                            </h2>
                            <div id="collapseSix" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    We currently support Instagram, Facebook, YouTube, Twitter, TikTok, Pinterest, LinkedIn, and Reddit. We're constantly adding support for new platforms based on user demand.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Ad Banner Section -->
    <section class="py-5 bg-white">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="ad-banner">
                        <div class="ad-label">Advertisement</div>
                        <div id="banner-ad-container">
                            <!-- Ad will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action Section -->
    <section class="py-5 bg-primary text-white">
        <div class="container text-center">
            <h2 class="mb-4">Ready to Grow Your Social Media?</h2>
            <p class="lead mb-5">Join thousands of users who are growing their social media presence with Like4Like</p>
            <a href="#register" class="btn btn-light text-primary" id="bottomRegisterBtn">Get Started Now - It's Free!</a>
        </div>
    </section>

    <!-- Authentication Section -->
    <section class="py-5 bg-light hidden" id="authSection">
        <div class="container">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="card">
                        <div class="card-header auth-header">
                            <h2 id="authTitle">Login to Like4Like</h2>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="authTabsContent">
                                <!-- Login Tab -->
                                <div id="login">
                                    <form id="loginForm">
                                        <div class="mb-3">
                                            <label for="loginEmail" class="form-label">Email address</label>
                                            <input type="email" class="form-control" id="loginEmail" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="loginPassword" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="loginPassword" required>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="rememberMe">
                                                <label class="form-check-label" for="rememberMe">Remember me</label>
                                            </div>
                                            <a href="#" id="showResetForm">Forgot password?</a>
                                        </div>
                                        <div class="d-grid gap-2 mb-3">
                                            <button type="submit" class="btn btn-primary">Log In</button>
                                        </div>
                                        <div class="auth-divider">
                                            <span>or</span>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="button" id="showRegisterForm" class="btn btn-success">Create New Account</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Register Tab -->
                                <div id="register" class="hidden">
                                    <form id="registerForm">
                                        <div class="mb-3">
                                            <label for="registerName" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="registerName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="registerEmail" class="form-label">Email address</label>
                                            <input type="email" class="form-control" id="registerEmail" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="registerPassword" class="form-label">New password</label>
                                            <input type="password" class="form-control" id="registerPassword" minlength="6" required>
                                            <div class="invalid-feedback">Password must be at least 6 characters</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="registerPasswordConfirm" class="form-label">Confirm password</label>
                                            <input type="password" class="form-control" id="registerPasswordConfirm" minlength="6" required>
                                            <div class="invalid-feedback">Passwords must match</div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="g-recaptcha" data-sitekey="6LdPHEkrAAAAAPFl9bgdu7geim_C8vb0YEF4GDDm"></div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="acceptTerms" required>
                                                <label class="form-check-label" for="acceptTerms">I agree to the <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a></label>
                                            </div>
                                        </div>
                                        <div class="d-grid gap-2 mb-3">
                                            <button type="submit" class="btn btn-primary">Sign Up</button>
                                        </div>
                                        <div class="auth-divider">
                                            <span>or</span>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="button" id="showLoginForm" class="btn btn-secondary">Already have an account? Log In</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Reset Password Tab -->
                                <div id="reset" class="hidden">
                                    <form id="resetPasswordForm">
                                        <div class="mb-4 text-center">
                                            <p>Enter your email address and we'll send you a link to reset your password.</p>
                                        </div>
                                        <div class="mb-3">
                                            <label for="resetEmail" class="form-label">Email address</label>
                                            <input type="email" class="form-control" id="resetEmail" required>
                                        </div>
                                        <div class="d-grid gap-2 mb-3">
                                            <button type="submit" class="btn btn-primary">Send Reset Link</button>
                                        </div>
                                        <div class="auth-divider">
                                            <span>or</span>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="button" id="backToLoginForm" class="btn btn-secondary">Back to Login</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="py-5 bg-light hidden" id="dashboardSection">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <!-- User Profile Card -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">My Profile</h5>
                        </div>
                        <div class="card-body text-center">
                            <img src="https://via.placeholder.com/150" class="profile-img mb-3" id="dashboardAvatar">
                            <h5 id="dashboardUsername">User Email</h5>
                            <div class="points-badge mb-3" id="dashboardPoints">0 Points</div>
                            <p class="text-muted mb-1"><small>Member since: <span id="memberSince">-</span></small></p>
                            <p class="text-muted"><small>Last active: <span id="lastActive">-</span></small></p>
                        </div>
                    </div>
                    
                    <!-- Quick Stats Card -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Quick Stats</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Tasks Completed
                                    <span class="badge bg-primary rounded-pill" id="tasksCompleted">0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Tasks Created
                                    <span class="badge bg-primary rounded-pill" id="tasksCreated">0</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Points Earned
                                    <span class="badge bg-primary rounded-pill" id="pointsEarned">0</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Ad Banner -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <div class="ad-banner">
                                <div class="ad-label">Advertisement</div>
                                <div id="sidebar-ad-container">
                                    <!-- Ad will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-8">
                    <!-- Activity Feed -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Recent Activity</h5>
                            <div>
                                <button class="btn btn-sm btn-primary" id="refreshActivity">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="activityTable">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Activity</th>
                                            <th>Points</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Activity items will be added here dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="row mt-4">
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-plus-circle fa-3x text-primary mb-3"></i>
                                    <h5 class="card-title">Add New Task</h5>
                                    <p class="card-text">Get more engagement by adding your social media tasks</p>
                                    <a href="#add-task" class="btn btn-primary">Add Task</a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <i class="fas fa-coins fa-3x text-warning mb-3"></i>
                                    <h5 class="card-title">Earn Points</h5>
                                    <p class="card-text">Complete tasks to earn points you can use for your own tasks</p>
                                    <a href="#earn-points" class="btn btn-primary">Earn Points</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Add Task Section -->
    <section class="py-5 bg-white hidden" id="addTaskSection">
        <div class="container">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Add New Task</h5>
                        </div>
                        <div class="card-body">
                            <form id="addTaskForm">
                                <div class="mb-3">
                                    <label class="form-label">Task Type</label>
                                    <select class="form-select" id="taskType" required>
                                        <option value="" disabled selected>Select task type</option>
                                        <option value="like">Like</option>
                                        <option value="follow">Follow</option>
                                        <option value="view">View</option>
                                        <option value="comment">Comment</option>
                                        <option value="share">Share</option>
                                        <option value="retweet">Retweet</option>
                                        <option value="upvote">Upvote</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Platform</label>
                                    <select class="form-select" id="platform" required>
                                        <option value="" disabled selected>Select platform</option>
                                        <option value="instagram">Instagram</option>
                                        <option value="facebook">Facebook</option>
                                        <option value="youtube">YouTube</option>
                                        <option value="twitter">Twitter</option>
                                        <option value="tiktok">TikTok</option>
                                        <option value="pinterest">Pinterest</option>
                                        <option value="linkedin">LinkedIn</option>
                                        <option value="reddit">Reddit</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="targetUrl" class="form-label">Target URL</label>
                                    <input type="url" class="form-control" id="targetUrl" required>
                                    <div class="invalid-feedback">Please enter a valid URL</div>
                                    <div class="form-text">Make sure the URL is correct and accessible</div>
                                </div>
                                <div class="mb-3">
                                    <label for="taskCredits" class="form-label">Points to Offer</label>
                                    <input type="number" class="form-control" id="taskCredits" min="1" max="1000" value="10" required>
                                    <div class="form-text">Higher points will get your task completed faster</div>
                                </div>
                                <div class="mb-3">
                                    <label for="taskInstructions" class="form-label">Special Instructions</label>
                                    <textarea class="form-control" id="taskInstructions" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <div class="g-recaptcha" data-sitekey="YOUR_RECAPTCHA_SITE_KEY"></div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">Submit Task</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- My Tasks -->
                    <div class="card mt-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">My Tasks</h5>
                            <button class="btn btn-sm btn-primary" id="refreshMyTasks">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="myTasksTable">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Platform</th>
                                            <th>URL</th>
                                            <th>Points</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- User's tasks will be added here dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Earn Points Section -->
    <section class="py-5 bg-light hidden" id="earnPointsSection">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <!-- Available Tasks -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Available Tasks</h5>
                            <div>
                                <button class="btn btn-sm btn-primary" id="refreshTasks">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <div class="dropdown d-inline-block ms-2">
                                    <button class="btn btn-sm btn-primary dropdown-toggle" type="button" id="taskFilterDropdown" data-bs-toggle="dropdown">
                                        <i class="fas fa-filter"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="all">All Tasks</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="like">Likes</a></li>
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="follow">Follows</a></li>
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="view">Views</a></li>
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="comment">Comments</a></li>
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="share">Shares</a></li>
                                        <li><a class="dropdown-item filter-task" href="#" data-filter="retweet">Retweets</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="tasksList">
                                <!-- Tasks will be loaded here -->
                                <div class="text-center py-5">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-3">Loading available tasks...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Watch Ad to Earn Points -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Earn Points by Watching Ads</h5>
                        </div>
                        <div class="card-body">
                            <p>Watch short video ads to earn extra points. Each completed ad gives you 10 points.</p>
                            <div class="ad-banner">
                                <div class="ad-label">Advertisement</div>
                                <div id="video-ad-container">
                                    <!-- Video ad will be loaded here -->
                                </div>
                            </div>
                            <div class="d-grid gap-2 mt-3">
                                <button class="btn btn-success" id="completeAdBtn">I Watched This Ad - Give Me Points</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <!-- Current Task -->
                    <div class="card mb-4 hidden" id="currentTaskCard">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Current Task</h5>
                        </div>
                        <div class="card-body">
                            <h6 id="currentTaskTitle">Task Title</h6>
                            <p class="text-muted" id="currentTaskPlatform">Platform: -</p>
                            <p id="currentTaskDescription">Task description goes here</p>
                            <a href="#" class="btn btn-primary mb-3" target="_blank" id="currentTaskLink">Go to Task</a>
                            <div class="countdown-timer" id="countdownTimer">00:30</div>
                            <div class="d-grid gap-2">
                                <button class="btn btn-success" id="completeTaskBtn">Mark as Completed</button>
                                <button class="btn btn-danger" id="skipTaskBtn">Skip Task</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Task Stats -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Earnings Summary</h5>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between mb-3">
                                <span>Today's Earnings:</span>
                                <strong id="todayEarnings">0 points</strong>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>This Week:</span>
                                <strong id="weekEarnings">0 points</strong>
                            </div>
                            <div class="d-flex justify-content-between mb-3">
                                <span>Total Earnings:</span>
                                <strong id="totalEarnings">0 points</strong>
                            </div>
                            <div class="dropdown-divider"></div>
                            <div class="d-flex justify-content-between">
                                <span>Available Points:</span>
                                <strong class="text-primary" id="availablePoints">0 points</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ad Banner -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <div class="ad-banner">
                                <div class="ad-label">Advertisement</div>
                                <div id="sidebar-ad-container-2">
                                    <!-- Ad will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Account Settings Section -->
    <section class="py-5 bg-light hidden" id="accountSettingsSection">
        <div class="container">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Account Settings</h5>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profileSettings" type="button" role="tab">Profile</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="security-tab" data-bs-toggle="tab" data-bs-target="#securitySettings" type="button" role="tab">Security</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notificationsSettings" type="button" role="tab">Notifications</button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="settingsTabsContent">
                                <!-- Profile Settings -->
                                <div class="tab-pane fade show active" id="profileSettings" role="tabpanel">
                                    <form id="profileForm">
                                        <div class="mb-3">
                                            <label for="profileEmail" class="form-label">Email address</label>
                                            <input type="email" class="form-control" id="profileEmail" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label for="profileUsername" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="profileUsername">
                                        </div>
                                        <div class="mb-3">
                                            <label for="profileAvatar" class="form-label">Profile Picture</label>
                                            <input type="file" class="form-control" id="profileAvatar" accept="image/*">
                                            <div class="form-text">Maximum file size: 2MB. Supported formats: JPG, PNG</div>
                                            <img id="profileImagePreview" class="image-preview hidden">
                                        </div>
                                        <div class="mb-3">
                                            <label for="profileBio" class="form-label">Bio</label>
                                            <textarea class="form-control" id="profileBio" rows="3"></textarea>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary">Update Profile</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Security Settings -->
                                <div class="tab-pane fade" id="securitySettings" role="tabpanel">
                                    <form id="passwordForm">
                                        <div class="mb-3">
                                            <label for="currentPassword" class="form-label">Current Password</label>
                                            <input type="password" class="form-control" id="currentPassword" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="newPassword" class="form-label">New Password</label>
                                            <input type="password" class="form-control" id="newPassword" minlength="8" required>
                                            <div class="invalid-feedback">Password must be at least 8 characters and include uppercase, lowercase, number, and special character</div>
                                            <div class="form-text">Password strength: <span id="passwordStrength">Weak</span></div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                                            <input type="password" class="form-control" id="confirmPassword" minlength="8" required>
                                            <div class="invalid-feedback">Passwords must match</div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary">Change Password</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Notification Settings -->
                                <div class="tab-pane fade" id="notificationsSettings" role="tabpanel">
                                    <form id="notificationsForm">
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="emailNotifications">
                                                <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="taskCompletedNotifications">
                                                <label class="form-check-label" for="taskCompletedNotifications">Task Completed Notifications</label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="pointsEarnedNotifications">
                                                <label class="form-check-label" for="pointsEarnedNotifications">Points Earned Notifications</label>
                                            </div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary">Save Settings</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Panel Section -->
    <section class="hidden" id="adminPanelSection">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-2 admin-sidebar p-0">
                    <div class="p-3" style="height: 100vh;">
                        <a href="#" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
                            <span class="fs-4">Admin Panel</span>
                        </a>
                        <hr>
                        <ul class="nav nav-pills flex-column mb-auto">
                            <li class="nav-item">
                                <a href="#admin-dashboard" class="nav-link active" id="adminDashboardLink">
                                    <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                                </a>
                            </li>
                            <li>
                                <a href="#admin-users" class="nav-link" id="adminUsersLink">
                                    <i class="fas fa-users me-2"></i> Users
                                </a>
                            </li>
                            <li>
                                <a href="#admin-tasks" class="nav-link" id="adminTasksLink">
                                    <i class="fas fa-tasks me-2"></i> Tasks
                                </a>
                            </li>
                            <li>
                                <a href="#admin-ads" class="nav-link" id="adminAdsLink">
                                    <i class="fas fa-ad me-2"></i> Ad Management
                                </a>
                            </li>
                            <li>
                                <a href="#admin-settings" class="nav-link" id="adminSettingsLink">
                                    <i class="fas fa-cog me-2"></i> Settings
                                </a>
                            </li>
                        </ul>
                        <hr>
                        <div class="dropdown">
                            <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="adminUserDropdown" data-bs-toggle="dropdown">
                                <img src="https://via.placeholder.com/30" class="rounded-circle me-2">
                                <strong id="adminUsername">Admin</strong>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-dark text-small shadow">
                                <li><a class="dropdown-item" href="#">Profile</a></li>
                                <li><a class="dropdown-item" href="#">Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="adminLogoutBtn">Sign out</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="col-md-10 p-4">
                    <div id="adminDashboard" class="admin-content-section">
                        <h2 class="mb-4">Admin Dashboard</h2>
                        <div class="row">
                            <div class="col-md-3 mb-4">
                                <div class="card stat-card">
                                    <div class="card-body">
                                        <h5 class="card-title">Total Users</h5>
                                        <h2 class="card-text" id="adminTotalUsers">0</h2>
                                        <p class="text-muted mb-0"><small>+0 today</small></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="card stat-card">
                                    <div class="card-body">
                                        <h5 class="card-title">Active Tasks</h5>
                                        <h2 class="card-text" id="adminActiveTasks">0</h2>
                                        <p class="text-muted mb-0"><small>+0 today</small></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="card stat-card">
                                    <div class="card-body">
                                        <h5 class="card-title">Completed Tasks</h5>
                                        <h2 class="card-text" id="adminCompletedTasks">0</h2>
                                        <p class="text-muted mb-0"><small>+0 today</small></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="card stat-card">
                                    <div class="card-body">
                                        <h5 class="card-title">Ad Revenue</h5>
                                        <h2 class="card-text" id="adminAdRevenue">$0</h2>
                                        <p class="text-muted mb-0"><small>+$0 today</small></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">Recent Users</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="adminRecentUsersTable">
                                                <thead>
                                                    <tr>
                                                        <th>Email</th>
                                                        <th>Joined</th>
                                                        <th>Points</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Recent users will be added here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5 class="card-title mb-0">Recent Tasks</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="adminRecentTasksTable">
                                                <thead>
                                                    <tr>
                                                        <th>Type</th>
                                                        <th>Platform</th>
                                                        <th>Points</th>
                                                        <th>Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- Recent tasks will be added here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="adminUsers" class="admin-content-section hidden">
                        <h2 class="mb-4">User Management</h2>
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">All Users</h5>
                                <div class="d-flex">
                                    <div class="input-group me-3" style="width: 200px;">
                                        <input type="text" class="form-control" id="adminUserSearch" placeholder="Search users...">
                                    </div>
                                    <button class="btn btn-primary" id="adminAddUserBtn">
                                        <i class="fas fa-plus me-1"></i> Add User
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="adminUsersTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Email</th>
                                                <th>Points</th>
                                                <th>Joined</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- All users will be added here -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="text-center mt-3">
                                    <ul class="pagination justify-content-center" id="usersPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="adminTasks" class="admin-content-section hidden">
                        <h2 class="mb-4">Task Management</h2>
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">All Tasks</h5>
                                <div class="d-flex">
                                    <div class="input-group me-3" style="width: 200px;">
                                        <input type="text" class="form-control" id="adminTaskSearch" placeholder="Search tasks...">
                                    </div>
                                    <button class="btn btn-primary" id="adminAddTaskBtn">
                                        <i class="fas fa-plus me-1"></i> Add Task
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover" id="adminTasksTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Type</th>
                                                <th>Platform</th>
                                                <th>Points</th>
                                                <th>Creator</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- All tasks will be added here -->
                                        </tbody>
                                    </table>
                                </div>
                                <div class="text-center mt-3">
                                    <ul class="pagination justify-content-center" id="tasksPagination">
                                        <!-- Pagination will be added here -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="adminAds" class="admin-content-section hidden">
                        <h2 class="mb-4">Ad Management</h2>
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Ad Performance</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">Banner Ads</h5>
                                                <div class="d-flex justify-content-between">
                                                    <div>
                                                        <h2 class="mb-0" id="adminBannerImpressions">0</h2>
                                                        <small class="text-muted">Impressions</small>
                                                    </div>
                                                    <div>
                                                        <h2 class="mb-0" id="adminBannerClicks">0</h2>
                                                        <small class="text-muted">Clicks</small>
                                                    </div>
                                                    <div>
                                                        <h2 class="mb-0" id="adminBannerRevenue">$0</h2>
                                                        <small class="text-muted">Revenue</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">Video Ads</h5>
                                                <div class="d-flex justify-content-between">
                                                    <div>
                                                        <h2 class="mb-0" id="adminVideoImpressions">0</h2>
                                                        <small class="text-muted">Impressions</small>
                                                    </div>
                                                    <div>
                                                        <h2 class="mb-0" id="adminVideoCompletions">0</h2>
                                                        <small class="text-muted">Completions</small>
                                                    </div>
                                                    <div>
                                                        <h2 class="mb-0" id="adminVideoRevenue">$0</h2>
                                                        <small class="text-muted">Revenue</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0">Ad Settings</h5>
                                        <button class="btn btn-primary" id="adminSaveAdSettings">Save Settings</button>
                                    </div>
                                    <div class="card-body">
                                        <form id="adminAdSettingsForm">
                                            <div class="mb-3">
                                                <label for="adsterraPubId" class="form-label">Adsterra Publisher ID</label>
                                                <input type="text" class="form-control" id="adsterraPubId" placeholder="Enter your Adsterra Publisher ID">
                                            </div>
                                            <div class="mb-3">
                                                <label for="bannerAdZone" class="form-label">Banner Ad Zone ID</label>
                                                <input type="text" class="form-control" id="bannerAdZone" placeholder="Enter Banner Ad Zone ID">
                                            </div>
                                            <div class="mb-3">
                                                <label for="videoAdZone" class="form-label">Video Ad Zone ID</label>
                                                <input type="text" class="form-control" id="videoAdZone" placeholder="Enter Video Ad Zone ID">
                                            </div>
                                            <div class="mb-3">
                                                <label for="pointsPerAd" class="form-label">Points per Ad View</label>
                                                <input type="number" class="form-control" id="pointsPerAd" value="10" min="1">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="adminSettings" class="admin-content-section hidden">
                        <h2 class="mb-4">System Settings</h2>
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">General Settings</h5>
                            </div>
                            <div class="card-body">
                                <form id="adminGeneralSettingsForm">
                                    <div class="mb-3">
                                        <label for="siteName" class="form-label">Site Name</label>
                                        <input type="text" class="form-control" id="siteName" value="Like4Like">
                                    </div>
                                    <div class="mb-3">
                                        <label for="siteLogo" class="form-label">Site Logo</label>
                                        <input type="file" class="form-control" id="siteLogo" accept="image/*">
                                        <div class="form-text">Recommended size: 200x50 pixels</div>
                                        <img id="siteLogoPreview" class="image-preview hidden">
                                    </div>
                                    <div class="mb-3">
                                        <label for="defaultPoints" class="form-label">Default Points for New Users</label>
                                        <input type="number" class="form-control" id="defaultPoints" value="100" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="recaptchaSiteKey" class="form-label">reCAPTCHA Site Key</label>
                                        <input type="text" class="form-control" id="recaptchaSiteKey" placeholder="Enter reCAPTCHA Site Key">
                                    </div>
                                    <div class="mb-3">
                                        <label for="recaptchaSecretKey" class="form-label">reCAPTCHA Secret Key</label>
                                        <input type="text" class="form-control" id="recaptchaSecretKey" placeholder="Enter reCAPTCHA Secret Key">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary">Save Settings</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer mt-auto py-3 bg-dark text-white">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5>Like4Like</h5>
                    <p class="text-muted">Grow your social media presence by exchanging likes, follows, views and more with our community.</p>
                </div>
                <div class="col-md-2 mb-3">
                    <h5>Quick Links</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="#home" class="nav-link p-0 text-muted">Home</a></li>
                        <li class="nav-item mb-2"><a href="#how-it-works" class="nav-link p-0 text-muted">How It Works</a></li>
                        <li class="nav-item mb-2"><a href="#features" class="nav-link p-0 text-muted">Features</a></li>
                        <li class="nav-item mb-2"><a href="#faq" class="nav-link p-0 text-muted">FAQ</a></li>
                    </ul>
                </div>
                <div class="col-md-2 mb-3">
                    <h5>Legal</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted" data-bs-toggle="modal" data-bs-target="#termsModal">Terms</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy</a></li>
                        <li class="nav-item mb-2"><a href="#" class="nav-link p-0 text-muted">Cookie Policy</a></li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h5>Contact</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2"><i class="fas fa-envelope me-2"></i> support@like4like.com</li>
                        <li class="nav-item mb-2">
                            <div class="mt-2">
                                <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                                <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
                                <a href="#" class="text-white"><i class="fab fa-instagram"></i></a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="d-flex justify-content-between pt-3 border-top">
                <div>
                    &copy; 2023 Like4Like. All rights reserved.
                </div>
                <div>
                    Made with <i class="fas fa-heart text-danger"></i> for social media growth
                </div>
            </div>
        </div>
    </footer>

    <!-- Terms Modal -->
    <div class="modal fade" id="termsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Terms and Conditions</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Terms</h6>
                    <p>By accessing this website, you are agreeing to be bound by these website Terms and Conditions of Use, all applicable laws and regulations, and agree that you are responsible for compliance with any applicable local laws.</p>
                    
                    <h6>2. Use License</h6>
                    <p>Permission is granted to temporarily use the materials on Like4Like's website for personal, non-commercial transitory viewing only.</p>
                    
                    <h6>3. Disclaimer</h6>
                    <p>The materials on Like4Like's website are provided "as is". Like4Like makes no warranties, expressed or implied, and hereby disclaims and negates all other warranties, including without limitation, implied warranties or conditions of merchantability, fitness for a particular purpose, or non-infringement of intellectual property or other violation of rights.</p>
                    
                    <h6>4. Limitations</h6>
                    <p>In no event shall Like4Like or its suppliers be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on Like4Like's website.</p>
                    
                    <h6>5. Revisions and Errata</h6>
                    <p>The materials appearing on Like4Like's website could include technical, typographical, or photographic errors. Like4Like does not warrant that any of the materials on its website are accurate, complete, or current.</p>
                    
                    <h6>6. Governing Law</h6>
                    <p>Any claim relating to Like4Like's website shall be governed by the laws of the State of Delaware without regard to its conflict of law provisions.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">I Agree</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal fade" id="privacyModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Privacy Policy</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <h6>1. Information Collection</h6>
                    <p>We collect personal information such as email addresses when you register for an account. We may also collect non-personal information such as browser type, operating system, and the pages you visit.</p>
                    
                    <h6>2. Use of Information</h6>
                    <p>The information we collect is used to provide and improve our services, personalize your experience, and communicate with you. We do not sell or share your personal information with third parties for marketing purposes.</p>
                    
                    <h6>3. Cookies</h6>
                    <p>We use cookies to enhance your experience on our site. Cookies are small files that a site or its service provider transfers to your computer's hard drive through your web browser that enables the site's systems to recognize your browser and capture and remember certain information.</p>
                    
                    <h6>4. Data Security</h6>
                    <p>We implement a variety of security measures to maintain the safety of your personal information. Your personal information is contained behind secured networks and is only accessible by a limited number of persons who have special access rights to such systems.</p>
                    
                    <h6>5. Changes to Privacy Policy</h6>
                    <p>Like4Like may update its Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "effective date" at the top.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal fade" id="taskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModalTitle">Task Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Platform:</strong> <span id="taskModalPlatform"></span></p>
                    <p><strong>Points:</strong> <span id="taskModalPoints"></span></p>
                    <p><strong>URL:</strong> <a href="#" target="_blank" id="taskModalUrl"></a></p>
                    <p><strong>Instructions:</strong> <span id="taskModalInstructions"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="startTaskBtn">Start Task</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addUserForm">
                        <div class="mb-3">
                            <label for="adminUserEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="adminUserEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminUserName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="adminUserName" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminUserPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="adminUserPassword" minlength="8" required>
                            <div class="invalid-feedback">Password must be at least 8 characters and include uppercase, lowercase, number, and special character</div>
                        </div>
                        <div class="mb-3">
                            <label for="adminUserPasswordConfirm" class="form-label">Confirm Password</label>
                            <input type="password" class="form-control" id="adminUserPasswordConfirm" minlength="8" required>
                            <div class="invalid-feedback">Passwords must match</div>
                        </div>
                        <div class="mb-3">
                            <label for="adminUserCredits" class="form-label">Initial Points</label>
                            <input type="number" class="form-control" id="adminUserCredits" value="100" min="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">User Role</label>
                            <select class="form-select" id="adminUserRole">
                                <option value="user" selected>User</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmAddUserBtn">Add User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Task Modal (Admin) -->
    <div class="modal fade" id="addAdminTaskModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addAdminTaskForm">
                        <div class="mb-3">
                            <label class="form-label">Task Type</label>
                            <select class="form-select" id="adminTaskType" required>
                                <option value="" disabled selected>Select task type</option>
                                <option value="like">Like</option>
                                <option value="follow">Follow</option>
                                <option value="view">View</option>
                                <option value="comment">Comment</option>
                                <option value="share">Share</option>
                                <option value="retweet">Retweet</option>
                                <option value="upvote">Upvote</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Platform</label>
                            <select class="form-select" id="adminTaskPlatform" required>
                                <option value="" disabled selected>Select platform</option>
                                <option value="instagram">Instagram</option>
                                <option value="facebook">Facebook</option>
                                <option value="youtube">YouTube</option>
                                <option value="twitter">Twitter</option>
                                <option value="tiktok">TikTok</option>
                                <option value="pinterest">Pinterest</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="reddit">Reddit</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="adminTaskUrl" class="form-label">Target URL</label>
                            <input type="url" class="form-control" id="adminTaskUrl" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminTaskCredits" class="form-label">Points to Offer</label>
                            <input type="number" class="form-control" id="adminTaskCredits" min="1" max="1000" value="10" required>
                        </div>
                        <div class="mb-3">
                            <label for="adminTaskInstructions" class="form-label">Special Instructions</label>
                            <textarea class="form-control" id="adminTaskInstructions" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Task Status</label>
                            <select class="form-select" id="adminTaskStatus">
                                <option value="active" selected>Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmAddAdminTaskBtn">Add Task</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteModalMessage">Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- Scripts -->
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-analytics-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-functions-compat.js"></script>
    
    <!-- reCAPTCHA -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <!-- Adsterra Script -->
    <script>
        // Adsterra ad loading function
        function loadAdsterraAds() {
            // Banner ad
            if (document.getElementById('banner-ad-container')) {
                // In a real implementation, this would load the actual Adsterra ad script
                document.getElementById('banner-ad-container').innerHTML = `
                    <a href="https://www.adsterra.com" target="_blank" onclick="trackAdClick()">
                        <img src="https://via.placeholder.com/728x90?text=Adsterra+Banner+Ad" class="img-fluid" alt="Advertisement">
                    </a>
                `;
            }
            
            // Sidebar ad
            if (document.getElementById('sidebar-ad-container')) {
                document.getElementById('sidebar-ad-container').innerHTML = `
                    <a href="https://www.adsterra.com" target="_blank" onclick="trackAdClick()">
                        <img src="https://via.placeholder.com/300x250?text=Adsterra+Sidebar+Ad" class="img-fluid" alt="Advertisement">
                    </a>
                `;
            }
            
            // Second sidebar ad
            if (document.getElementById('sidebar-ad-container-2')) {
                document.getElementById('sidebar-ad-container-2').innerHTML = `
                    <a href="https://www.adsterra.com" target="_blank" onclick="trackAdClick()">
                        <img src="https://via.placeholder.com/300x250?text=Adsterra+Sidebar+Ad" class="img-fluid" alt="Advertisement">
                    </a>
                `;
            }
            
            // Video ad
            if (document.getElementById('video-ad-container')) {
                document.getElementById('video-ad-container').innerHTML = `
                    <a href="https://www.adsterra.com" target="_blank" onclick="trackAdClick()">
                        <img src="https://via.placeholder.com/640x360?text=Adsterra+Video+Ad" class="img-fluid" alt="Advertisement">
                    </a>
                `;
            }
        }
    </script>
    
    <!-- Custom JavaScript -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBPRO_cAAtiWQYx4vofbBU4Z-Rh5CYlv8M",
            authDomain: "turkify-like4like.firebaseapp.com",
            projectId: "turkify-like4like",
            storageBucket: "turkify-like4like.firebasestorage.app",
            messagingSenderId: "252611934514",
            appId: "1:252611934514:web:98312688c6b353a438ff2b",
            measurementId: "G-5TZPSEG0W3"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const analytics = firebase.analytics();
        const functions = firebase.functions();
        
          auth.onAuthStateChanged(user => {
    if (user) {
      // عرض لوحة التحكم
      document.getElementById("authSection").classList.add("hidden");
      document.getElementById("dashboardSection").classList.remove("hidden");
      document.getElementById("userMenu").classList.remove("hidden");
      document.getElementById("authButtons").classList.add("hidden");

      // عرض البريد
      document.getElementById("dashboardUsername").textContent = user.email;
      document.getElementById("userEmail").textContent = user.email;
      document.getElementById("userCredits").textContent = "100 Points";
    } else {
      // رجوع للصفحة الرئيسية
      document.getElementById("dashboardSection").classList.add("hidden");
      document.getElementById("authSection").classList.add("hidden");
      document.getElementById("userMenu").classList.add("hidden");
      document.getElementById("authButtons").classList.remove("hidden");
    }
  });

  // تسجيل الدخول
  document.getElementById("loginForm")?.addEventListener("submit", e => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => {})
      .catch(error => alert(error.message));
  });

  // تسجيل حساب جديد
  document.getElementById("registerForm")?.addEventListener("submit", e => {
    e.preventDefault();
    const email = document.getElementById("registerEmail").value;
    const password = document.getElementById("registerPassword").value;
    const confirm = document.getElementById("registerPasswordConfirm").value;
    if (password !== confirm) {
      alert("كلمة السر غير متطابقة");
      return;
    }
    auth.createUserWithEmailAndPassword(email, password)
      .then(() => {})
      .catch(error => alert(error.message));
  });

  // تسجيل الخروج
  document.getElementById("logoutBtn")?.addEventListener("click", e => {
    e.preventDefault();
    auth.signOut();
  });
        
        // Global variables
        let currentUser = null;
        let currentTask = null;
        let countdownInterval = null;
        let countdownSeconds = 30;
        let isAdmin = false;
        let userUnsubscribers = [];
        let taskUnsubscribers = [];
        let lastActionTime = 0;
        const actionDelay = 1000; // 1 second delay between actions
        
        // DOM Ready
        $(document).ready(function() {
            // Initialize UI
            initUI();
            
            // Check authentication state
            checkAuthState();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load ads
            loadAdsterraAds();
        });
        
        // Initialize UI elements
        function initUI() {
            // Hide all sections except home initially
            $('section').addClass('hidden');
            $('#home').removeClass('hidden');
            
            // Setup auth form toggles
            $('#showRegisterForm').click(function() {
                $('#authTitle').text('Create an Account');
                $('#login').addClass('hidden');
                $('#reset').addClass('hidden');
                $('#register').removeClass('hidden');
            });
            
            $('#showLoginForm').click(function() {
                $('#authTitle').text('Login to Like4Like');
                $('#register').addClass('hidden');
                $('#reset').addClass('hidden');
                $('#login').removeClass('hidden');
            });
            
            $('#showResetForm').click(function() {
                $('#authTitle').text('Reset Password');
                $('#login').addClass('hidden');
                $('#register').addClass('hidden');
                $('#reset').removeClass('hidden');
            });
            
            $('#backToLoginForm').click(function() {
                $('#authTitle').text('Login to Like4Like');
                $('#reset').addClass('hidden');
                $('#register').addClass('hidden');
                $('#login').removeClass('hidden');
            });
            
            // Image preview for profile picture
            $('#profileAvatar').change(function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#profileImagePreview').attr('src', e.target.result).removeClass('hidden');
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // Image preview for site logo
            $('#siteLogo').change(function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        $('#siteLogoPreview').attr('src', e.target.result).removeClass('hidden');
                    }
                    reader.readAsDataURL(file);
                }
            });
            
            // Password strength checker
            $('#newPassword, #adminUserPassword').on('input', function() {
                checkPasswordStrength($(this).val(), $(this).attr('id') === 'newPassword' ? '#passwordStrength' : null);
            });
            
            // Password confirmation validation
            $('#confirmPassword, #adminUserPasswordConfirm').on('input', function() {
                const confirmField = $(this);
                const passwordField = confirmField.attr('id') === 'confirmPassword' ? $('#newPassword') : $('#adminUserPassword');
                
                if (confirmField.val() !== passwordField.val()) {
                    confirmField.addClass('is-invalid');
                    confirmField.next('.invalid-feedback').text('Passwords must match').show();
                } else {
                    confirmField.removeClass('is-invalid');
                    confirmField.next('.invalid-feedback').hide();
                }
            });
            
            // URL validation for task URLs
            $('#targetUrl, #adminTaskUrl').on('input', function() {
                validateUrl($(this));
            });
        }
        
        // Check password strength
        function checkPasswordStrength(password, strengthIndicator) {
            let strength = 0;
            let messages = [];
            
            // Check length
            if (password.length >= 8) strength++;
            else messages.push("at least 8 characters");
            
            // Check for uppercase letters
            if (/[A-Z]/.test(password)) strength++;
            else messages.push("uppercase letters");
            
            // Check for lowercase letters
            if (/[a-z]/.test(password)) strength++;
            else messages.push("lowercase letters");
            
            // Check for numbers
            if (/\d/.test(password)) strength++;
            else messages.push("numbers");
            
            // Check for special characters
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            else messages.push("special characters");
            
            // Update UI
            if (strengthIndicator) {
                let strengthText = '';
                let strengthClass = '';
                
                if (strength <= 2) {
                    strengthText = 'Weak';
                    strengthClass = 'text-danger';
                } else if (strength <= 3) {
                    strengthText = 'Medium';
                    strengthClass = 'text-warning';
                } else {
                    strengthText = 'Strong';
                    strengthClass = 'text-success';
                }
                
                $(strengthIndicator).text(strengthText).removeClass('text-danger text-warning text-success').addClass(strengthClass);
            }
            
            return strength >= 4; // Require at least 4 out of 5 criteria
        }
        
        // Validate URL
        function validateUrl(inputField) {
            const url = inputField.val();
            const urlPattern = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/;
            
            if (url && !urlPattern.test(url)) {
                inputField.addClass('is-invalid');
                inputField.next('.invalid-feedback').text('Please enter a valid URL').show();
                return false;
            } else {
                inputField.removeClass('is-invalid');
                inputField.next('.invalid-feedback').hide();
                return true;
            }
        }
        
        // Check authentication state
        function checkAuthState() {
            auth.onAuthStateChanged((user) => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    
                    // Check if user is admin
                    db.collection('users').doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                const userData = doc.data();
                                isAdmin = userData.isAdmin || false;
                                
                                if (isAdmin) {
                                    // Show admin panel for admin users
                                    showSection('adminPanelSection');
                                    loadAdminData();
                                } else {
                                    // Show regular dashboard for normal users
                                    updateUserUI(user);
                                    loadUserData(user.uid);
                                    showSection('dashboardSection');
                                }
                                
                                // Log login event
                                logActivity(user.uid, 'login', 0, 'User logged in');
                                
                                // Track with analytics
                                analytics.logEvent('login');
                            }
                        });
                } else {
                    // User is signed out
                    currentUser = null;
                    isAdmin = false;
                    updateUserUI(null);
                    showSection('home');
                    
                    // Clear any existing countdown
                    if (countdownInterval) {
                        clearInterval(countdownInterval);
                        countdownInterval = null;
                    }
                    
                    // Unsubscribe from real-time listeners
                    userUnsubscribers.forEach(unsub => unsub());
                    taskUnsubscribers.forEach(unsub => unsub());
                    userUnsubscribers = [];
                    taskUnsubscribers = [];
                }
            });
        }
        
        // Update UI based on user state
        function updateUserUI(user) {
            if (user) {
                // User is logged in
                $('#authButtons').addClass('hidden');
                $('#userMenu').removeClass('hidden');
                $('#userEmail').text(user.email);
                $('#profileEmail').val(user.email);
                
                // Update main nav links
                $('#mainNavLinks').html(`
                    <li class="nav-item"><a class="nav-link" href="#dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="#earn-points">Earn Points</a></li>
                    <li class="nav-item"><a class="nav-link" href="#add-task">Add Task</a></li>
                    <li class="nav-item"><a class="nav-link" href="#account-settings">Account Settings</a></li>
                `);
            } else {
                // User is logged out
                $('#authButtons').removeClass('hidden');
                $('#userMenu').addClass('hidden');
                
                // Update main nav links
                $('#mainNavLinks').html(`
                    <li class="nav-item"><a class="nav-link active" href="#home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#how-it-works">How It Works</a></li>
                    <li class="nav-item"><a class="nav-link" href="#features">Features</a></li>
                    <li class="nav-item"><a class="nav-link" href="#faq">FAQ</a></li>
                `);
            }
        }
        
        // Load user data from Firestore
        function loadUserData(userId) {
            // Unsubscribe from previous listener if exists
            if (userUnsubscribers.length > 0) {
                userUnsubscribers.forEach(unsub => unsub());
                userUnsubscribers = [];
            }
            
            // Set up real-time listener for user data
            const userUnsub = db.collection('users').doc(userId)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        
                        // Update UI with user data
                        $('#userCredits').text(`${userData.credits} Points`);
                        $('#dashboardPoints').text(`${userData.credits} Points`);
                        $('#availablePoints').text(`${userData.credits} points`);
                        
                        $('#tasksCompleted').text(userData.tasksCompleted || 0);
                        $('#tasksCreated').text(userData.tasksCreated || 0);
                        $('#pointsEarned').text(userData.pointsEarned || 0);
                        
                        // Format dates
                        const joinedDate = userData.joinedDate?.toDate();
                        const lastActive = userData.lastActive?.toDate();
                        
                        $('#memberSince').text(joinedDate ? joinedDate.toLocaleDateString() : '-');
                        $('#lastActive').text(lastActive ? lastActive.toLocaleDateString() : '-');
                        
                        // Load profile picture if exists
                        if (userData.profileImage) {
                            $('#userAvatar').attr('src', userData.profileImage);
                            $('#dashboardAvatar').attr('src', userData.profileImage);
                        }
                        
                        // Load username if exists
                        if (userData.username) {
                            $('#dashboardUsername').text(userData.username);
                            $('#profileUsername').val(userData.username);
                        }
                        
                        // Load bio if exists
                        if (userData.bio) {
                            $('#profileBio').val(userData.bio);
                        }
                        
                        // Load notification settings
                        if (userData.notifications) {
                            $('#emailNotifications').prop('checked', userData.notifications.email || false);
                            $('#taskCompletedNotifications').prop('checked', userData.notifications.taskCompleted || false);
                            $('#pointsEarnedNotifications').prop('checked', userData.notifications.pointsEarned || false);
                        }
                        
                        // Load user activities
                        loadUserActivities(userId);
                        
                        // Load user tasks
                        loadUserTasks(userId);
                    } else {
                        console.log('No user data found');
                    }
                }, (error) => {
                    console.error('Error getting user data:', error);
                    showToast('Error loading user data', 'danger');
                });
            
            userUnsubscribers.push(userUnsub);
        }
        
        // Load admin data
        function loadAdminData() {
            // Load stats with real-time updates
            const usersUnsub = db.collection('users').onSnapshot((querySnapshot) => {
                $('#adminTotalUsers').text(querySnapshot.size);
            });
            
            const activeTasksUnsub = db.collection('tasks').where('isActive', '==', true)
                .onSnapshot((querySnapshot) => {
                    $('#adminActiveTasks').text(querySnapshot.size);
                });
            
            const completedTasksUnsub = db.collection('activityLog').where('activityType', '==', 'task_completed')
                .onSnapshot((querySnapshot) => {
                    $('#adminCompletedTasks').text(querySnapshot.size);
                });
            
            // Load recent users with pagination
            loadAdminUsers(1);
            
            // Load recent tasks with pagination
            loadAdminTasks(1);
            
            // Load ad settings
            db.collection('settings').doc('adSettings').get()
                .then((doc) => {
                    if (doc.exists) {
                        const settings = doc.data();
                        $('#adsterraPubId').val(settings.adsterraPubId || '');
                        $('#bannerAdZone').val(settings.bannerAdZone || '');
                        $('#videoAdZone').val(settings.videoAdZone || '');
                        $('#pointsPerAd').val(settings.pointsPerAd || 10);
                    }
                });
            
            // Load general settings
            db.collection('settings').doc('generalSettings').get()
                .then((doc) => {
                    if (doc.exists) {
                        const settings = doc.data();
                        $('#siteName').val(settings.siteName || 'Like4Like');
                        $('#defaultPoints').val(settings.defaultPoints || 100);
                        $('#recaptchaSiteKey').val(settings.recaptchaSiteKey || '');
                        $('#recaptchaSecretKey').val(settings.recaptchaSecretKey || '');
                        
                        // Load site logo if exists
                        if (settings.siteLogo) {
                            $('#siteLogoPreview').attr('src', settings.siteLogo).removeClass('hidden');
                        }
                    }
                });
            
            // Store unsubscribe functions
            userUnsubscribers.push(usersUnsub, activeTasksUnsub, completedTasksUnsub);
        }
        
        // Load admin users with pagination
        function loadAdminUsers(page = 1, searchTerm = '') {
            const limit = 10;
            const offset = (page - 1) * limit;
            
            let query = db.collection('users')
                .orderBy('joinedDate', 'desc')
                .limit(limit);
            
            if (searchTerm) {
                query = query.where('email', '>=', searchTerm)
                            .where('email', '<=', searchTerm + '\uf8ff');
            }
            
            query.get()
                .then((querySnapshot) => {
                    const tbody = $('#adminUsersTable tbody');
                    tbody.empty();
                    
                    if (querySnapshot.empty) {
                        tbody.append('<tr><td colspan="6" class="text-center">No users found</td></tr>');
                    } else {
                        querySnapshot.forEach((doc) => {
                            const user = doc.data();
                            const date = user.joinedDate?.toDate();
                            
                            tbody.append(`
                                <tr>
                                    <td>${doc.id.substring(0, 6)}...</td>
                                    <td>${user.email || '-'}</td>
                                    <td>${user.credits || 0}</td>
                                    <td>${date ? date.toLocaleDateString() : '-'}</td>
                                    <td>
                                        <span class="badge ${user.isAdmin ? 'bg-primary' : 'bg-success'}">
                                            ${user.isAdmin ? 'Admin' : 'User'}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-primary me-1" onclick="editUser('${doc.id}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="showDeleteConfirmation('user', '${doc.id}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                    }
                    
                    // Update pagination
                    updatePagination('usersPagination', page, searchTerm);
                })
                .catch((error) => {
                    console.error('Error loading users:', error);
                    showToast('Error loading users', 'danger');
                });
        }
        
        // Load admin tasks with pagination
        function loadAdminTasks(page = 1, searchTerm = '') {
            const limit = 10;
            const offset = (page - 1) * limit;
            
            let query = db.collection('tasks')
                .orderBy('createdDate', 'desc')
                .limit(limit);
            
            if (searchTerm) {
                query = query.where('platform', '>=', searchTerm)
                            .where('platform', '<=', searchTerm + '\uf8ff');
            }
            
            query.get()
                .then((querySnapshot) => {
                    const tbody = $('#adminTasksTable tbody');
                    tbody.empty();
                    
                    if (querySnapshot.empty) {
                        tbody.append('<tr><td colspan="7" class="text-center">No tasks found</td></tr>');
                    } else {
                        querySnapshot.forEach((doc) => {
                            const task = doc.data();
                            const date = task.createdDate?.toDate();
                            
                            tbody.append(`
                                <tr>
                                    <td>${doc.id.substring(0, 6)}...</td>
                                    <td>${capitalizeFirstLetter(task.taskType)}</td>
                                    <td>${capitalizeFirstLetter(task.platform)}</td>
                                    <td>${task.credits}</td>
                                    <td>${task.creatorEmail || 'Unknown'}</td>
                                    <td>
                                        <span class="badge ${task.isActive ? 'bg-success' : 'bg-secondary'}">
                                            ${task.isActive ? 'Active' : 'Inactive'}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-primary me-1" onclick="editTask('${doc.id}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="showDeleteConfirmation('task', '${doc.id}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                    }
                    
                    // Update pagination
                    updatePagination('tasksPagination', page, searchTerm);
                })
                .catch((error) => {
                    console.error('Error loading tasks:', error);
                    showToast('Error loading tasks', 'danger');
                });
        }
        
        // Update pagination controls
        function updatePagination(type, currentPage, searchTerm = '') {
            const pagination = $(`#${type}`);
            pagination.empty();
            
            // Previous button
            pagination.append(`
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="load${type === 'usersPagination' ? 'AdminUsers' : 'AdminTasks'}(${currentPage - 1}, '${searchTerm}')">
                        &laquo;
                    </a>
                </li>
            `);
            
            // Page numbers (simplified - in real app you'd calculate total pages)
            for (let i = 1; i <= 5; i++) {
                pagination.append(`
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="load${type === 'usersPagination' ? 'AdminUsers' : 'AdminTasks'}(${i}, '${searchTerm}')">${i}</a>
                    </li>
                `);
            }
            
            // Next button
            pagination.append(`
                <li class="page-item">
                    <a class="page-link" href="#" onclick="load${type === 'usersPagination' ? 'AdminUsers' : 'AdminTasks'}(${currentPage + 1}, '${searchTerm}')">
                        &raquo;
                    </a>
                </li>
            `);
        }
        
        // Load user activities
        function loadUserActivities(userId) {
            const activityUnsub = db.collection('activityLog')
                .where('userId', '==', userId)
                .orderBy('timestamp', 'desc')
                .limit(10)
                .onSnapshot((querySnapshot) => {
                    const tbody = $('#activityTable tbody');
                    tbody.empty();
                    
                    if (querySnapshot.empty) {
                        tbody.append('<tr><td colspan="3" class="text-center">No activities found</td></tr>');
                    } else {
                        querySnapshot.forEach((doc) => {
                            const activity = doc.data();
                            const date = activity.timestamp?.toDate();
                            
                            tbody.append(`
                                <tr>
                                    <td>${date ? date.toLocaleString() : '-'}</td>
                                    <td>${activity.details || activity.activityType}</td>
                                    <td class="${activity.creditsChange > 0 ? 'text-success' : 'text-danger'}">
                                        ${activity.creditsChange > 0 ? '+' : ''}${activity.creditsChange}
                                    </td>
                                </tr>
                            `);
                        });
                    }
                }, (error) => {
                    console.error('Error loading activities:', error);
                    showToast('Error loading activities', 'danger');
                });
            
            userUnsubscribers.push(activityUnsub);
        }
        
        // Load user tasks
        function loadUserTasks(userId) {
            const tasksUnsub = db.collection('tasks')
                .where('creatorId', '==', userId)
                .orderBy('createdDate', 'desc')
                .onSnapshot((querySnapshot) => {
                    const tbody = $('#myTasksTable tbody');
                    tbody.empty();
                    
                    if (querySnapshot.empty) {
                        tbody.append('<tr><td colspan="6" class="text-center">No tasks found</td></tr>');
                    } else {
                        querySnapshot.forEach((doc) => {
                            const task = doc.data();
                            const date = task.createdDate?.toDate();
                            
                            tbody.append(`
                                <tr>
                                    <td>${capitalizeFirstLetter(task.taskType)}</td>
                                    <td>${capitalizeFirstLetter(task.platform)}</td>
                                    <td><a href="${task.targetUrl}" target="_blank">View</a></td>
                                    <td>${task.credits}</td>
                                    <td>
                                        <span class="badge ${task.isActive ? 'bg-success' : 'bg-secondary'}">
                                            ${task.isActive ? 'Active' : 'Inactive'}
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-danger" onclick="showDeleteConfirmation('task', '${doc.id}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `);
                        });
                    }
                }, (error) => {
                    console.error('Error loading user tasks:', error);
                    showToast('Error loading your tasks', 'danger');
                });
            
            taskUnsubscribers.push(tasksUnsub);
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation links
            $(document).on('click', 'a[href^="#"]', function(e) {
                e.preventDefault();
                const target = $(this).attr('href').substring(1);
                navigateTo(target);
            });
            
            // Auth buttons
            $('#loginBtn, #heroRegisterBtn, #registerBtn, #bottomRegisterBtn').click(function() {
                showAuthSection();
            });
            
            // Login form
            $('#loginForm').submit(function(e) {
                e.preventDefault();
                const email = $('#loginEmail').val();
                const password = $('#loginPassword').val();
                loginUser(email, password);
            });
            
            // Register form
            $('#registerForm').submit(function(e) {
                e.preventDefault();
                const email = $('#registerEmail').val();
                const password = $('#registerPassword').val();
                const confirmPassword = $('#registerPasswordConfirm').val();
                
                if (password !== confirmPassword) {
                    $('#registerPasswordConfirm').addClass('is-invalid');
                    $('#registerPasswordConfirm').next('.invalid-feedback').text('Passwords must match').show();
                    return;
                }
                
                if (!checkPasswordStrength(password)) {
                    showToast('Password must be at least 8 characters and include uppercase, lowercase, number, and special character', 'danger');
                    return;
                }
                
                registerUser(email, password);
            });
            
            // Reset password form
            $('#resetPasswordForm').submit(function(e) {
                e.preventDefault();
                const email = $('#resetEmail').val();
                resetPassword(email);
            });
            
            // Logout button
            $('#logoutBtn, #adminLogoutBtn').click(function() {
                logoutUser();
            });
            
            // Add task form
            $('#addTaskForm').submit(function(e) {
                e.preventDefault();
                if (!currentUser) return;
                
                if (!validateUrl($('#targetUrl'))) {
                    return;
                }
                
                // Check for duplicate tasks
                const taskUrl = $('#targetUrl').val();
                db.collection('tasks')
                    .where('creatorId', '==', currentUser.uid)
                    .where('targetUrl', '==', taskUrl)
                    .get()
                    .then((querySnapshot) => {
                        if (!querySnapshot.empty) {
                            throw new Error('You already have a task with this URL');
                        }
                        
                        const taskData = {
                            creatorId: currentUser.uid,
                            creatorEmail: currentUser.email,
                            taskType: $('#taskType').val(),
                            platform: $('#platform').val(),
                            targetUrl: taskUrl,
                            credits: parseInt($('#taskCredits').val()),
                            instructions: $('#taskInstructions').val(),
                            completedCount: 0,
                            isActive: true,
                            createdDate: firebase.firestore.FieldValue.serverTimestamp()
                        };
                        
                        return createNewTask(taskData);
                    })
                    .catch((error) => {
                        showLoading(false);
                        console.error('Error creating task:', error);
                        showToast(error.message || 'Error creating task', 'danger');
                    });
            });
            
            // Refresh buttons
            $('#refreshActivity').click(function() {
                if (currentUser) loadUserActivities(currentUser.uid);
            });
            
            $('#refreshMyTasks').click(function() {
                if (currentUser) loadUserTasks(currentUser.uid);
            });
            
            $('#refreshTasks').click(function() {
                loadAvailableTasks();
            });
            
            // Task filter
            $('.filter-task').click(function(e) {
                e.preventDefault();
                const filter = $(this).data('filter');
                loadAvailableTasks(filter);
            });
            
            // Start task button
            $('#startTaskBtn').click(function() {
                if (!currentTask) return;
                
                $('#taskModal').modal('hide');
                startTask(currentTask);
            });
            
            // Complete task button
            $('#completeTaskBtn').click(function() {
                if (!currentTask || !currentUser) return;
                completeTask(currentTask.id, currentUser.uid);
            });
            
            // Skip task button
            $('#skipTaskBtn').click(function() {
                if (!currentTask || !currentUser) return;
                skipTask();
            });
            
            // Complete ad button
            $('#completeAdBtn').click(function() {
                if (!currentUser) return;
                
                // Verify ad was watched (in a real app, you'd have actual verification)
                const adWatched = confirm("Did you watch the entire ad?");
                if (!adWatched) {
                    showToast('Please watch the entire ad to earn points', 'warning');
                    return;
                }
                
                const pointsToAdd = 10;
                
                db.collection('users').doc(currentUser.uid).update({
                    credits: firebase.firestore.FieldValue.increment(pointsToAdd),
                    pointsEarned: firebase.firestore.FieldValue.increment(pointsToAdd)
                })
                .then(() => {
                    // Log activity
                    return logActivity(currentUser.uid, 'ad_watched', pointsToAdd, 'Watched advertisement');
                })
                .then(() => {
                    showToast(`You earned ${pointsToAdd} points for watching the ad!`, 'success');
                    
                    // Reload user data to update points display
                    loadUserData(currentUser.uid);
                    
                    // Track ad completion for revenue
                    trackAdCompletion('video');
                })
                .catch((error) => {
                    console.error('Error awarding ad points:', error);
                    showToast('Error processing ad reward', 'danger');
                });
            });
            
            // Profile form
            $('#profileForm').submit(function(e) {
                e.preventDefault();
                if (!currentUser) return;
                
                const profileData = {
                    username: $('#profileUsername').val(),
                    bio: $('#profileBio').val(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Handle file upload if present
                const fileInput = $('#profileAvatar')[0];
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    
                    // Validate file size and type
                    if (file.size > 2 * 1024 * 1024) { // 2MB
                        showToast('File size must be less than 2MB', 'danger');
                        return;
                    }
                    
                    if (!['image/jpeg', 'image/png'].includes(file.type)) {
                        showToast('Only JPG and PNG images are allowed', 'danger');
                        return;
                    }
                    
                    const storageRef = storage.ref(`profile_images/${currentUser.uid}`);
                    const uploadTask = storageRef.put(file);
                    
                    showLoading(true);
                    
                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            // Progress monitoring can be added here
                        }, 
                        (error) => {
                            showLoading(false);
                            console.error('Error uploading image:', error);
                            showToast('Error uploading profile picture', 'danger');
                        }, 
                        () => {
                            // Upload completed successfully
                            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                profileData.profileImage = downloadURL;
                                
                                // Update profile in Firestore
                                db.collection('users').doc(currentUser.uid).update(profileData)
                                    .then(() => {
                                        showLoading(false);
                                        showToast('Profile updated successfully', 'success');
                                        logActivity(currentUser.uid, 'profile_update', 0, 'User updated profile');
                                        
                                        // Send email notification if enabled
                                        sendEmailNotification(
                                            currentUser.email,
                                            'Profile Updated',
                                            'Your profile has been successfully updated. If you did not make this change, please contact support immediately.'
                                        );
                                    })
                                    .catch((error) => {
                                        showLoading(false);
                                        console.error('Error updating profile:', error);
                                        showToast('Error updating profile', 'danger');
                                    });
                            });
                        }
                    );
                } else {
                    // No file to upload, just update profile
                    showLoading(true);
                    
                    db.collection('users').doc(currentUser.uid).update(profileData)
                        .then(() => {
                            showLoading(false);
                            showToast('Profile updated successfully', 'success');
                            logActivity(currentUser.uid, 'profile_update', 0, 'User updated profile');
                        })
                        .catch((error) => {
                            showLoading(false);
                            console.error('Error updating profile:', error);
                            showToast('Error updating profile', 'danger');
                        });
                }
            });
            
            // Password form
            $('#passwordForm').submit(function(e) {
                e.preventDefault();
                if (!currentUser) return;
                
                const currentPassword = $('#currentPassword').val();
                const newPassword = $('#newPassword').val();
                const confirmPassword = $('#confirmPassword').val();
                
                if (newPassword !== confirmPassword) {
                    $('#confirmPassword').addClass('is-invalid');
                    $('#confirmPassword').next('.invalid-feedback').text('Passwords must match').show();
                    return;
                }
                
                if (!checkPasswordStrength(newPassword)) {
                    showToast('Password must be at least 8 characters and include uppercase, lowercase, number, and special character', 'danger');
                    return;
                }
                
                // Reauthenticate user
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email, 
                    currentPassword
                );
                
                showLoading(true);
                
                currentUser.reauthenticateWithCredential(credential)
                    .then(() => {
                        // Update password
                        currentUser.updatePassword(newPassword)
                            .then(() => {
                                showLoading(false);
                                showToast('Password updated successfully', 'success');
                                logActivity(currentUser.uid, 'password_change', 0, 'User changed password');
                                $('#passwordForm')[0].reset();
                                
                                // Send email notification
                                sendEmailNotification(
                                    currentUser.email,
                                    'Password Changed',
                                    'Your password has been successfully changed. If you did not make this change, please contact support immediately.'
                                );
                            })
                            .catch((error) => {
                                showLoading(false);
                                console.error('Error updating password:', error);
                                showToast('Error updating password', 'danger');
                            });
                    })
                    .catch((error) => {
                        showLoading(false);
                        console.error('Error reauthenticating:', error);
                        showToast('Current password is incorrect', 'danger');
                    });
            });
            
            // Notifications form
            $('#notificationsForm').submit(function(e) {
                e.preventDefault();
                if (!currentUser) return;
                
                const notificationSettings = {
                    email: $('#emailNotifications').is(':checked'),
                    taskCompleted: $('#taskCompletedNotifications').is(':checked'),
                    pointsEarned: $('#pointsEarnedNotifications').is(':checked'),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading(true);
                
                db.collection('users').doc(currentUser.uid).update({
                    notifications: notificationSettings
                })
                .then(() => {
                    showLoading(false);
                    showToast('Notification settings saved', 'success');
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error saving notification settings:', error);
                    showToast('Error saving settings', 'danger');
                });
            });
            
            // Admin navigation
            $('#adminDashboardLink').click(function(e) {
                e.preventDefault();
                $('.admin-content-section').addClass('hidden');
                $('#adminDashboard').removeClass('hidden');
                $(this).addClass('active').siblings().removeClass('active');
            });
            
            $('#adminUsersLink').click(function(e) {
                e.preventDefault();
                $('.admin-content-section').addClass('hidden');
                $('#adminUsers').removeClass('hidden');
                $(this).addClass('active').siblings().removeClass('active');
            });
            
            $('#adminTasksLink').click(function(e) {
                e.preventDefault();
                $('.admin-content-section').addClass('hidden');
                $('#adminTasks').removeClass('hidden');
                $(this).addClass('active').siblings().removeClass('active');
            });
            
            $('#adminAdsLink').click(function(e) {
                e.preventDefault();
                $('.admin-content-section').addClass('hidden');
                $('#adminAds').removeClass('hidden');
                $(this).addClass('active').siblings().removeClass('active');
            });
            
            $('#adminSettingsLink').click(function(e) {
                e.preventDefault();
                $('.admin-content-section').addClass('hidden');
                $('#adminSettings').removeClass('hidden');
                $(this).addClass('active').siblings().removeClass('active');
            });
            
            // Admin ad settings form
            $('#adminAdSettingsForm').submit(function(e) {
                e.preventDefault();
                const adSettings = {
                    adsterraPubId: $('#adsterraPubId').val(),
                    bannerAdZone: $('#bannerAdZone').val(),
                    videoAdZone: $('#videoAdZone').val(),
                    pointsPerAd: parseInt($('#pointsPerAd').val()),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading(true);
                
                db.collection('settings').doc('adSettings').set(adSettings, { merge: true })
                    .then(() => {
                        showLoading(false);
                        showToast('Ad settings saved successfully', 'success');
                        loadAdsterraAds(); // Reload ads with new settings
                    })
                    .catch((error) => {
                        showLoading(false);
                        console.error('Error saving ad settings:', error);
                        showToast('Error saving ad settings', 'danger');
                    });
            });
            
            // Admin general settings form
            $('#adminGeneralSettingsForm').submit(function(e) {
                e.preventDefault();
                const generalSettings = {
                    siteName: $('#siteName').val(),
                    defaultPoints: parseInt($('#defaultPoints').val()),
                    recaptchaSiteKey: $('#recaptchaSiteKey').val(),
                    recaptchaSecretKey: $('#recaptchaSecretKey').val(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading(true);
                
                // Handle site logo upload if present
                const fileInput = $('#siteLogo')[0];
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    
                    // Validate file size and type
                    if (file.size > 2 * 1024 * 1024) { // 2MB
                        showToast('File size must be less than 2MB', 'danger');
                        showLoading(false);
                        return;
                    }
                    
                    if (!['image/jpeg', 'image/png'].includes(file.type)) {
                        showToast('Only JPG and PNG images are allowed', 'danger');
                        showLoading(false);
                        return;
                    }
                    
                    const storageRef = storage.ref('site_logo/logo');
                    const uploadTask = storageRef.put(file);
                    
                    uploadTask.on('state_changed', 
                        (snapshot) => {
                            // Progress monitoring can be added here
                        }, 
                        (error) => {
                            showLoading(false);
                            console.error('Error uploading logo:', error);
                            showToast('Error uploading site logo', 'danger');
                        }, 
                        () => {
                            // Upload completed successfully
                            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                generalSettings.siteLogo = downloadURL;
                                saveGeneralSettings(generalSettings);
                            });
                        }
                    );
                } else {
                    saveGeneralSettings(generalSettings);
                }
            });
            
            // Admin add user button
            $('#adminAddUserBtn').click(function() {
                $('#addUserModal').modal('show');
            });
            
            // Confirm add user
            $('#confirmAddUserBtn').click(function() {
                const email = $('#adminUserEmail').val();
                const password = $('#adminUserPassword').val();
                const confirmPassword = $('#adminUserPasswordConfirm').val();
                const name = $('#adminUserName').val();
                const credits = parseInt($('#adminUserCredits').val());
                const role = $('#adminUserRole').val();
                
                if (password !== confirmPassword) {
                    $('#adminUserPasswordConfirm').addClass('is-invalid');
                    $('#adminUserPasswordConfirm').next('.invalid-feedback').text('Passwords must match').show();
                    return;
                }
                
                if (!checkPasswordStrength(password)) {
                    showToast('Password must be at least 8 characters and include uppercase, lowercase, number, and special character', 'danger');
                    return;
                }
                
                showLoading(true);
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Create user document in Firestore
                        return db.collection('users').doc(userCredential.user.uid).set({
                            email: email,
                            username: name,
                            credits: credits,
                            joinedDate: firebase.firestore.FieldValue.serverTimestamp(),
                            lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                            tasksCompleted: 0,
                            tasksCreated: 0,
                            pointsEarned: 0,
                            isAdmin: role === 'admin'
                        });
                    })
                    .then(() => {
                        showLoading(false);
                        $('#addUserModal').modal('hide');
                        showToast('User created successfully', 'success');
                        loadAdminUsers(1);
                        
                        // Send welcome email
                        sendEmailNotification(
                            email,
                            'Welcome to Like4Like',
                            `Hello ${name},\n\nYour account has been created successfully. You have received ${credits} starting points.\n\nThank you for joining our community!`
                        );
                    })
                    .catch((error) => {
                        showLoading(false);
                        console.error('Error creating user:', error);
                        
                        let errorMessage = 'User creation failed';
                        switch (error.code) {
                            case 'auth/email-already-in-use':
                                errorMessage = 'Email already in use';
                                break;
                            case 'auth/invalid-email':
                                errorMessage = 'Invalid email address';
                                break;
                            case 'auth/weak-password':
                                errorMessage = 'Password should be at least 6 characters';
                                break;
                        }
                        
                        showToast(errorMessage, 'danger');
                    });
            });
            
            // Admin add task button
            $('#adminAddTaskBtn').click(function() {
                $('#addAdminTaskModal').modal('show');
            });
            
            // Confirm add admin task
            $('#confirmAddAdminTaskBtn').click(function() {
                if (!validateUrl($('#adminTaskUrl'))) {
                    return;
                }
                
                const taskData = {
                    taskType: $('#adminTaskType').val(),
                    platform: $('#adminTaskPlatform').val(),
                    targetUrl: $('#adminTaskUrl').val(),
                    credits: parseInt($('#adminTaskCredits').val()),
                    instructions: $('#adminTaskInstructions').val(),
                    completedCount: 0,
                    isActive: $('#adminTaskStatus').val() === 'active',
                    createdDate: firebase.firestore.FieldValue.serverTimestamp(),
                    creatorId: 'admin',
                    creatorEmail: 'admin@like4like.com'
                };
                
                showLoading(true);
                
                db.collection('tasks').add(taskData)
                    .then(() => {
                        showLoading(false);
                        $('#addAdminTaskModal').modal('hide');
                        showToast('Task created successfully', 'success');
                        loadAdminTasks(1);
                    })
                    .catch((error) => {
                        showLoading(false);
                        console.error('Error creating task:', error);
                        showToast('Error creating task', 'danger');
                    });
            });
            
            // Admin user search
            $('#adminUserSearch').on('input', function() {
                const searchTerm = $(this).val();
                loadAdminUsers(1, searchTerm);
            });
            
            // Admin task search
            $('#adminTaskSearch').on('input', function() {
                const searchTerm = $(this).val();
                loadAdminTasks(1, searchTerm);
            });
            
            // Confirm delete button
            $('#confirmDeleteBtn').click(function() {
                const type = $(this).data('type');
                const id = $(this).data('id');
                
                if (type === 'user') {
                    deleteUser(id);
                } else if (type === 'task') {
                    deleteTask(id);
                }
                
                $('#confirmDeleteModal').modal('hide');
            });
        }
        
        // Save general settings
        function saveGeneralSettings(settings) {
            db.collection('settings').doc('generalSettings').set(settings, { merge: true })
                .then(() => {
                    showLoading(false);
                    showToast('Settings saved successfully', 'success');
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error saving settings:', error);
                    showToast('Error saving settings', 'danger');
                });
        }
        
        // Show authentication section
        function showAuthSection() {
            showSection('authSection');
            $('#login').removeClass('hidden');
            $('#register').addClass('hidden');
            $('#reset').addClass('hidden');
            $('#loginEmail').focus();
        }
        
        // Navigate to section
        function navigateTo(target) {
            // Rate limiting check
            const now = Date.now();
            if (now - lastActionTime < actionDelay) {
                showToast('Please wait a moment before performing another action', 'warning');
                return;
            }
            lastActionTime = now;
            
            if (isAdmin) {
                // Handle admin panel navigation
                switch (target) {
                    case 'admin-dashboard':
                        $('.admin-content-section').addClass('hidden');
                        $('#adminDashboard').removeClass('hidden');
                        $('#adminDashboardLink').addClass('active').siblings().removeClass('active');
                        break;
                    case 'admin-users':
                        $('.admin-content-section').addClass('hidden');
                        $('#adminUsers').removeClass('hidden');
                        $('#adminUsersLink').addClass('active').siblings().removeClass('active');
                        break;
                    case 'admin-tasks':
                        $('.admin-content-section').addClass('hidden');
                        $('#adminTasks').removeClass('hidden');
                        $('#adminTasksLink').addClass('active').siblings().removeClass('active');
                        break;
                    case 'admin-ads':
                        $('.admin-content-section').addClass('hidden');
                        $('#adminAds').removeClass('hidden');
                        $('#adminAdsLink').addClass('active').siblings().removeClass('active');
                        break;
                    case 'admin-settings':
                        $('.admin-content-section').addClass('hidden');
                        $('#adminSettings').removeClass('hidden');
                        $('#adminSettingsLink').addClass('active').siblings().removeClass('active');
                        break;
                }
                return;
            }
            
            switch (target) {
                case 'login':
                case 'register':
                    showAuthSection();
                    $(`#${target}`).removeClass('hidden');
                    break;
                case 'dashboard':
                    if (currentUser) {
                        showSection('dashboardSection');
                    } else {
                        showAuthSection();
                    }
                    break;
                case 'earn-points':
                    if (currentUser) {
                        showSection('earnPointsSection');
                        loadAvailableTasks();
                    } else {
                        showAuthSection();
                    }
                    break;
                case 'add-task':
                    if (currentUser) {
                        showSection('addTaskSection');
                    } else {
                        showAuthSection();
                    }
                    break;
                case 'account-settings':
                    if (currentUser) {
                        showSection('accountSettingsSection');
                    } else {
                        showAuthSection();
                    }
                    break;
                default:
                    showSection(target + 'Section');
                    break;
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
        }
        
        // Show section and hide others
        function showSection(sectionId) {
            $('section').addClass('hidden');
            $(`#${sectionId}`).removeClass('hidden');
            
            // Update active nav link
            $('.nav-link').removeClass('active');
            $(`.nav-link[href="#${sectionId.replace('Section', '')}"]`).addClass('active');
        }
        
        // User login
        function loginUser(email, password) {
            showLoading(true);
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    showLoading(false);
                    showToast('Login successful', 'success');
                    
                    // Update last active time
                    db.collection('users').doc(userCredential.user.uid).update({
                        lastActive: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Login error:', error);
                    
                    let errorMessage = 'Login failed';
                    switch (error.code) {
                        case 'auth/invalid-email':
                            errorMessage = 'Invalid email address';
                            break;
                        case 'auth/user-disabled':
                            errorMessage = 'Account disabled';
                            break;
                        case 'auth/user-not-found':
                            errorMessage = 'User not found';
                            break;
                        case 'auth/wrong-password':
                            errorMessage = 'Incorrect password';
                            break;
                    }
                    
                    showToast(errorMessage, 'danger');
                });
        }
        
        // User registration
        function registerUser(email, password) {
            showLoading(true);
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Create user document in Firestore
                    return db.collection('users').doc(userCredential.user.uid).set({
                        email: email,
                        username: $('#registerName').val(),
                        credits: 100, // Starting bonus
                        joinedDate: firebase.firestore.FieldValue.serverTimestamp(),
                        lastActive: firebase.firestore.FieldValue.serverTimestamp(),
                        tasksCompleted: 0,
                        tasksCreated: 0,
                        pointsEarned: 0,
                        isAdmin: false // Only set to true for specific admin accounts
                    });
                })
                .then(() => {
                    showLoading(false);
                    showToast('Registration successful! You received 100 bonus points.', 'success');
                    
                    // Log activity
                    logActivity(auth.currentUser.uid, 'registration', 100, 'New user registration');
                    
                    // Send welcome email
                    sendEmailNotification(
                        email,
                        'Welcome to Like4Like',
                        `Hello ${$('#registerName').val()},\n\nThank you for registering with Like4Like! You have received 100 starting points to begin growing your social media presence.\n\nGet started by completing tasks to earn more points or create your own tasks to get engagement on your content.\n\nHappy growing!\n\nThe Like4Like Team`
                    );
                    
                    // Switch to login tab
                    $('#login').removeClass('hidden');
                    $('#register').addClass('hidden');
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Registration error:', error);
                    
                    let errorMessage = 'Registration failed';
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'Email already in use';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = 'Invalid email address';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'Password should be at least 6 characters';
                            break;
                    }
                    
                    showToast(errorMessage, 'danger');
                });
        }
        
        // Reset password
        function resetPassword(email) {
            showLoading(true);
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showLoading(false);
                    showToast('Password reset email sent. Please check your inbox.', 'success');
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Password reset error:', error);
                    
                    let errorMessage = 'Error sending reset email';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No user found with this email';
                    }
                    
                    showToast(errorMessage, 'danger');
                });
        }
        
        // User logout
        function logoutUser() {
            showLoading(true);
            
            auth.signOut()
                .then(() => {
                    showLoading(false);
                    showToast('Logged out successfully', 'success');
                    showSection('home');
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Logout error:', error);
                    showToast('Error logging out', 'danger');
                });
        }
        
        // Create new task
        function createNewTask(taskData) {
            if (!currentUser) return;
            
            showLoading(true);
            
            // Verify user has enough points
            db.collection('users').doc(currentUser.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.credits >= taskData.credits) {
                            // Create task
                            return db.collection('tasks').add(taskData);
                        } else {
                            throw new Error('You don\'t have enough points to create this task');
                        }
                    } else {
                        throw new Error('User data not found');
                    }
                })
                .then(() => {
                    // Deduct points from user
                    return db.collection('users').doc(currentUser.uid).update({
                        credits: firebase.firestore.FieldValue.increment(-taskData.credits),
                        tasksCreated: firebase.firestore.FieldValue.increment(1)
                    });
                })
                .then(() => {
                    showLoading(false);
                    showToast('Task created successfully!', 'success');
                    
                    // Log activity
                    logActivity(currentUser.uid, 'task_created', -taskData.credits, 
                        `Created ${taskData.taskType} task for ${taskData.platform}`);
                    
                    // Reset form
                    $('#addTaskForm')[0].reset();
                    
                    // Reload user tasks
                    loadUserTasks(currentUser.uid);
                    
                    // Navigate to tasks section
                    navigateTo('add-task');
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error creating task:', error);
                    showToast(error.message || 'Error creating task', 'danger');
                });
        }
        
        // Show delete confirmation
        function showDeleteConfirmation(type, id) {
            let message = '';
            if (type === 'user') {
                message = 'Are you sure you want to delete this user? This action cannot be undone.';
            } else if (type === 'task') {
                message = 'Are you sure you want to delete this task? Any points spent will be refunded.';
            }
            
            $('#deleteModalMessage').text(message);
            $('#confirmDeleteBtn').data('type', type).data('id', id);
            $('#confirmDeleteModal').modal('show');
        }
        
        // Delete task
        function deleteTask(taskId) {
            if (!currentUser) return;
            
            showLoading(true);
            
            db.collection('tasks').doc(taskId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const task = doc.data();
                        
                        // Verify user owns the task or is admin
                        if (task.creatorId === currentUser.uid || isAdmin) {
                            // Delete task
                            return db.collection('tasks').doc(taskId).delete()
                                .then(() => {
                                    // Refund points if task was active and user is not admin
                                    if (task.isActive && !isAdmin) {
                                        return db.collection('users').doc(task.creatorId).update({
                                            credits: firebase.firestore.FieldValue.increment(task.credits),
                                            tasksCreated: firebase.firestore.FieldValue.increment(-1)
                                        });
                                    }
                                    return null;
                                });
                        } else {
                            throw new Error('You can only delete your own tasks');
                        }
                    } else {
                        throw new Error('Task not found');
                    }
                })
                .then(() => {
                    showLoading(false);
                    showToast('Task deleted successfully', 'success');
                    
                    // Log activity
                    if (!isAdmin) {
                        logActivity(currentUser.uid, 'task_deleted', task.credits, 
                            `Deleted ${task.taskType} task for ${task.platform}`);
                    }
                    
                    // Reload tasks
                    if (isAdmin) {
                        loadAdminTasks(1);
                    } else {
                        loadUserTasks(currentUser.uid);
                    }
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error deleting task:', error);
                    showToast(error.message || 'Error deleting task', 'danger');
                });
        }
        
        // Delete user (admin)
        function deleteUser(userId) {
            showLoading(true);
            
            // In a full implementation, you would also delete the auth record
            db.collection('users').doc(userId).delete()
                .then(() => {
                    showLoading(false);
                    showToast('User deleted successfully', 'success');
                    loadAdminUsers(1);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error deleting user:', error);
                    showToast('Error deleting user', 'danger');
                });
        }
        
        // Edit task (admin)
        function editTask(taskId) {
            showLoading(true);
            
            db.collection('tasks').doc(taskId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const task = doc.data();
                        
                        // Populate the add task modal with existing data
                        $('#adminTaskType').val(task.taskType);
                        $('#adminTaskPlatform').val(task.platform);
                        $('#adminTaskUrl').val(task.targetUrl);
                        $('#adminTaskCredits').val(task.credits);
                        $('#adminTaskInstructions').val(task.instructions || '');
                        $('#adminTaskStatus').val(task.isActive ? 'active' : 'inactive');
                        
                        // Change modal title and button
                        $('#addAdminTaskModal .modal-title').text('Edit Task');
                        $('#confirmAddAdminTaskBtn').text('Update Task').data('taskId', taskId);
                        
                        // Show modal
                        $('#addAdminTaskModal').modal('show');
                    } else {
                        showToast('Task not found', 'danger');
                    }
                    
                    showLoading(false);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error loading task:', error);
                    showToast('Error loading task', 'danger');
                });
        }
        
        // Edit user (admin)
        function editUser(userId) {
            showLoading(true);
            
            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const user = doc.data();
                        
                        // Populate the add user modal with existing data
                        $('#adminUserEmail').val(user.email).prop('disabled', true);
                        $('#adminUserName').val(user.username || '');
                        $('#adminUserCredits').val(user.credits || 100);
                        $('#adminUserRole').val(user.isAdmin ? 'admin' : 'user');
                        
                        // Change modal title and button
                        $('#addUserModal .modal-title').text('Edit User');
                        $('#confirmAddUserBtn').text('Update User').data('userId', userId);
                        
                        // Hide password fields (they'll be managed separately)
                        $('#adminUserPassword').closest('.mb-3').hide();
                        $('#adminUserPasswordConfirm').closest('.mb-3').hide();
                        
                        // Show modal
                        $('#addUserModal').modal('show');
                    } else {
                        showToast('User not found', 'danger');
                    }
                    
                    showLoading(false);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error loading user:', error);
                    showToast('Error loading user', 'danger');
                });
        }
        
        // Load available tasks with optional filter
        function loadAvailableTasks(filter = 'all') {
            if (!currentUser) return;
            
            showLoading(true);
            
            let query = db.collection('tasks')
                .where('isActive', '==', true)
                .where('creatorId', '!=', currentUser.uid) // Don't show user's own tasks
                .orderBy('createdDate', 'desc')
                .limit(50);
            
            if (filter !== 'all') {
                query = query.where('taskType', '==', filter);
            }
            
            query.get()
                               .then((querySnapshot) => {
                    const tasksList = $('#tasksList');
                    tasksList.empty();
                    
                    if (querySnapshot.empty) {
                        tasksList.html(`
                            <div class="alert alert-info">
                                No tasks available at the moment. Please check back later.
                            </div>
                        `);
                    } else {
                        querySnapshot.forEach((doc) => {
                            const task = doc.data();
                            const date = task.createdDate?.toDate();
                            
                            tasksList.append(`
                                <div class="card task-item mb-3">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start">
                                            <div>
                                                <h5 class="card-title">${capitalizeFirstLetter(task.taskType)} on ${capitalizeFirstLetter(task.platform)}</h5>
                                                <p class="card-text text-muted">
                                                    <small>Posted: ${date ? date.toLocaleString() : '-'}</small>
                                                </p>
                                                <p class="card-text">
                                                    ${task.instructions || 'No special instructions provided.'}
                                                </p>
                                            </div>
                                            <div class="text-end">
                                                <div class="points-badge mb-2">${task.credits} Points</div>
                                                <button class="btn btn-primary btn-sm" onclick="showTaskDetails('${doc.id}')">
                                                    <i class="fas fa-play me-1"></i> Start
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `);
                        });
                    }
                    
                    showLoading(false);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error loading tasks:', error);
                    showToast('Error loading tasks', 'danger');
                });
        }
        
        // Show task details modal
        function showTaskDetails(taskId) {
            showLoading(true);
            
            db.collection('tasks').doc(taskId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const task = doc.data();
                        currentTask = { id: doc.id, ...task };
                        
                        // Populate modal with task details
                        $('#taskModalTitle').text(`${capitalizeFirstLetter(task.taskType)} Task`);
                        $('#taskModalPlatform').text(capitalizeFirstLetter(task.platform));
                        $('#taskModalPoints').text(task.credits);
                        $('#taskModalUrl').text(task.targetUrl).attr('href', task.targetUrl);
                        $('#taskModalInstructions').text(task.instructions || 'None');
                        
                        // Show modal
                        $('#taskModal').modal('show');
                    } else {
                        showToast('Task not found', 'danger');
                    }
                    
                    showLoading(false);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error loading task details:', error);
                    showToast('Error loading task details', 'danger');
                });
        }
        
        // Start a task
        function startTask(task) {
            if (!currentUser) return;
            
            showLoading(true);
            
            // Verify task is still available
            db.collection('tasks').doc(task.id).get()
                .then((doc) => {
                    if (!doc.exists || !doc.data().isActive) {
                        throw new Error('This task is no longer available');
                    }
                    
                    // Show current task card
                    $('#currentTaskCard').removeClass('hidden');
                    
                    // Update UI with task details
                    $('#currentTaskTitle').text(`${capitalizeFirstLetter(task.taskType)} on ${capitalizeFirstLetter(task.platform)}`);
                    $('#currentTaskPlatform').text(`Platform: ${capitalizeFirstLetter(task.platform)}`);
                    $('#currentTaskDescription').text(task.instructions || 'No special instructions provided.');
                    $('#currentTaskLink').attr('href', task.targetUrl);
                    
                    // Start countdown timer
                    startCountdown();
                    
                    showLoading(false);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error starting task:', error);
                    showToast(error.message || 'Error starting task', 'danger');
                    currentTask = null;
                });
        }
        
        // Start countdown timer
        function startCountdown() {
            countdownSeconds = 30;
            updateCountdownDisplay();
            
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            countdownInterval = setInterval(() => {
                countdownSeconds--;
                updateCountdownDisplay();
                
                if (countdownSeconds <= 0) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                    showToast('Time is up! Please complete or skip the task.', 'warning');
                }
            }, 1000);
        }
        
        // Update countdown display
        function updateCountdownDisplay() {
            const minutes = Math.floor(countdownSeconds / 60);
            const seconds = countdownSeconds % 60;
            $('#countdownTimer').text(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
        }
        
        // Complete a task
        function completeTask(taskId, userId) {
            if (!currentUser || !currentTask) return;
            
            showLoading(true);
            
            // Verify task is still active
            db.collection('tasks').doc(taskId).get()
                .then((doc) => {
                    if (!doc.exists || !doc.data().isActive) {
                        throw new Error('This task is no longer available');
                    }
                    
                    // Create a task completion record
                    const completionData = {
                        taskId: taskId,
                        userId: userId,
                        completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        creditsEarned: currentTask.credits
                    };
                    
                    return db.collection('taskCompletions').add(completionData);
                })
                .then(() => {
                    // Update task completion count
                    return db.collection('tasks').doc(taskId).update({
                        completedCount: firebase.firestore.FieldValue.increment(1)
                    });
                })
                .then(() => {
                    // Award points to user
                    return db.collection('users').doc(userId).update({
                        credits: firebase.firestore.FieldValue.increment(currentTask.credits),
                        tasksCompleted: firebase.firestore.FieldValue.increment(1),
                        pointsEarned: firebase.firestore.FieldValue.increment(currentTask.credits)
                    });
                })
                .then(() => {
                    // Log activity
                    return logActivity(userId, 'task_completed', currentTask.credits, 
                        `Completed ${currentTask.taskType} task on ${currentTask.platform}`);
                })
                .then(() => {
                    showLoading(false);
                    showToast(`Task completed! You earned ${currentTask.credits} points.`, 'success');
                    
                    // Reset current task
                    resetCurrentTask();
                    
                    // Reload available tasks
                    loadAvailableTasks();
                    
                    // Reload user data
                    loadUserData(userId);
                })
                .catch((error) => {
                    showLoading(false);
                    console.error('Error completing task:', error);
                    showToast(error.message || 'Error completing task', 'danger');
                });
        }
        
        // Skip current task
        function skipTask() {
            if (!currentTask) return;
            
            clearInterval(countdownInterval);
            countdownInterval = null;
            resetCurrentTask();
            showToast('Task skipped', 'info');
        }
        
        // Reset current task state
        function resetCurrentTask() {
            currentTask = null;
            $('#currentTaskCard').addClass('hidden');
            
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }
        
        // Log user activity
        function logActivity(userId, activityType, creditsChange, details = '') {
            return db.collection('activityLog').add({
                userId: userId,
                activityType: activityType,
                creditsChange: creditsChange,
                details: details,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
        
        // Track ad click for revenue
        function trackAdClick() {
            if (!currentUser) return;
            
            // In a real implementation, this would track with Adsterra API
            db.collection('adClicks').add({
                userId: currentUser.uid,
                adType: 'banner',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            analytics.logEvent('ad_click');
        }
        
        // Track ad completion for revenue
        function trackAdCompletion(adType) {
            if (!currentUser) return;
            
            // In a real implementation, this would track with Adsterra API
            db.collection('adCompletions').add({
                userId: currentUser.uid,
                adType: adType,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            analytics.logEvent('ad_completed', { ad_type: adType });
        }
        
        // Send email notification
        function sendEmailNotification(to, subject, body) {
            // In a real implementation, this would use Firebase Cloud Functions
            // to send emails via a service like SendGrid or Mailgun
            console.log(`Email notification to ${to}: ${subject} - ${body}`);
            
            // For demo purposes, we'll just log it
            db.collection('emailLogs').add({
                to: to,
                subject: subject,
                body: body,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
        
        // Show loading spinner
        function showLoading(show) {
            if (show) {
                $('#loadingSpinner').css('display', 'flex');
            } else {
                $('#loadingSpinner').hide();
            }
        }
        
        // Show toast notification
        function showToast(message, type = 'info') {
            const toastId = 'toast-' + Date.now();
            const toast = $(`
                <div class="toast show align-items-center text-white bg-${type} border-0" role="alert" aria-live="assertive" aria-atomic="true" id="${toastId}">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `);
            
            $('#toastContainer').append(toast);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }
        
        // Helper function to capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
               // Initialize Adsterra ads on window load
        window.onload = function() {
            loadAdsterraAds();
            
            // Initialize tooltips
            $('[data-bs-toggle="tooltip"]').tooltip();
            
            // Initialize popovers
            $('[data-bs-toggle="popover"]').popover();
            
            // Check for new notifications
            checkNotifications();
            
            // Load initial data if user is logged in
            if (auth.currentUser) {
                loadInitialData();
            }
        };

        // Load initial data for logged in users
        function loadInitialData() {
            const userId = auth.currentUser.uid;
            
            // Load user profile data
            db.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        updateDashboardStats(doc.data());
                    }
                })
                .catch(error => {
                    console.error("Error loading user data:", error);
                });
            
            // Load recent activities
            loadRecentActivities(userId);
            
            // Load pending tasks
            loadPendingTasks(userId);
        }

        // Update dashboard statistics
        function updateDashboardStats(userData) {
            $('#userPoints').text(userData.credits || 0);
            $('#completedTasks').text(userData.tasksCompleted || 0);
            $('#createdTasks').text(userData.tasksCreated || 0);
            
            // Update progress bars
            updateProgressBar('pointsProgress', userData.credits, 1000);
            updateProgressBar('tasksProgress', userData.tasksCompleted, 50);
        }

        // Update progress bar
        function updateProgressBar(id, current, max) {
            const percentage = Math.min(100, (current / max) * 100);
            $(`#${id}`).css('width', `${percentage}%`)
                      .attr('aria-valuenow', current)
                      .text(`${current}/${max}`);
        }

        // Load recent activities
        function loadRecentActivities(userId) {
            db.collection('activityLog')
                .where('userId', '==', userId)
                .orderBy('timestamp', 'desc')
                .limit(5)
                .get()
                .then(querySnapshot => {
                    const activitiesList = $('#recentActivities');
                    activitiesList.empty();
                    
                    if (querySnapshot.empty) {
                        activitiesList.append('<li class="list-group-item">No recent activities</li>');
                    } else {
                        querySnapshot.forEach(doc => {
                            const activity = doc.data();
                            const date = activity.timestamp?.toDate();
                            
                            activitiesList.append(`
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <small class="text-muted">${date ? date.toLocaleString() : ''}</small>
                                        <div>${activity.details}</div>
                                    </div>
                                    <span class="badge ${activity.creditsChange > 0 ? 'bg-success' : 'bg-danger'} rounded-pill">
                                        ${activity.creditsChange > 0 ? '+' : ''}${activity.creditsChange}
                                    </span>
                                </li>
                            `);
                        });
                    }
                })
                .catch(error => {
                    console.error("Error loading activities:", error);
                });
        }

        // Load pending tasks
        function loadPendingTasks(userId) {
            db.collection('tasks')
                .where('creatorId', '==', userId)
                .where('isActive', '==', true)
                .orderBy('createdDate', 'desc')
                .limit(3)
                .get()
                .then(querySnapshot => {
                    const pendingTasksList = $('#pendingTasks');
                    pendingTasksList.empty();
                    
                    if (querySnapshot.empty) {
                        pendingTasksList.append('<li class="list-group-item">No pending tasks</li>');
                    } else {
                        querySnapshot.forEach(doc => {
                            const task = doc.data();
                            const date = task.createdDate?.toDate();
                            
                            pendingTasksList.append(`
                                <li class="list-group-item">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <strong>${capitalizeFirstLetter(task.taskType)}</strong> on ${capitalizeFirstLetter(task.platform)}
                                            <div class="text-muted"><small>Posted: ${date ? date.toLocaleString() : ''}</small></div>
                                        </div>
                                        <span class="badge bg-primary rounded-pill">${task.credits} pts</span>
                                    </div>
                                </li>
                            `);
                        });
                    }
                })
                .catch(error => {
                    console.error("Error loading pending tasks:", error);
                });
        }

        // Check for new notifications
        function checkNotifications() {
            if (!auth.currentUser) return;
            
            const userId = auth.currentUser.uid;
            const lastCheck = localStorage.getItem('lastNotificationCheck') || 0;
            
            db.collection('notifications')
                .where('userId', '==', userId)
                .where('timestamp', '>', new Date(lastCheck))
                .where('read', '==', false)
                .get()
                .then(querySnapshot => {
                    if (!querySnapshot.empty) {
                        showNotificationBadge(querySnapshot.size);
                        
                        // Update last check time
                        localStorage.setItem('lastNotificationCheck', Date.now());
                    }
                })
                .catch(error => {
                    console.error("Error checking notifications:", error);
                });
        }

        // Show notification badge
        function showNotificationBadge(count) {
            const badge = $('#notificationBadge');
            
            if (count > 0) {
                badge.text(count).removeClass('d-none');
                
                // Add animation
                badge.addClass('animate__animated animate__bounceIn');
                setTimeout(() => {
                    badge.removeClass('animate__animated animate__bounceIn');
                }, 1000);
            } else {
                badge.addClass('d-none');
            }
        }

        // Load more tasks (pagination)
        function loadMoreTasks() {
            const lastVisible = tasks[tasks.length - 1];
            
            db.collection('tasks')
                .where('isActive', '==', true)
                .orderBy('createdDate', 'desc')
                .startAfter(lastVisible)
                .limit(10)
                .get()
                .then(querySnapshot => {
                    if (!querySnapshot.empty) {
                        appendTasks(querySnapshot);
                    } else {
                        $('#loadMoreBtn').prop('disabled', true).text('No more tasks');
                    }
                })
                .catch(error => {
                    console.error("Error loading more tasks:", error);
                    showToast('Error loading more tasks', 'danger');
                });
        }

        // Append tasks to list
        function appendTasks(querySnapshot) {
            querySnapshot.forEach(doc => {
                const task = doc.data();
                tasks.push(doc);
                
                $('#tasksList').append(`
                    <div class="card task-item mb-3">
                        <div class="card-body">
                            <!-- Task content here -->
                        </div>
                    </div>
                `);
            });
        }

        // Initialize dark mode toggle
        function initDarkModeToggle() {
            const darkModeToggle = $('#darkModeToggle');
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                darkModeToggle.prop('checked', true);
            }
            
            darkModeToggle.change(function() {
                const isChecked = $(this).is(':checked');
                document.body.classList.toggle('dark-mode', isChecked);
                localStorage.setItem('darkMode', isChecked);
                
                // Save preference to user profile if logged in
                if (auth.currentUser) {
                    db.collection('users').doc(auth.currentUser.uid).update({
                        darkMode: isChecked,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            });
        }

        // Initialize analytics events
        function initAnalyticsEvents() {
            // Track page views
            analytics.logEvent('page_view', {
                page_title: document.title,
                page_location: window.location.href
            });
            
            // Track button clicks
            $('[data-track-event]').click(function() {
                const eventName = $(this).data('track-event');
                analytics.logEvent(eventName);
            });
        }

        // Initialize service worker for PWA
        function initServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                        
                        // Check for updates
                        registration.update();
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            }
        }

        // Initialize offline capabilities
        function initOfflineCapabilities() {
            // Listen for online/offline status changes
            window.addEventListener('online', () => {
                showToast('You are back online', 'success');
                syncPendingOperations();
            });
            
            window.addEventListener('offline', () => {
                showToast('You are offline. Some features may not work.', 'warning');
            });
            
            // Initialize offline queue
            if (localStorage.getItem('offlineQueue')) {
                const queue = JSON.parse(localStorage.getItem('offlineQueue'));
                if (queue.length > 0) {
                    showToast(`You have ${queue.length} pending operations that will be synced when online`, 'info');
                }
            }
        }

        // Sync pending operations when online
        function syncPendingOperations() {
            const queue = JSON.parse(localStorage.getItem('offlineQueue') || []);
            
            if (queue.length > 0) {
                showLoading(true);
                
                queue.forEach(operation => {
                    // Process each operation based on its type
                    switch (operation.type) {
                        case 'task_completion':
                            completeTask(operation.taskId, operation.userId);
                            break;
                        case 'profile_update':
                            updateUserProfile(operation.userId, operation.data);
                            break;
                        // Add more operation types as needed
                    }
                });
                
                // Clear the queue
                localStorage.setItem('offlineQueue', JSON.stringify([]));
                showLoading(false);
                showToast('Pending operations synced successfully', 'success');
            }
        }

        // Add operation to offline queue
        function addToOfflineQueue(operation) {
            const queue = JSON.parse(localStorage.getItem('offlineQueue') || []);
            queue.push(operation);
            localStorage.setItem('offlineQueue', JSON.stringify(queue));
        }

        // Initialize all components
        function initializeApp() {
            initDarkModeToggle();
            initAnalyticsEvents();
            initServiceWorker();
            initOfflineCapabilities();
            
            // Check for app updates
            checkForUpdates();
        }

        // Check for app updates
        function checkForUpdates() {
            const lastVersion = localStorage.getItem('appVersion');
            const currentVersion = '1.0.0'; // This should match your app version
            
            if (lastVersion !== currentVersion) {
                showToast('New version available. Please refresh the page.', 'info');
                localStorage.setItem('appVersion', currentVersion);
                
                // In a real app, you might prompt the user to refresh
                $('#updateToast').toast('show');
            }
        }

        // Initialize the app when DOM is fully loaded
        $(document).ready(() => {
            initializeApp();
        });

        // Export functions to global scope for HTML event handlers
        window.showTaskDetails = showTaskDetails;
        window.loadMoreTasks = loadMoreTasks;
        window.editUser = editUser;
        window.editTask = editTask;
        window.showDeleteConfirmation = showDeleteConfirmation;
    })(jQuery);
    
            // Initialize the app with additional features
        function initializeApp() {
            // Initialize real-time updates for user points
            initRealTimeUpdates();
            
            // Setup task auto-refresh every 30 seconds
            setupTaskAutoRefresh();
            
            // Initialize social media sharing
            initSocialSharing();
            
            // Setup session timeout
            setupSessionTimeout();
            
            // Initialize browser notifications
            initBrowserNotifications();
            
            // Initialize performance monitoring
            initPerformanceMonitoring();
        }

        // Initialize real-time updates for user points
        function initRealTimeUpdates() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid)
                .onSnapshot((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        const pointsElement = $('#userCredits');
                        
                        // Add animation when points change
                        const oldPoints = parseInt(pointsElement.text());
                        const newPoints = userData.credits || 0;
                        
                        if (oldPoints !== newPoints) {
                            pointsElement.fadeOut(200, function() {
                                $(this).text(`${newPoints} Points`).fadeIn(200);
                                
                                // Add highlight effect
                                $(this).addClass('highlight-flash');
                                setTimeout(() => {
                                    $(this).removeClass('highlight-flash');
                                }, 1000);
                            });
                        }
                    }
                });
        }

        // Setup task auto-refresh
        function setupTaskAutoRefresh() {
            // Refresh tasks every 30 seconds
            setInterval(() => {
                if ($('#earnPointsSection').is(':visible')) {
                    loadAvailableTasks();
                }
            }, 30000);
            
            // Add visual indicator for last refresh
            $('#refreshTasks').click(function() {
                $(this).addClass('spin');
                setTimeout(() => {
                    $(this).removeClass('spin');
                }, 1000);
                
                // Update last refreshed time
                $('#lastRefreshed').text(new Date().toLocaleTimeString());
            });
        }

        // Initialize social media sharing
        function initSocialSharing() {
            $('.share-btn').click(function() {
                const platform = $(this).data('platform');
                const url = encodeURIComponent(window.location.href);
                const text = encodeURIComponent("Check out Like4Like - the best social media exchange platform!");
                
                let shareUrl = '';
                switch(platform) {
                    case 'facebook':
                        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
                        break;
                    case 'twitter':
                        shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
                        break;
                    case 'linkedin':
                        shareUrl = `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${text}`;
                        break;
                }
                
                if (shareUrl) {
                    window.open(shareUrl, '_blank', 'width=600,height=400');
                }
            });
        }

        // Setup session timeout
        function setupSessionTimeout() {
            let idleTimer;
            const timeout = 30 * 60 * 1000; // 30 minutes
            
            const resetTimer = () => {
                clearTimeout(idleTimer);
                idleTimer = setTimeout(logoutDueToInactivity, timeout);
            };
            
            $(document).on('mousemove keydown scroll click', resetTimer);
            resetTimer();
        }

        function logoutDueToInactivity() {
            if (currentUser) {
                showToast('You have been logged out due to inactivity', 'warning');
                logoutUser();
            }
        }

        // Initialize browser notifications
        function initBrowserNotifications() {
            if (!('Notification' in window)) {
                console.log('Browser does not support notifications');
                return;
            }
            
            if (Notification.permission === 'granted') {
                setupNotificationListeners();
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        setupNotificationListeners();
                    }
                });
            }
        }

        function setupNotificationListeners() {
            if (!currentUser) return;
            
            // Listen for new tasks assigned to user
            db.collection('taskAssignments')
                .where('userId', '==', currentUser.uid)
                .where('read', '==', false)
                .onSnapshot((snapshot) => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === 'added') {
                            showBrowserNotification('New Task Assigned', 'You have a new task to complete!');
                        }
                    });
                });
        }

        function showBrowserNotification(title, message) {
            if (Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'https://like4like.com/icon.png'
                });
            }
        }

        // Initialize performance monitoring
        function initPerformanceMonitoring() {
            // Track page load time
            const navTiming = performance.getEntriesByType('navigation')[0];
            const loadTime = navTiming.loadEventEnd - navTiming.startTime;
            
            analytics.logEvent('page_load', {
                load_time: loadTime,
                page_path: window.location.pathname
            });
            
            // Track slow database operations
            const originalGet = firebase.firestore.CollectionReference.prototype.get;
            
            firebase.firestore.CollectionReference.prototype.get = function() {
                const start = performance.now();
                return originalGet.apply(this, arguments).then(result => {
                    const duration = performance.now() - start;
                    
                    if (duration > 1000) { // Log slow queries
                        analytics.logEvent('slow_query', {
                            duration: duration,
                            collection: this.path
                        });
                    }
                    
                    return result;
                });
            };
        }

        // Enhanced task completion with verification
        function completeTaskWithVerification(taskId, userId) {
            showLoading(true);
            
            // First verify the task was actually completed
            verifyTaskCompletion(taskId)
                .then(verified => {
                    if (!verified) {
                        throw new Error('Task completion could not be verified');
                    }
                    
                    return completeTask(taskId, userId);
                })
                .then(() => {
                    // Additional verification steps
                    return checkForFraud(taskId, userId);
                })
                .then(() => {
                    showLoading(false);
                    showToast('Task completed and verified!', 'success');
                })
                .catch(error => {
                    showLoading(false);
                    console.error('Verification error:', error);
                    showToast(error.message || 'Verification failed', 'danger');
                    
                    // Penalize user for failed verification
                    penalizeUser(userId);
                });
        }

        function verifyTaskCompletion(taskId) {
            // In a real implementation, this would verify with platform APIs
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(Math.random() > 0.1); // 90% success rate for demo
                }, 1000);
            });
        }

        function checkForFraud(taskId, userId) {
            return db.collection('taskCompletions')
                .where('userId', '==', userId)
                .where('timestamp', '>', new Date(Date.now() - 3600000)) // Last hour
                .get()
                .then(snapshot => {
                    if (snapshot.size > 10) { // More than 10 tasks in an hour
                        throw new Error('Suspicious activity detected');
                    }
                    return true;
                });
        }

        function penalizeUser(userId) {
            return db.collection('users').doc(userId).update({
                fraudAttempts: firebase.firestore.FieldValue.increment(1),
                credits: firebase.firestore.FieldValue.increment(-10)
            });
        }

        // Enhanced security features
        function enhanceSecurity() {
            // Prevent multiple tabs
            if (localStorage.getItem('authToken')) {
                showToast('Please use only one tab at a time', 'warning');
                logoutUser();
            } else {
                localStorage.setItem('authToken', 'active');
                
                window.addEventListener('beforeunload', () => {
                    localStorage.removeItem('authToken');
                });
            }
            
            // Detect VPN/Proxy
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    if (data.vpn || data.proxy) {
                        showToast('VPN/Proxy detected. Some features may be limited.', 'warning');
                        analytics.logEvent('vpn_detected');
                    }
                });
        }

        // Admin dashboard enhancements
        function enhanceAdminDashboard() {
            // Real-time charts
            if (isAdmin) {
                initAdminCharts();
                setupAdminAlerts();
            }
        }

        function initAdminCharts() {
            // Using Chart.js for demo purposes
            const ctx = document.getElementById('adminStatsChart').getContext('2d');
            
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'New Users',
                        data: [],
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Platform Growth'
                        }
                    }
                }
            });
            
            // Update chart with real-time data
            db.collection('users')
                .orderBy('joinedDate')
                .onSnapshot(snapshot => {
                    const labels = [];
                    const data = [];
                    
                    snapshot.docs.forEach(doc => {
                        const date = doc.data().joinedDate.toDate();
                        labels.push(date.toLocaleDateString());
                        data.push(data.length > 0 ? data[data.length-1] + 1 : 1);
                    });
                    
                    chart.data.labels = labels;
                    chart.data.datasets[0].data = data;
                    chart.update();
                });
        }

        function setupAdminAlerts() {
            // Alert for suspicious activities
            db.collection('activityLog')
                .where('activityType', '==', 'fraud_attempt')
                .onSnapshot(snapshot => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === 'added') {
                            showAdminAlert(change.doc.data());
                        }
                    });
                });
        }

        function showAdminAlert(data) {
            const alertHtml = `
                <div class="alert alert-danger alert-dismissible fade show">
                    <strong>Suspicious activity detected!</strong>
                    <p>User ${data.userId} attempted to ${data.details}.</p>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            $('#adminAlerts').prepend(alertHtml);
            
            // Also show browser notification
            if (Notification.permission === 'granted') {
                new Notification('Security Alert', {
                    body: `Suspicious activity from user ${data.userId}`
                });
            }
        }

        // Initialize the app when DOM is fully loaded
        $(document).ready(() => {
            initializeApp();
            enhanceSecurity();
            enhanceAdminDashboard();
            
            // Add remaining global functions
            window.completeTaskWithVerification = completeTaskWithVerification;
            window.showBrowserNotification = showBrowserNotification;
        });

    })(jQuery);
    
    // Advanced Task Verification System
    function setupTaskVerification() {
        // Initialize image recognition for task verification
        if (typeof Tesseract !== 'undefined') {
            window.ocrWorker = Tesseract.createWorker({
                logger: m => console.log(m)
            });
            
            (async () => {
                await window.ocrWorker.load();
                await window.ocrWorker.loadLanguage('eng');
                await window.ocrWorker.initialize('eng');
            })();
        }
    }
    
    // Enhanced Task Completion with Screenshot Verification
    async function verifyTaskWithScreenshot(taskId, screenshotData) {
        try {
            showLoading(true);
            
            // 1. Upload screenshot to Firebase Storage
            const storageRef = storage.ref(`task_verifications/${taskId}_${Date.now()}.jpg`);
            const uploadTask = storageRef.putString(screenshotData, 'data_url');
            
            const snapshot = await uploadTask;
            const screenshotUrl = await snapshot.ref.getDownloadURL();
            
            // 2. Perform OCR on the screenshot
            let verificationText = '';
            if (window.ocrWorker) {
                const { data: { text } } = await window.ocrWorker.recognize(screenshotData);
                verificationText = text;
            }
            
            // 3. Analyze the screenshot (basic checks)
            const isVerified = await analyzeScreenshot(screenshotData, verificationText);
            
            // 4. Store verification results
            await db.collection('taskVerifications').add({
                taskId,
                userId: currentUser.uid,
                screenshotUrl,
                verificationText,
                isVerified,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            return isVerified;
        } catch (error) {
            console.error('Verification error:', error);
            return false;
        } finally {
            showLoading(false);
        }
    }
    
    async function analyzeScreenshot(screenshotData, text) {
        // Basic checks - in a real app you'd have more sophisticated analysis
        const requiredKeywords = ['like', 'follow', 'comment', 'subscriber'];
        const hasKeyword = requiredKeywords.some(keyword => 
            text.toLowerCase().includes(keyword)
        );
        
        // Check for blank/black images
        const img = new Image();
        img.src = screenshotData;
        
        const isBlank = await new Promise(resolve => {
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Check if image is mostly black/blank
                let blankPixels = 0;
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i+1];
                    const b = data[i+2];
                    
                    if (r < 10 && g < 10 && b < 10) blankPixels++;
                }
                
                resolve(blankPixels > (data.length / 4 * 0.8)); // 80% black
            };
        });
        
        return hasKeyword && !isBlank;
    }
    
    // Premium Features System
    function initPremiumFeatures() {
        db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
            if (doc.exists) {
                const user = doc.data();
                const isPremium = user.premium || false;
                
                // Toggle premium features
                $('.premium-feature').toggle(isPremium);
                
                // Show upgrade prompt if not premium
                if (!isPremium && !localStorage.getItem('premiumPromptShown')) {
                    setTimeout(() => {
                        showPremiumUpsell();
                        localStorage.setItem('premiumPromptShown', 'true');
                    }, 10000);
                }
            }
        });
    }
    
    function showPremiumUpsell() {
        const modal = `
            <div class="modal fade" id="premiumModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title">Upgrade to Premium</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card border-primary mb-3">
                                        <div class="card-header bg-primary text-white">Free Plan</div>
                                        <div class="card-body">
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item">✔ Basic task creation</li>
                                                <li class="list-group-item">✔ Earn up to 100 points/day</li>
                                                <li class="list-group-item">✖ No priority support</li>
                                                <li class="list-group-item">✖ Standard task visibility</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-warning mb-3">
                                        <div class="card-header bg-warning text-white">Premium Plan</div>
                                        <div class="card-body">
                                            <h4 class="card-title">$9.99/month</h4>
                                            <ul class="list-group list-group-flush">
                                                <li class="list-group-item">✔ Unlimited task creation</li>
                                                <li class="list-group-item">✔ Earn unlimited points</li>
                                                <li class="list-group-item">✔ Priority support</li>
                                                <li class="list-group-item">✔ Featured task placement</li>
                                                <li class="list-group-item">✔ Advanced analytics</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Not Now</button>
                            <button type="button" class="btn btn-warning" id="upgradeToPremiumBtn">Upgrade Now</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        $('body').append(modal);
        const premiumModal = new bootstrap.Modal(document.getElementById('premiumModal'));
        premiumModal.show();
        
        $('#upgradeToPremiumBtn').click(() => {
            initiatePremiumPurchase();
            premiumModal.hide();
        });
    }
    
    function initiatePremiumPurchase() {
        showLoading(true);
        
        // In a real app, this would integrate with Stripe/PayPal
        // For demo, we'll simulate a successful purchase
        setTimeout(() => {
            db.collection('users').doc(currentUser.uid).update({
                premium: true,
                premiumSince: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                showToast('Premium upgrade successful!', 'success');
                logActivity(currentUser.uid, 'premium_upgrade', 0, 'User upgraded to premium');
                
                // Send confirmation email
                sendEmailNotification(
                    currentUser.email,
                    'Premium Membership Activated',
                    'Thank you for upgrading to Like4Like Premium! You now have access to all premium features.'
                );
            })
            .catch(error => {
                console.error('Upgrade error:', error);
                showToast('Upgrade failed. Please try again.', 'danger');
            })
            .finally(() => {
                showLoading(false);
            });
        }, 2000);
    }
    
    // Advanced Analytics System
    function initAdvancedAnalytics() {
        if (!currentUser) return;
        
        // Track user behavior
        trackUserJourney();
        
        // Set up performance metrics
        setupPerformanceTracking();
        
        // Initialize A/B testing
        initABTesting();
    }
    
    function trackUserJourney() {
        // Track page views and user flow
        analytics.logEvent('page_view', {
            page_path: window.location.pathname,
            user_id: currentUser.uid
        });
        
        // Track feature usage
        $('[data-track-feature]').click(function() {
            const feature = $(this).data('track-feature');
            analytics.logEvent('feature_used', {
                feature_name: feature,
                user_id: currentUser.uid
            });
        });
        
        // Track task completion funnel
        db.collection('taskCompletions')
            .where('userId', '==', currentUser.uid)
            .onSnapshot(snapshot => {
                analytics.logEvent('task_funnel', {
                    completed_tasks: snapshot.size,
                    user_id: currentUser.uid
                });
            });
    }
    
    function setupPerformanceTracking() {
        // Track API response times
        const originalFirestoreGet = firebase.firestore.DocumentReference.prototype.get;
        
        firebase.firestore.DocumentReference.prototype.get = function(options) {
            const start = performance.now();
            return originalFirestoreGet.call(this, options).then(result => {
                const duration = performance.now() - start;
                
                analytics.logEvent('firestore_performance', {
                    operation: 'get',
                    duration: duration,
                    document_path: this.path,
                    user_id: currentUser?.uid || 'anonymous'
                });
                
                return result;
            });
        };
        
        // Track image load times
        $('img').on('load', function() {
            const loadTime = this.complete ? 
                performance.now() - performance.getEntriesByName(this.src)[0]?.startTime : 0;
            
            if (loadTime > 1000) { // Only track slow images
                analytics.logEvent('slow_image_load', {
                    src: this.src,
                    load_time: loadTime,
                    user_id: currentUser?.uid || 'anonymous'
                });
            }
        });
    }
    
    function initABTesting() {
        // Assign user to a test group (50/50 split)
        const testGroup = localStorage.getItem('ab_test_group') || 
                         (Math.random() > 0.5 ? 'A' : 'B');
        localStorage.setItem('ab_test_group', testGroup);
        
        // Apply different UI for test groups
        if (testGroup === 'B') {
            $('.cta-button').addClass('btn-danger').removeClass('btn-primary');
            $('#heroRegisterBtn').text('Try It Free - Limited Time!');
        }
        
        // Track group assignment
        analytics.logEvent('ab_test_assignment', {
            test_name: 'button_color_test',
            group: testGroup,
            user_id: currentUser?.uid || 'anonymous'
        });
    }
    
    // Multi-language Support
    function initLanguageSupport() {
        const userLanguage = navigator.language.split('-')[0] || 'en';
        loadTranslations(userLanguage);
        
        // Language switcher
        $('#languageSwitcher').change(function() {
            const lang = $(this).val();
            loadTranslations(lang);
            localStorage.setItem('preferredLanguage', lang);
        });
    }
    
    function loadTranslations(lang) {
        const translations = {
            en: {
                welcome: "Welcome",
                points: "Points",
                tasks: "Tasks"
            },
            es: {
                welcome: "Bienvenido",
                points: "Puntos",
                tasks: "Tareas"
            },
            fr: {
                welcome: "Bienvenue",
                points: "Points",
                tasks: "Tâches"
            }
        };
        
        const langData = translations[lang] || translations.en;
        
        // Update UI elements
        $('[data-translate]').each(function() {
            const key = $(this).data('translate');
            $(this).text(langData[key] || key);
        });
    }
    
    // Accessibility Improvements
    function enhanceAccessibility() {
        // Add ARIA attributes
        $('[role="button"]').attr('aria-pressed', 'false');
        
        // Keyboard navigation
        $(document).on('keydown', function(e) {
            if (e.key === 'Tab') {
                $('body').addClass('keyboard-navigation');
            }
        });
        
        $(document).on('mousedown', function() {
            $('body').removeClass('keyboard-navigation');
        });
        
        // Skip to content link
        $('#skipToContent').click(function(e) {
            e.preventDefault();
            $('#mainContent').attr('tabindex', -1).focus();
        });
        
        // High contrast mode
        $('#highContrastToggle').change(function() {
            $('body').toggleClass('high-contrast', this.checked);
            localStorage.setItem('highContrast', this.checked);
        });
        
        // Initialize based on preferences
        if (localStorage.getItem('highContrast') === 'true') {
            $('body').addClass('high-contrast');
            $('#highContrastToggle').prop('checked', true);
        }
    }
    
    // GDPR Compliance
    function setupGDPRCompliance() {
        if (!localStorage.getItem('cookieConsent')) {
            $('#cookieConsentBanner').removeClass('d-none');
        }
        
        $('#acceptCookies').click(function() {
            localStorage.setItem('cookieConsent', 'true');
            $('#cookieConsentBanner').addClass('d-none');
            analytics.setConsent(true);
        });
        
        $('#rejectCookies').click(function() {
            localStorage.setItem('cookieConsent', 'false');
            $('#cookieConsentBanner').addClass('d-none');
            analytics.setConsent(false);
        });
        
        $('#privacySettingsBtn').click(function() {
            $('#privacySettingsModal').modal('show');
        });
    }
    
    // Webhook Integrations
    function setupWebhooks() {
        // Listen for task completions and trigger webhooks
        db.collection('taskCompletions')
            .where('userId', '==', currentUser.uid)
            .onSnapshot(snapshot => {
                snapshot.docChanges().forEach(change => {
                    if (change.type === 'added') {
                        triggerTaskCompletionWebhook(change.doc.data());
                    }
                });
            });
    }
    
    function triggerTaskCompletionWebhook(data) {
        // Get user's webhook URL
        db.collection('userWebhooks').doc(currentUser.uid).get()
            .then(doc => {
                if (doc.exists && doc.data().url) {
                    const payload = {
                        event: 'task_completed',
                        userId: currentUser.uid,
                        taskId: data.taskId,
                        timestamp: new Date().toISOString(),
                        pointsEarned: data.creditsEarned
                    };
                    
                    // Send to user's webhook
                    return fetch(doc.data().url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                }
            })
            .catch(error => console.error('Webhook error:', error));
    }
    
    // Final Initialization
    $(document).ready(() => {
        // Initialize additional systems
        setupTaskVerification();
        initPremiumFeatures();
        initAdvancedAnalytics();
        initLanguageSupport();
        enhanceAccessibility();
        setupGDPRCompliance();
        setupWebhooks();
        
        // Add global functions
        window.verifyTaskWithScreenshot = verifyTaskWithScreenshot;
        window.captureTaskScreenshot = captureTaskScreenshot;
    });
    
    // Screenshot Capture Utility
    function captureTaskScreenshot() {
        return new Promise((resolve) => {
            if (!currentTask) {
                resolve(null);
                return;
            }
            
            // Open the task URL in an iframe for capture
            const iframe = document.createElement('iframe');
            iframe.src = currentTask.targetUrl;
            iframe.style.position = 'fixed';
            iframe.style.top = '-10000px';
            iframe.style.left = '-10000px';
            document.body.appendChild(iframe);
            
            iframe.onload = () => {
                setTimeout(() => {
                    html2canvas(iframe.contentDocument.body).then(canvas => {
                        const screenshot = canvas.toDataURL('image/jpeg', 0.8);
                        document.body.removeChild(iframe);
                        resolve(screenshot);
                    });
                }, 2000); // Wait for page to load
            };
        });
    }
    
    // Error Tracking and Reporting
    function setupErrorTracking() {
        window.onerror = function(message, source, lineno, colno, error) {
            const errorData = {
                message,
                source,
                line: lineno,
                column: colno,
                stack: error?.stack,
                userAgent: navigator.userAgent,
                userId: currentUser?.uid || 'anonymous',
                timestamp: new Date().toISOString()
            };
            
            // Log to Firebase
            db.collection('clientErrors').add(errorData);
            
            // Show feedback to user
            if (!localStorage.getItem('errorReported')) {
                showErrorFeedbackForm(errorData);
                localStorage.setItem('errorReported', 'true');
            }
            
            return true; // Prevent default error handling
        };
    }
    
    function showErrorFeedbackForm(error) {
        const modal = `
            <div class="modal fade" id="errorFeedbackModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title">We're Sorry!</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>Something went wrong. Would you like to tell us what you were doing when this happened?</p>
                            <textarea class="form-control mb-3" id="errorDescription" rows="3" placeholder="What were you trying to do?"></textarea>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="allowErrorData">
                                <label class="form-check-label" for="allowErrorData">
                                    Send error details to help improve the service
                                </label>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="submitErrorReport">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        $('body').append(modal);
        const errorModal = new bootstrap.Modal(document.getElementById('errorFeedbackModal'));
        errorModal.show();
        
        $('#submitErrorReport').click(() => {
            const description = $('#errorDescription').val();
            const allowData = $('#allowErrorData').is(':checked');
            
            if (allowData) {
                db.collection('errorFeedback').add({
                    error,
                    description,
                    userId: currentUser?.uid || 'anonymous',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
            
            showToast('Thank you for your feedback!', 'success');
            errorModal.hide();
        });
    }
    
    // Final App Initialization
    $(document).ready(() => {
        setupErrorTracking();
        
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful');
                    
                    // Check for updates every hour
                    setInterval(() => registration.update(), 3600000);
                })
                .catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
        }
    });
    
})(jQuery);

// Progressive Web App Features
function setupPWAFeatures() {
    // Check if the app is running as PWA
    if (window.matchMedia('(display-mode: standalone)').matches) {
        document.body.classList.add('pwa-mode');
        analytics.logEvent('pwa_launch');
    }
    
    // Listen for app installation prompt
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        showInstallPromotion();
    });
    
    // Track app launch source
    if (window.navigator.standalone) {
        analytics.logEvent('pwa_ios_launch');
    }
}

function showInstallPromotion() {
    if (!localStorage.getItem('installPromptShown')) {
        const toast = `
            <div class="toast show" id="installToast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header bg-primary text-white">
                    <strong class="me-auto">Install Like4Like</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    Get the best experience by installing our app!
                    <button class="btn btn-sm btn-success mt-2" id="installBtn">Install Now</button>
                </div>
            </div>
        `;
        
        $('#toastContainer').append(toast);
        localStorage.setItem('installPromptShown', 'true');
        
        $('#installBtn').click(async () => {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            analytics.logEvent('install_prompt', { outcome });
            $('#installToast').remove();
        });
    }
}

// Real-time Communication
function setupRealtimeCommunication() {
    if (!currentUser) return;
    
    // Initialize Socket.io for real-time updates
    const socket = io('https://realtime.like4like.com', {
        query: { userId: currentUser.uid },
        transports: ['websocket']
    });
    
    socket.on('connect', () => {
        console.log('Connected to realtime server');
    });
    
    socket.on('new_message', (data) => {
        showNotification('New Message', data.message);
    });
    
    socket.on('task_update', (data) => {
        if (data.userId === currentUser.uid) {
            showToast(`Your task was ${data.status}`, 'info');
        }
    });
    
    socket.on('disconnect', () => {
        console.log('Disconnected from realtime server');
    });
}

// Advanced Task Management
function enhanceTaskManagement() {
    // Drag and drop for task ordering
    if (typeof Sortable !== 'undefined') {
        new Sortable(document.getElementById('tasksList'), {
            animation: 150,
            ghostClass: 'sortable-ghost',
            onEnd: function() {
                saveTaskOrder();
            }
        });
    }
    
    // Bulk actions for tasks
    $('#bulkDeleteTasks').click(() => {
        const selectedTasks = $('.task-checkbox:checked').map(function() {
            return $(this).data('taskId');
        }).get();
        
        if (selectedTasks.length > 0) {
            showDeleteConfirmation('bulk_tasks', selectedTasks);
        }
    });
}

function saveTaskOrder() {
    const taskOrder = $('#tasksList').children().map(function() {
        return $(this).data('taskId');
    }).get();
    
    if (currentUser) {
        db.collection('userPreferences').doc(currentUser.uid).set({
            taskOrder,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
    }
}

// Enhanced Security Features
function implementSecurityEnhancements() {
    // Session timeout warning
    let idleTimer;
    const timeoutWarning = 25 * 60 * 1000; // 25 minutes
    const timeoutDuration = 30 * 60 * 1000; // 30 minutes
    
    const resetTimer = () => {
        clearTimeout(idleTimer);
        idleTimer = setTimeout(logoutWarning, timeoutWarning);
    };
    
    $(document).on('mousemove keydown scroll click', resetTimer);
    resetTimer();
    
    function logoutWarning() {
        showToast('You will be logged out due to inactivity in 5 minutes', 'warning');
        idleTimer = setTimeout(logoutUser, timeoutDuration - timeoutWarning);
    }
    
    // Two-factor authentication setup
    $('#enable2faBtn').click(() => {
        setupTwoFactorAuth();
    });
}

async function setupTwoFactorAuth() {
    showLoading(true);
    
    try {
        // Generate secret key for 2FA
        const response = await fetch('https://us-central1-like4like-example.cloudfunctions.net/generate2FASecret', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${await auth.currentUser.getIdToken()}`
            }
        });
        
        const data = await response.json();
        
        // Show QR code for setup
        $('#2faSecret').text(data.secret);
        $('#2faQrCode').attr('src', data.qrCodeUrl);
        $('#2faModal').modal('show');
        
        // Verify setup
        $('#verify2faBtn').click(async () => {
            const code = $('#2faCode').val();
            if (!code) return;
            
            const verifyResponse = await fetch('https://us-central1-like4like-example.cloudfunctions.net/verify2FACode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${await auth.currentUser.getIdToken()}`
                },
                body: JSON.stringify({ code, secret: data.secret })
            });
            
            const verifyData = await verifyResponse.json();
            
            if (verifyData.valid) {
                // Enable 2FA for user
                await db.collection('users').doc(currentUser.uid).update({
                    twoFactorEnabled: true,
                    twoFactorSecret: data.secret
                });
                
                showToast('Two-factor authentication enabled successfully!', 'success');
                $('#2faModal').modal('hide');
            } else {
                showToast('Invalid verification code', 'danger');
            }
        });
    } catch (error) {
        console.error('2FA setup error:', error);
        showToast('Error setting up two-factor authentication', 'danger');
    } finally {
        showLoading(false);
    }
}

// Admin Dashboard Enhancements
function enhanceAdminDashboard() {
    if (!isAdmin) return;
    
    // Real-time statistics
    const statsRef = db.collection('systemStats').doc('current');
    statsRef.onSnapshot((doc) => {
        if (doc.exists) {
            const stats = doc.data();
            updateAdminStats(stats);
        }
    });
    
    // User activity monitoring
    setupUserActivityMonitoring();
}

function updateAdminStats(stats) {
    $('#onlineUsers').text(stats.onlineUsers || 0);
    $('#activeTasks').text(stats.activeTasks || 0);
    $('#completedTasksToday').text(stats.completedTasksToday || 0);
    $('#systemHealth').text(`${stats.systemHealth || 100}%`)
        .removeClass('text-danger text-warning text-success')
        .addClass(stats.systemHealth > 90 ? 'text-success' : 
                 stats.systemHealth > 70 ? 'text-warning' : 'text-danger');
}

function setupUserActivityMonitoring() {
    db.collection('userActivity').orderBy('lastActive', 'desc').limit(50)
        .onSnapshot((snapshot) => {
            const tbody = $('#userActivityTable tbody');
            tbody.empty();
            
            snapshot.forEach((doc) => {
                const activity = doc.data();
                tbody.append(`
                    <tr>
                        <td>${activity.email || 'Unknown'}</td>
                        <td>${activity.lastActive?.toDate().toLocaleString() || '-'}</td>
                        <td>${activity.actionsLastHour || 0}</td>
                        <td>
                            <span class="badge ${activity.status === 'online' ? 'bg-success' : 'bg-secondary'}">
                                ${activity.status || 'offline'}
                            </span>
                        </td>
                    </tr>
                `);
            });
        });
}

// Advanced Reporting System
function setupAdvancedReporting() {
    $('#generateReportBtn').click(() => {
        generateUserActivityReport();
    });
}

async function generateUserActivityReport() {
    showLoading(true);
    
    try {
        const response = await fetch('https://us-central1-like4like-example.cloudfunctions.net/generateReport', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${await auth.currentUser.getIdToken()}`
            },
            body: JSON.stringify({
                userId: currentUser.uid,
                reportType: $('#reportType').val(),
                dateRange: {
                    start: $('#reportStartDate').val(),
                    end: $('#reportEndDate').val()
                }
            })
        });
        
        const data = await response.json();
        
        if (data.reportUrl) {
            window.open(data.reportUrl, '_blank');
            showToast('Report generated successfully', 'success');
        } else {
            showToast('Error generating report', 'danger');
        }
    } catch (error) {
        console.error('Report generation error:', error);
        showToast('Error generating report', 'danger');
    } finally {
        showLoading(false);
    }
}

// Final Initialization
$(document).ready(() => {
    // Initialize additional modules
    setupPWAFeatures();
    setupRealtimeCommunication();
    enhanceTaskManagement();
    implementSecurityEnhancements();
    enhanceAdminDashboard();
    setupAdvancedReporting();
    
    // Load additional scripts dynamically
    loadDependencies();
});

function loadDependencies() {
    // Load Socket.io if not already loaded
    if (typeof io === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://cdn.socket.io/4.5.0/socket.io.min.js';
        script.onload = setupRealtimeCommunication;
        document.body.appendChild(script);
    }
    
    // Load SortableJS if not already loaded
    if (typeof Sortable === 'undefined') {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js';
        script.onload = enhanceTaskManagement;
        document.body.appendChild(script);
    }
}

// Error Handling and Monitoring
window.addEventListener('error', (event) => {
    const errorData = {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        error: event.error?.stack,
        userAgent: navigator.userAgent,
        userId: currentUser?.uid || 'anonymous',
        timestamp: new Date().toISOString()
    };
    
    // Log to Firebase
    db.collection('clientErrors').add(errorData)
        .catch(e => console.error('Error logging error:', e));
    
    // Show feedback to user
    if (Math.random() < 0.3) { // 30% chance to show feedback
        showErrorFeedback(errorData);
    }
});

function showErrorFeedback(error) {
    const modal = `
        <div class="modal fade" id="errorFeedbackModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title">Oops! Something went wrong</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>We encountered an error. Would you like to help us improve by sharing what you were doing?</p>
                        <textarea class="form-control mb-3" id="errorDescription" placeholder="What were you trying to do?"></textarea>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="shareErrorDetails" checked>
                            <label class="form-check-label" for="shareErrorDetails">
                                Share error details to help us fix this
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="submitErrorFeedback">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    $('body').append(modal);
    const errorModal = new bootstrap.Modal(document.getElementById('errorFeedbackModal'));
    errorModal.show();
    
    $('#submitErrorFeedback').click(() => {
        const description = $('#errorDescription').val();
        const shareDetails = $('#shareErrorDetails').is(':checked');
        
        if (shareDetails) {
            db.collection('errorFeedback').add({
                ...error,
                description,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
        
        showToast('Thank you for your feedback!', 'success');
        errorModal.hide();
    });
}

   // Export global functions
window.completeTaskWithVerification = completeTaskWithVerification;
window.showTaskDetails = showTaskDetails;
window.editUser = editUser;
window.editTask = editTask;
window.showDeleteConfirmation = showDeleteConfirmation;

// Advanced Fraud Detection System
function setupFraudDetection() {
    // Monitor for suspicious activity patterns
    db.collection('taskCompletions').where('userId', '==', currentUser.uid)
        .onSnapshot(snapshot => {
            const completions = snapshot.docs.map(doc => doc.data());
            
            // Detect rapid task completions (more than 10 tasks/minute)
            const recentCompletions = completions.filter(comp => 
                new Date() - comp.timestamp.toDate() < 60000
            );
            
            if (recentCompletions.length > 10) {
                flagSuspiciousActivity('rapid_task_completion', {
                    count: recentCompletions.length,
                    userId: currentUser.uid
                });
            }
        });
    
    // Monitor for duplicate IP addresses
    if (currentUser) {
        trackUserIP(currentUser.uid);
    }
}

function flagSuspiciousActivity(type, data) {
    db.collection('suspiciousActivities').add({
        type,
        data,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        resolved: false
    });
    
    // Notify admins
    sendAdminAlert(`Suspicious activity detected: ${type}`, data);
    
    // Apply temporary restrictions if needed
    if (type === 'rapid_task_completion') {
        applyRateLimiting(data.userId);
    }
}

function trackUserIP(userId) {
    // In a real app, you'd get the IP from the request headers
    fetch('https://api.ipify.org?format=json')
        .then(response => response.json())
        .then(data => {
            db.collection('userIps').doc(userId).set({
                ip: data.ip,
                lastSeen: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });
            
            // Check for IP sharing (multiple accounts from same IP)
            db.collection('userIps').where('ip', '==', data.ip).get()
                .then(snapshot => {
                    if (snapshot.size > 3) { // More than 3 accounts from same IP
                        flagSuspiciousActivity('ip_sharing', {
                            ip: data.ip,
                            userIds: snapshot.docs.map(doc => doc.id)
                        });
                    }
                });
        });
}

function applyRateLimiting(userId) {
    db.collection('users').doc(userId).update({
        rateLimitedUntil: firebase.firestore.FieldValue.serverTimestamp(new Date(Date.now() + 3600000)), // 1 hour
        rateLimitReason: 'Excessive task completions'
    });
    
    showToast('Your account has been temporarily rate limited due to suspicious activity', 'warning');
}

// Enhanced Admin Moderation Tools
function setupAdminModeration() {
    if (!isAdmin) return;
    
    // Real-time suspicious activities feed
    db.collection('suspiciousActivities')
        .where('resolved', '==', false)
        .orderBy('timestamp', 'desc')
        .limit(50)
        .onSnapshot(snapshot => {
            const tbody = $('#suspiciousActivitiesTable tbody');
            tbody.empty();
            
            snapshot.forEach(doc => {
                const activity = doc.data();
                const date = activity.timestamp?.toDate();
                
                tbody.append(`
                    <tr>
                        <td>${doc.id.substring(0, 6)}...</td>
                        <td>${activity.type}</td>
                        <td>${JSON.stringify(activity.data)}</td>
                        <td>${date ? date.toLocaleString() : '-'}</td>
                        <td>
                            <button class="btn btn-sm btn-success me-1" onclick="resolveActivity('${doc.id}')">
                                <i class="fas fa-check"></i> Resolve
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="banUser('${activity.data.userId}')">
                                <i class="fas fa-ban"></i> Ban
                            </button>
                        </td>
                    </tr>
                `);
            });
        });
}

function resolveActivity(activityId) {
    db.collection('suspiciousActivities').doc(activityId).update({
        resolved: true,
        resolvedBy: currentUser.uid,
        resolvedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
}

function banUser(userId) {
    if (!confirm('Are you sure you want to ban this user?')) return;
    
    db.collection('users').doc(userId).update({
        isBanned: true,
        banReason: 'Suspicious activity',
        bannedBy: currentUser.uid,
        bannedAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    
    // Also terminate their active sessions
    functions.httpsCallable('terminateUserSessions')({ userId })
        .catch(error => console.error('Error terminating sessions:', error));
}

// Automated Task Verification System
function setupAutomatedVerification() {
    // This would integrate with platform APIs to automatically verify tasks
    // For demo purposes, we'll simulate verification
    
    // Check pending verifications every 5 minutes
    setInterval(() => {
        if (!currentUser) return;
        
        db.collection('taskVerifications')
            .where('userId', '==', currentUser.uid)
            .where('isVerified', '==', false)
            .get()
            .then(snapshot => {
                snapshot.forEach(doc => {
                    // Simulate verification (80% success rate)
                    const isVerified = Math.random() > 0.2;
                    
                    db.collection('taskVerifications').doc(doc.id).update({
                        isVerified,
                        verifiedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        automated: true
                    });
                    
                    if (isVerified) {
                        // Award points if verified
                        db.collection('users').doc(currentUser.uid).update({
                            credits: firebase.firestore.FieldValue.increment(doc.data().points)
                        });
                    }
                });
            });
    }, 300000);
}

// User Reputation System
function setupReputationSystem() {
    if (!currentUser) return;
    
    // Calculate reputation score based on various factors
    db.collection('users').doc(currentUser.uid)
        .onSnapshot(doc => {
            if (doc.exists) {
                const user = doc.data();
                
                // Simple reputation calculation (real app would be more sophisticated)
                const reputation = Math.min(100, 
                    (user.tasksCompleted || 0) + 
                    (user.tasksCreated || 0) * 0.5 - 
                    (user.fraudAttempts || 0) * 10
                );
                
                // Update UI
                $('#reputationScore').text(reputation);
                $('#reputationBadge').attr('class', `badge ${
                    reputation > 80 ? 'bg-success' : 
                    reputation > 50 ? 'bg-primary' : 
                    reputation > 20 ? 'bg-warning' : 'bg-danger'
                }`).text(getReputationLevel(reputation));
                
                // Store calculated reputation
                db.collection('userReputations').doc(currentUser.uid).set({
                    score: reputation,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            }
        });
}

function getReputationLevel(score) {
    if (score > 90) return 'Trusted';
    if (score > 70) return 'Reliable';
    if (score > 50) return 'Good';
    if (score > 30) return 'Fair';
    if (score > 10) return 'New';
    return 'Poor';
}

// Premium Content Delivery
function deliverPremiumContent() {
    if (!currentUser) return;
    
    db.collection('users').doc(currentUser.uid)
        .onSnapshot(doc => {
            if (doc.exists) {
                const isPremium = doc.data().premium || false;
                
                // Toggle premium features
                $('.premium-feature').toggle(isPremium);
                
                // Load premium content if user is premium
                if (isPremium) {
                    loadPremiumTasks();
                    showPremiumDashboard();
                }
            }
        });
}

function loadPremiumTasks() {
    db.collection('premiumTasks')
        .where('isActive', '==', true)
        .orderBy('createdAt', 'desc')
        .limit(50)
        .get()
        .then(snapshot => {
            const container = $('#premiumTasksContainer');
            container.empty();
            
            snapshot.forEach(doc => {
                const task = doc.data();
                container.append(createPremiumTaskCard(task, doc.id));
            });
        });
}

function createPremiumTaskCard(task, taskId) {
    return `
        <div class="card premium-task mb-3">
            <div class="card-header bg-premium text-white">
                <h5 class="card-title mb-0">${task.title}</h5>
            </div>
            <div class="card-body">
                <p class="card-text">${task.description}</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="points-badge">${task.points} Points</div>
                    <button class="btn btn-premium" onclick="startPremiumTask('${taskId}')">
                        <i class="fas fa-play"></i> Start
                    </button>
                </div>
            </div>
        </div>
    `;
}

function showPremiumDashboard() {
    $('#premiumDashboard').removeClass('d-none');
    $('#premiumStats').text('Loading premium statistics...');
    
    // Load premium stats
    db.collection('premiumStats').doc(currentUser.uid).get()
        .then(doc => {
            if (doc.exists) {
                const stats = doc.data();
                $('#premiumStats').html(`
                    <div class="stat-card">
                        <h6>Premium Earnings</h6>
                        <h3>${stats.totalEarnings || 0} Points</h3>
                    </div>
                    <div class="stat-card">
                        <h6>Exclusive Tasks</h6>
                        <h3>${stats.completedTasks || 0} Completed</h3>
                    </div>
                `);
            }
        });
}

// Final Initialization
$(document).ready(() => {
    // Initialize additional systems
    setupFraudDetection();
    setupAdminModeration();
    setupAutomatedVerification();
    setupReputationSystem();
    deliverPremiumContent();
    
    // Set up periodic data refreshes
    setInterval(() => {
        if (currentUser) {
            loadUserData(currentUser.uid);
        }
    }, 300000); // Refresh every 5 minutes
    
    // Add remaining global functions
    window.resolveActivity = resolveActivity;
    window.banUser = banUser;
    window.startPremiumTask = startPremiumTask;
});

// Premium Task Handling
function startPremiumTask(taskId) {
    if (!currentUser) return;
    
    showLoading(true);
    
    db.collection('premiumTasks').doc(taskId).get()
        .then(doc => {
            if (!doc.exists) {
                throw new Error('Premium task not found');
            }
            
            const task = doc.data();
            
            // Verify user hasn't already completed this task
            return db.collection('premiumTaskCompletions')
                .where('userId', '==', currentUser.uid)
                .where('taskId', '==', taskId)
                .get()
                .then(snapshot => {
                    if (!snapshot.empty) {
                        throw new Error('You have already completed this premium task');
                    }
                    
                    // Show task details
                    showPremiumTaskDetails(task, doc.id);
                });
        })
        .catch(error => {
            showToast(error.message, 'danger');
        })
        .finally(() => {
            showLoading(false);
        });
}

function showPremiumTaskDetails(task, taskId) {
    $('#premiumTaskModal .modal-title').text(task.title);
    $('#premiumTaskDescription').text(task.detailedDescription || task.description);
    $('#premiumTaskPoints').text(task.points);
    $('#premiumTaskRequirements').html(
        task.requirements ? task.requirements.map(req => `<li>${req}</li>`).join('') : '<li>No special requirements</li>'
    );
    
    // Set up completion button
    $('#completePremiumTaskBtn').off('click').on('click', () => {
        completePremiumTask(taskId, task.points);
    });
    
    $('#premiumTaskModal').modal('show');
}

function completePremiumTask(taskId, points) {
    if (!currentUser) return;
    
    showLoading(true);
    
    // Record task completion
    db.collection('premiumTaskCompletions').add({
        taskId,
        userId: currentUser.uid,
        points,
        completedAt: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
        // Award points
        return db.collection('users').doc(currentUser.uid).update({
            credits: firebase.firestore.FieldValue.increment(points),
            premiumPointsEarned: firebase.firestore.FieldValue.increment(points)
        });
    })
    .then(() => {
        // Update premium stats
        return db.collection('premiumStats').doc(currentUser.uid).set({
            totalEarnings: firebase.firestore.FieldValue.increment(points),
            completedTasks: firebase.firestore.FieldValue.increment(1),
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
    })
    .then(() => {
        showToast(`Premium task completed! You earned ${points} points.`, 'success');
        $('#premiumTaskModal').modal('hide');
        
        // Refresh premium content
        loadPremiumTasks();
        showPremiumDashboard();
    })
    .catch(error => {
        console.error('Error completing premium task:', error);
        showToast('Error completing premium task', 'danger');
    })
    .finally(() => {
        showLoading(false);
    });
}

// Export additional global functions
window.startPremiumTask = startPremiumTask;
window.completePremiumTask = completePremiumTask;

   // Premium Task System Implementation
function startPremiumTask(taskId) {
    if (!currentUser) {
        showToast('Please login to access premium tasks', 'warning');
        return;
    }

    showLoading(true);
    
    // Verify user has premium access
    db.collection('users').doc(currentUser.uid).get()
        .then(doc => {
            if (!doc.exists || !doc.data().premium) {
                throw new Error('Premium membership required');
            }
            
            // Get premium task details
            return db.collection('premiumTasks').doc(taskId).get();
        })
        .then(doc => {
            if (!doc.exists) {
                throw new Error('Premium task not found');
            }
            
            const task = doc.data();
            currentTask = { id: doc.id, ...task };
            
            // Show premium task modal
            $('#premiumTaskModal').modal('show');
            $('#premiumTaskTitle').text(task.title);
            $('#premiumTaskDescription').text(task.description);
            $('#premiumTaskPoints').text(`${task.reward} Points`);
            $('#premiumTaskLink').attr('href', task.url);
            
            // Start premium task timer (longer than regular tasks)
            startPremiumCountdown(60); // 60 seconds for premium tasks
            
            showLoading(false);
        })
        .catch(error => {
            showLoading(false);
            console.error('Premium task error:', error);
            showToast(error.message || 'Error starting premium task', 'danger');
            
            // Show upgrade prompt if not premium
            if (error.message.includes('Premium membership required')) {
                showPremiumUpsell();
            }
        });
}

function startPremiumCountdown(seconds) {
    countdownSeconds = seconds;
    updatePremiumCountdownDisplay();
    
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }
    
    countdownInterval = setInterval(() => {
        countdownSeconds--;
        updatePremiumCountdownDisplay();
        
        if (countdownSeconds <= 0) {
            clearInterval(countdownInterval);
            countdownInterval = null;
            showToast('Premium task time is up!', 'warning');
        }
    }, 1000);
}

function updatePremiumCountdownDisplay() {
    const minutes = Math.floor(countdownSeconds / 60);
    const seconds = countdownSeconds % 60;
    $('#premiumCountdownTimer').text(`${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`);
}

function completePremiumTask() {
    if (!currentUser || !currentTask) return;
    
    showLoading(true);
    
    // Verify task completion with additional checks for premium tasks
    verifyPremiumTaskCompletion(currentTask.id)
        .then(verified => {
            if (!verified) {
                throw new Error('Premium task completion could not be verified');
            }
            
            // Create premium task completion record
            const completionData = {
                taskId: currentTask.id,
                userId: currentUser.uid,
                completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                creditsEarned: currentTask.reward,
                isPremium: true
            };
            
            return db.collection('taskCompletions').add(completionData);
        })
        .then(() => {
            // Award premium points to user
            return db.collection('users').doc(currentUser.uid).update({
                credits: firebase.firestore.FieldValue.increment(currentTask.reward),
                premiumTasksCompleted: firebase.firestore.FieldValue.increment(1),
                pointsEarned: firebase.firestore.FieldValue.increment(currentTask.reward)
            });
        })
        .then(() => {
            // Log premium activity
            return logActivity(currentUser.uid, 'premium_task_completed', currentTask.reward, 
                `Completed premium task: ${currentTask.title}`);
        })
        .then(() => {
            showLoading(false);
            showToast(`Premium task completed! You earned ${currentTask.reward} points.`, 'success');
            
            // Close modal and reset
            $('#premiumTaskModal').modal('hide');
            resetCurrentTask();
            
            // Reload user data
            loadUserData(currentUser.uid);
        })
        .catch(error => {
            showLoading(false);
            console.error('Premium task completion error:', error);
            showToast(error.message || 'Error completing premium task', 'danger');
        });
}

function verifyPremiumTaskCompletion(taskId) {
    // More rigorous verification for premium tasks
    return new Promise((resolve) => {
        // In a real app, this would verify with platform APIs and possibly manual review
        setTimeout(() => {
            resolve(Math.random() > 0.8); // 80% success rate for demo
        }, 2000);
    });
}

// Premium Task Management (Admin)
function loadPremiumTasks() {
    if (!isAdmin) return;
    
    showLoading(true);
    
    db.collection('premiumTasks')
        .orderBy('createdAt', 'desc')
        .get()
        .then(querySnapshot => {
            const tbody = $('#premiumTasksTable tbody');
            tbody.empty();
            
            if (querySnapshot.empty) {
                tbody.append('<tr><td colspan="6" class="text-center">No premium tasks found</td></tr>');
            } else {
                querySnapshot.forEach(doc => {
                    const task = doc.data();
                    const date = task.createdAt?.toDate();
                    
                    tbody.append(`
                        <tr>
                            <td>${doc.id.substring(0, 6)}...</td>
                            <td>${task.title}</td>
                            <td>${task.platform}</td>
                            <td>${task.reward}</td>
                            <td>${task.completedCount || 0}</td>
                            <td>
                                <button class="btn btn-sm btn-primary me-1" onclick="editPremiumTask('${doc.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="showDeleteConfirmation('premium_task', '${doc.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
            
            showLoading(false);
        })
        .catch(error => {
            showLoading(false);
            console.error('Error loading premium tasks:', error);
            showToast('Error loading premium tasks', 'danger');
        });
}

function editPremiumTask(taskId) {
    showLoading(true);
    
    db.collection('premiumTasks').doc(taskId).get()
        .then(doc => {
            if (doc.exists) {
                const task = doc.data();
                
                // Populate the add premium task modal
                $('#premiumTaskTitleInput').val(task.title);
                $('#premiumTaskPlatform').val(task.platform);
                $('#premiumTaskUrl').val(task.url);
                $('#premiumTaskReward').val(task.reward);
                $('#premiumTaskDescriptionInput').val(task.description);
                $('#premiumTaskStatus').val(task.isActive ? 'active' : 'inactive');
                
                // Change modal title and button
                $('#addPremiumTaskModal .modal-title').text('Edit Premium Task');
                $('#confirmAddPremiumTaskBtn').text('Update Task').data('taskId', taskId);
                
                // Show modal
                $('#addPremiumTaskModal').modal('show');
            } else {
                showToast('Premium task not found', 'danger');
            }
            
            showLoading(false);
        })
        .catch(error => {
            showLoading(false);
            console.error('Error loading premium task:', error);
            showToast('Error loading premium task', 'danger');
        });
}

function savePremiumTask(taskId = null) {
    const taskData = {
        title: $('#premiumTaskTitleInput').val(),
        platform: $('#premiumTaskPlatform').val(),
        url: $('#premiumTaskUrl').val(),
        reward: parseInt($('#premiumTaskReward').val()),
        description: $('#premiumTaskDescriptionInput').val(),
        isActive: $('#premiumTaskStatus').val() === 'active',
        createdAt: taskId ? undefined : firebase.firestore.FieldValue.serverTimestamp(),
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    showLoading(true);
    
    const taskPromise = taskId ? 
        db.collection('premiumTasks').doc(taskId).update(taskData) :
        db.collection('premiumTasks').add(taskData);
    
    taskPromise
        .then(() => {
            showLoading(false);
            $('#addPremiumTaskModal').modal('hide');
            showToast(`Premium task ${taskId ? 'updated' : 'created'} successfully`, 'success');
            loadPremiumTasks();
        })
        .catch(error => {
            showLoading(false);
            console.error('Error saving premium task:', error);
            showToast('Error saving premium task', 'danger');
        });
}

// Premium Features UI
function initPremiumFeaturesUI() {
    // Add Premium Tasks section to admin panel
    if (isAdmin) {
        $('.admin-content-section').append(`
            <div id="adminPremiumTasks" class="admin-content-section hidden">
                <h2 class="mb-4">Premium Task Management</h2>
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">Premium Tasks</h5>
                        <button class="btn btn-primary" id="adminAddPremiumTaskBtn">
                            <i class="fas fa-plus me-1"></i> Add Premium Task
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="premiumTasksTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>Platform</th>
                                        <th>Reward</th>
                                        <th>Completed</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Premium tasks will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        `);
        
        // Add Premium Tasks link to admin sidebar
        $('.admin-sidebar .nav-pills').append(`
            <li>
                <a href="#admin-premium-tasks" class="nav-link" id="adminPremiumTasksLink">
                    <i class="fas fa-crown me-2"></i> Premium Tasks
                </a>
            </li>
        `);
        
        // Add Premium Task modal
        $('body').append(`
            <div class="modal fade" id="addPremiumTaskModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Add Premium Task</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="addPremiumTaskForm">
                                <div class="mb-3">
                                    <label for="premiumTaskTitleInput" class="form-label">Task Title</label>
                                    <input type="text" class="form-control" id="premiumTaskTitleInput" required>
                                </div>
                                <div class="mb-3">
                                    <label for="premiumTaskPlatform" class="form-label">Platform</label>
                                    <select class="form-select" id="premiumTaskPlatform" required>
                                        <option value="instagram">Instagram</option>
                                        <option value="facebook">Facebook</option>
                                        <option value="youtube">YouTube</option>
                                        <option value="tiktok">TikTok</option>
                                        <option value="twitter">Twitter</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="premiumTaskUrl" class="form-label">Target URL</label>
                                    <input type="url" class="form-control" id="premiumTaskUrl" required>
                                </div>
                                <div class="mb-3">
                                    <label for="premiumTaskReward" class="form-label">Point Reward</label>
                                    <input type="number" class="form-control" id="premiumTaskReward" min="50" value="100" required>
                                </div>
                                <div class="mb-3">
                                    <label for="premiumTaskDescriptionInput" class="form-label">Description</label>
                                    <textarea class="form-control" id="premiumTaskDescriptionInput" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="premiumTaskStatus" class="form-label">Status</label>
                                    <select class="form-select" id="premiumTaskStatus">
                                        <option value="active" selected>Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" id="confirmAddPremiumTaskBtn">Save Task</button>
                        </div>
                    </div>
                </div>
            </div>
        `);
        
        // Add Premium Task modal for users
        $('body').append(`
            <div class="modal fade" id="premiumTaskModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-warning text-dark">
                            <h5 class="modal-title" id="premiumTaskTitle">Premium Task</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p id="premiumTaskDescription">Task description goes here</p>
                            <p><strong>Platform:</strong> <span id="premiumTaskPlatformText"></span></p>
                            <p><strong>Reward:</strong> <span id="premiumTaskPoints" class="text-success">0 Points</span></p>
                            <a href="#" class="btn btn-primary mb-3" target="_blank" id="premiumTaskLink">Go to Task</a>
                            <div class="countdown-timer" id="premiumCountdownTimer">01:00</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-success" id="completePremiumTaskBtn">Complete Task</button>
                        </div>
                    </div>
                </div>
            </div>
        `);
        
        // Setup event listeners for premium features
        $('#adminPremiumTasksLink').click(function(e) {
            e.preventDefault();
            $('.admin-content-section').addClass('hidden');
            $('#adminPremiumTasks').removeClass('hidden');
            $(this).addClass('active').siblings().removeClass('active');
            loadPremiumTasks();
        });
        
        $('#adminAddPremiumTaskBtn').click(function() {
            $('#addPremiumTaskForm')[0].reset();
            $('#addPremiumTaskModal .modal-title').text('Add Premium Task');
            $('#confirmAddPremiumTaskBtn').text('Add Task').removeData('taskId');
            $('#addPremiumTaskModal').modal('show');
        });
        
        $('#confirmAddPremiumTaskBtn').click(function() {
            const taskId = $(this).data('taskId');
            savePremiumTask(taskId);
        });
        
        $('#completePremiumTaskBtn').click(completePremiumTask);
    }
    
    // Add premium tasks section to user dashboard
    if (currentUser && !isAdmin) {
        $('#earnPointsSection .col-md-8').prepend(`
            <div class="card mb-4 border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="card-title mb-0">Premium Tasks</h5>
                </div>
                <div class="card-body">
                    <p>Complete premium tasks to earn more points. These tasks offer higher rewards!</p>
                    <div id="premiumTasksList">
                        <div class="text-center py-3">
                            <div class="spinner-border text-warning" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading premium tasks...</p>
                        </div>
                    </div>
                </div>
            </div>
        `);
        
        // Load premium tasks for users
        loadUserPremiumTasks();
    }
}

function loadUserPremiumTasks() {
    if (!currentUser) return;
    
    showLoading(true);
    
    db.collection('premiumTasks')
        .where('isActive', '==', true)
        .orderBy('createdAt', 'desc')
        .limit(10)
        .get()
        .then(querySnapshot => {
            const tasksList = $('#premiumTasksList');
            tasksList.empty();
            
            if (querySnapshot.empty) {
                tasksList.html(`
                    <div class="alert alert-info">
                        No premium tasks available at the moment. Check back later or upgrade to premium for exclusive tasks.
                    </div>
                `);
            } else {
                querySnapshot.forEach(doc => {
                    const task = doc.data();
                    const date = task.createdAt?.toDate();
                    
                    tasksList.append(`
                        <div class="card task-item mb-3 border-warning">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h5 class="card-title">${task.title}</h5>
                                        <p class="card-text text-muted">
                                            <small>${capitalizeFirstLetter(task.platform)} • Posted: ${date ? date.toLocaleString() : '-'}</small>
                                        </p>
                                        <p class="card-text">${task.description}</p>
                                    </div>
                                    <div class="text-end">
                                        <div class="points-badge bg-warning mb-2">${task.reward} Points</div>
                                        <button class="btn btn-warning btn-sm" onclick="startPremiumTask('${doc.id}')">
                                            <i class="fas fa-crown me-1"></i> Start
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `);
                });
            }
            
            showLoading(false);
        })
        .catch(error => {
            showLoading(false);
            console.error('Error loading premium tasks:', error);
            showToast('Error loading premium tasks', 'danger');
        });
}

// Initialize premium features when app starts
function initPremiumFeatures() {
    // Check if user has premium access
    if (currentUser) {
        db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
            if (doc.exists) {
                const isPremium = doc.data().premium || false;
                
                // Toggle premium UI elements
                $('.premium-feature').toggle(isPremium);
                
                // Load premium tasks if user is premium
                if (isPremium) {
                    loadUserPremiumTasks();
                }
            }
        });
    }
    
    // Initialize premium UI for admin
    if (isAdmin) {
        initPremiumFeaturesUI();
    }
}

// Final Initialization
$(document).ready(() => {
    // Initialize premium features
    initPremiumFeatures();
    
    // Add global functions
    window.startPremiumTask = startPremiumTask;
    window.completePremiumTask = completePremiumTask;
    window.loadPremiumTasks = loadPremiumTasks;
    window.editPremiumTask = editPremiumTask;
});
</script>
    <script>
document.addEventListener("DOMContentLoaded", function () {
    // إظهار قسم المصادقة وإظهار النموذج الصحيح
    function showAuthSection(tabId) {
        document.getElementById("authSection").classList.remove("hidden");
        document.getElementById("login").classList.add("hidden");
        document.getElementById("register").classList.add("hidden");
        document.getElementById("reset").classList.add("hidden");
        document.getElementById(tabId).classList.remove("hidden");
        window.scrollTo({ top: document.getElementById("authSection").offsetTop, behavior: 'smooth' });
    }

    // زر "Get Started - It's Free"
    document.getElementById("heroRegisterBtn")?.addEventListener("click", function (e) {
        e.preventDefault();
        showAuthSection("register");
    });

    // زر "Register" في navbar
    document.getElementById("registerBtn")?.addEventListener("click", function (e) {
        e.preventDefault();
        showAuthSection("register");
    });

    // زر "Login" في navbar
    document.getElementById("loginBtn")?.addEventListener("click", function (e) {
        e.preventDefault();
        showAuthSection("login");
    });

    // زر التبديل داخل صفحة المصادقة
    document.getElementById("showRegisterForm")?.addEventListener("click", function () {
        showAuthSection("register");
    });

    document.getElementById("showLoginForm")?.addEventListener("click", function () {
        showAuthSection("login");
    });

    document.getElementById("showResetForm")?.addEventListener("click", function () {
        showAuthSection("reset");
    });

    document.getElementById("backToLoginForm")?.addEventListener("click", function () {
        showAuthSection("login");
    });
});
    </script>
</body>
</html>
