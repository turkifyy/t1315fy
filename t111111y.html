<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة السنافر - مشاهدة المسلسلات والأفلام</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Slick Carousel -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">
    <!-- amCharts for visitor map -->
    <link rel="stylesheet" href="https://cdn.amcharts.com/lib/5/plugins/export/export.css">
    <style>
        /* متغيرات التصميم */
        :root {
            --primary-color: #E50914;
            --dark-color: #141414;
            --light-color: #f4f4f4;
            --secondary-color: #6D6D6D;
            --ad-color: #FFA500;
            --navbar-height: 70px;
            --transition-speed: 0.3s;
            --button-size: 1.5rem;
        }

        /* إعادة تعيين الأنماط */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--dark-color);
            color: var(--light-color);
            line-height: 1.6;
            padding-top: var(--navbar-height);
            transition: all var(--transition-speed);
        }

        /* شريط التنقل العلوي */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--navbar-height);
            background-color: var(--dark-color);
            z-index: 1000;
            display: flex;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .navbar-container {
            width: 100%;
            max-width: 1600px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-img {
            height: 40px;
            width: auto;
            transition: transform var(--transition-speed);
        }

        .logo-img:hover {
            transform: scale(1.05);
        }

        .nav-menu {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            margin: 0 15px;
            position: relative;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 500;
            transition: color var(--transition-speed);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color);
        }

        .nav-link i {
            font-size: 0.9em;
        }

        .search-box {
            display: flex;
            align-items: center;
            position: relative;
            margin-left: 20px;
        }

        .search-box input {
            padding: 8px 15px;
            border-radius: 20px;
            border: none;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            width: 200px;
            transition: width var(--transition-speed);
            font-size: 0.9rem;
        }

        .search-box input:focus {
            width: 300px;
            outline: none;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .search-box button {
            background: none;
            border: none;
            color: white;
            margin-right: -35px;
            z-index: 1;
            cursor: pointer;
            transition: color var(--transition-speed);
        }

        .search-box button:hover {
            color: var(--primary-color);
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
            margin-left: 20px;
        }

        .auth-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .auth-btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .auth-btn.secondary {
            background-color: transparent;
            border: 1px solid var(--primary-color);
        }

        /* أقسام الصفحة */
        .page {
            display: none;
            padding: 20px 0;
            min-height: calc(100vh - var(--navbar-height));
        }

        .page.active {
            display: block;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* شريط البطل Netflix-style */
        .hero-slider {
            width: 100%;
            height: 70vh;
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .hero-slide {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex !important;
            align-items: center;
            padding: 0 60px;
        }

        .slide-content {
            max-width: 600px;
            z-index: 2;
            position: relative;
        }

        .slide-title {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: 700;
        }

        .slide-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .slide-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .slide-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .slide-actions {
            display: flex;
            gap: 15px;
        }

        .slide-play-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-speed);
            font-weight: 600;
        }

        .slide-play-btn:hover {
            background-color: #f40612;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.4);
        }

        .slide-info-btn {
            background-color: rgba(109, 109, 109, 0.7);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-speed);
            font-weight: 600;
        }

        .slide-info-btn:hover {
            background-color: rgba(109, 109, 109, 0.9);
        }

        .slide-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.2) 100%);
            z-index: 1;
        }

        /* صفحة تفاصيل المسلسل */
        .series-detail {
            width: 100%;
        }

        .series-backdrop {
            width: 100%;
            height: 70vh;
            background-size: cover;
            background-position: center;
            position: relative;
            display: flex;
            padding: 0 60px;
            align-items: center;
        }

        .backdrop-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.2) 100%);
            z-index: 1;
        }

        .series-poster {
            position: relative;
            width: 300px;
            height: 450px;
            margin-left: 50px;
            z-index: 2;
            flex-shrink: 0;
        }

        .series-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .series-poster .play-btn {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all var(--transition-speed);
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .series-poster .play-btn:hover {
            background-color: #f40612;
            transform: translateX(-50%) scale(1.05);
        }

        .series-info {
            z-index: 2;
            max-width: 600px;
        }

        .series-info h1 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .series-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .series-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .series-description {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .season-section {
            margin-top: 40px;
        }

        .season-section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .other-seasons {
            margin-top: 40px;
        }

        .related-series {
            margin-top: 40px;
        }

        /* مشغل الفيديو */
        .player-section {
            width: 100%;
            background-color: #000;
            position: relative;
            display: none;
        }

        .video-container {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* نسبة 16:9 */
            position: relative;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* الإعلانات */
        .ad-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: none;
            z-index: 100;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .ad-content {
            width: 100%;
            height: 100%;
            background-color: #222;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .ad-skip {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            z-index: 30;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            border: none;
            transition: all var(--transition-speed);
        }

        .ad-skip:hover {
            background-color: rgba(0, 0, 0, 0.9);
        }

        .ad-countdown {
            position: absolute;
            bottom: 20px;
            left: 120px;
            color: white;
            font-size: 0.9rem;
        }

        .channel-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            height: 50px;
            width: auto;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-radius: 5px;
        }

        /* إعلان شريطي */
        .banner-ad {
            width: 100%;
            height: 90px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        /* معلومات التشغيل الحالي */
        .now-playing-info {
            padding: 20px 40px;
            background-color: rgba(20, 20, 20, 0.9);
            border-bottom: 1px solid #333;
            display: none;
        }

        .now-playing-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .badge {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .imdb-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #FFD700;
            font-weight: bold;
        }

        .now-playing-meta {
            display: flex;
            gap: 15px;
            color: var(--secondary-color);
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .episode-stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all var(--transition-speed);
            font-size: var(--button-size);
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .stat:hover {
            color: var(--primary-color);
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* أقسام المحتوى */
        .section {
            padding: 40px 0;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-tabs {
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .tab-btn:hover, .tab-btn.active {
            background-color: var(--primary-color);
        }

        /* شبكات المحتوى */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .content-card {
            position: relative;
            cursor: pointer;
            transition: transform var(--transition-speed);
            border-radius: 5px;
            overflow: hidden;
            background-color: #222;
        }

        .content-card:hover {
            transform: scale(1.05);
            z-index: 2;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .content-thumbnail {
            width: 100%;
            height: 0;
            padding-bottom: 150%;
            background-color: #333;
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .episode-thumbnail {
            padding-bottom: 56.25%; /* نسبة 16:9 للحلقات */
        }

        .content-info {
            padding: 15px 10px;
            background-color: rgba(20, 20, 20, 0.9);
        }

        .content-title {
            font-size: 1rem;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: bold;
        }

        .content-meta {
            font-size: 0.8rem;
            color: var(--secondary-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .content-stats {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--secondary-color);
        }

        .progress-container {
            width: 100%;
            height: 3px;
            background-color: #444;
            margin-top: 8px;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
        }

        .episode-number {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid var(--primary-color);
        }

        .free-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* لوحة الإدارة */
        .admin-panel {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 30px;
            margin: 20px;
            border-radius: 10px;
            display: none;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
            overflow-y: auto;
            max-height: 90vh;
            position: fixed;
            top: var(--navbar-height);
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .admin-tab {
            background: none;
            border: none;
            color: white;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 4px;
            transition: all var(--transition-speed);
        }

        .admin-tab:hover, .admin-tab.active {
            background-color: var(--primary-color);
        }

        .admin-tab-content {
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .admin-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .admin-label {
            font-size: 0.9rem;
            color: #ccc;
        }

        .admin-input {
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
            transition: all var(--transition-speed);
        }

        .admin-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .admin-select {
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
        }

        .admin-textarea {
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            color: white;
            border-radius: 5px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
        }

        .admin-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: opacity var(--transition-speed);
            font-size: 1rem;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-btn:hover {
            opacity: 0.9;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background-color: #333;
            padding: 15px;
            border-radius: 5px;
        }

        .stat-title {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .stat-details {
            font-size: 0.9rem;
            color: #ccc;
        }

        .admin-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .admin-list-item {
            background-color: #444;
            padding: 15px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-item-thumb {
            width: 80px;
            height: 120px;
            object-fit: cover;
            border-radius: 4px;
        }

        .admin-item-actions {
            display: flex;
            gap: 10px;
        }

        .edit-btn {
            background-color: #4CAF50;
        }

        .delete-btn {
            background-color: #f44336;
        }

        /* زر تبديل الإدارة */
        .admin-toggle {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            transition: transform var(--transition-speed);
        }

        .admin-toggle:hover {
            transform: scale(1.1);
        }

        /* رسائل التحميل والأخطاء */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
        }

        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 2000;
            display: none;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .success-message {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 2000;
            display: none;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        /* صفحة الملف الشخصي */
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-name {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .profile-email {
            color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 30px;
        }

        .profile-stat {
            background-color: #222;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }

        .profile-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        .watch-history {
            width: 100%;
            max-width: 1000px;
        }

        /* تصميم متجاوب */
        @media (max-width: 1200px) {
            .content-grid, .episodes-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .slide-title {
                font-size: 2.5rem;
            }
            
            .series-poster {
                width: 250px;
                height: 375px;
            }
        }
        
        @media (max-width: 992px) {
            .navbar-container {
                flex-wrap: wrap;
                height: auto;
                padding: 10px;
            }
            
            .nav-menu {
                order: 3;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
            
            .search-box {
                order: 2;
                width: 100%;
                margin: 10px 0;
            }
            
            .section, .now-playing-info {
                padding: 30px 20px;
            }
            
            .now-playing-title {
                font-size: 1.5rem;
            }
            
            .slide-title {
                font-size: 2rem;
            }
            
            .slide-description {
                font-size: 1rem;
            }
            
            .admin-panel {
                padding: 20px 15px;
                margin: 15px;
            }
            
            .admin-toggle {
                width: 50px;
                height: 50px;
                bottom: 20px;
                left: 20px;
            }
            
            .search-box input {
                width: 100%;
            }
            
            .search-box input:focus {
                width: 100%;
            }
            
            .hero-slide, .series-backdrop {
                padding: 0 30px;
            }
            
            .series-poster {
                margin-left: 30px;
            }
        }
        
        @media (max-width: 768px) {
            .content-grid, .episodes-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            
            .logo-img {
                height: 30px;
            }
            
            .channel-logo {
                height: 40px;
                top: 15px;
                right: 15px;
            }
            
            .now-playing-title {
                font-size: 1.3rem;
            }
            
            .now-playing-meta {
                flex-direction: column;
                gap: 5px;
                font-size: 0.9rem;
            }
            
            .section-tabs {
                flex-direction: column;
                gap: 5px;
            }
            
            .ad-skip {
                bottom: 10px;
                left: 10px;
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .ad-countdown {
                bottom: 10px;
                left: 90px;
                font-size: 0.8rem;
            }
            
            .stat {
                font-size: 1rem;
                padding: 8px 10px;
            }
            
            .hero-slide, .series-backdrop {
                padding: 0 20px;
                flex-direction: column;
                justify-content: center;
                text-align: center;
            }
            
            .slide-title {
                font-size: 1.5rem;
            }
            
            .slide-description {
                display: none;
            }
            
            .slide-play-btn {
                padding: 10px 15px;
                font-size: 1rem;
            }

            .profile-stats {
                grid-template-columns: 1fr;
            }
            
            .series-poster {
                margin-left: 0;
                margin-bottom: 20px;
                width: 200px;
                height: 300px;
            }
            
            .series-info {
                text-align: center;
            }
        }
        
        @media (max-width: 576px) {
            .content-grid, .episodes-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 10px;
                padding: 15px;
            }
            
            .logo-container {
                width: 100%;
                justify-content: center;
            }
            
            .search-box {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
            
            .auth-buttons {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
                justify-content: center;
            }
            
            .hero-slider, .series-backdrop {
                height: 60vh;
            }
            
            .slide-content, .series-info {
                max-width: 100%;
            }
            
            .slide-meta, .series-meta {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* وضع النهار (تجريبي) */
        body.light-mode {
            background-color: #f5f5f5;
            color: #333;
        }

        body.light-mode .navbar {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body.light-mode .nav-link {
            color: #333;
        }

        body.light-mode .content-info,
        body.light-mode .content-list-item,
        body.light-mode .stat-card {
            background-color: #fff;
            color: #333;
        }

        body.light-mode .content-title,
        body.light-mode .content-list-title {
            color: #333;
        }
        .profile-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    overflow-x: auto;
    padding-bottom: 10px;
    width: 100%;
}

.profile-tab {
    background: #333;
    border: none;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    white-space: nowrap;
}

.profile-tab.active {
    background: var(--primary-color);
}

.profile-tab-content {
    display: none;
    width: 100%;
}

.profile-tab-content.active {
    display: block;
}
    </style>
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="logo-container">
                <img src="https://via.placeholder.com/150x50?text=SMURFS+LOGO" alt="سنافر" class="logo-img" loading="lazy">
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item"><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i> الصفحة الرئيسية</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="series"><i class="fas fa-tv"></i> المسلسلات</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="movies"><i class="fas fa-film"></i> الأفلام</a></li>
                <li class="nav-item"><a href="#" class="nav-link" data-page="profile"><i class="fas fa-user"></i> الملف الشخصي</a></li>
            </ul>
            
            <div class="search-box">
                <input type="text" placeholder="ابحث عن مسلسل أو فيلم...">
                <button><i class="fas fa-search"></i></button>
            </div>
            
            <div class="auth-buttons" style="display:none;">
    <button id="signOutButton" class="auth-btn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
            </div>
        </div>
    </nav>

    <!-- الصفحة الرئيسية -->
    <div id="home-page" class="page active">
        <!-- شريط البطل Netflix-style -->
        <section class="hero-slider" id="heroSlider">
            <!-- سيتم تحميل العناصر ديناميكيًا -->
        </section>
        
        <!-- قسم المسلسلات -->
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>أحدث المسلسلات</span>
                </h3>
                <div class="content-grid" id="seriesGrid">
                    <!-- سيتم تحميل المسلسلات ديناميكيًا -->
                </div>
            </div>
        </section>
        
        <!-- قسم الأفلام -->
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>أحدث الأفلام</span>
                </h3>
                <div class="content-grid" id="moviesGrid">
                    <!-- سيتم تحميل الأفلام ديناميكيًا -->
                </div>
            </div>
        </section>
    </div>

    <!-- صفحة المسلسلات -->
    <div id="series-page" class="page">
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>جميع المسلسلات</span>
                </h3>
                <div class="content-grid" id="allSeriesGrid">
                    <!-- سيتم تحميل جميع المسلسلات ديناميكيًا -->
                </div>
            </div>
        </section>
    </div>

    <!-- صفحة الأفلام -->
    <div id="movies-page" class="page">
        <section class="section">
            <div class="container">
                <h3 class="section-title">
                    <span>جميع الأفلام</span>
                </h3>
                <div class="content-grid" id="allMoviesGrid">
                    <!-- سيتم تحميل جميع الأفلام ديناميكيًا -->
                </div>
            </div>
        </section>
    </div>

    <!-- صفحة تفاصيل المسلسل -->
    <div id="series-detail-page" class="page" style="display: none;">
        <!-- سيتم تحميل محتوى تفاصيل المسلسل ديناميكيًا -->
    </div>

    <!-- صفحة الملف الشخصي -->
    <div id="profile-page" class="page">
        <div class="container profile-container">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h2 class="profile-name" id="profileName">زائر</h2>
            <p class="profile-email" id="profileEmail">يجب تسجيل الدخول لعرض المعلومات</p>
            
            <div class="profile-tabs">
    <button class="profile-tab active" data-tab="history">سجل المشاهدة</button>
    <button class="profile-tab" data-tab="watchlater">مشاهدة لاحقًا</button>
    <button class="profile-tab" data-tab="continue">استكمال المشاهدة</button>
    <button class="profile-tab" data-tab="favorites">المفضلة</button>
</div>

<div class="profile-tab-content active" id="historyTab">
    <div class="content-grid" id="watchHistoryGrid"></div>
</div>

<div class="profile-tab-content" id="watchlaterTab">
    <div class="content-grid" id="watchLaterGrid"></div>
</div>

<div class="profile-tab-content" id="continueTab">
    <div class="content-grid" id="continueWatchingGrid"></div>
</div>

<div class="profile-tab-content" id="favoritesTab">
    <div class="content-grid" id="favoritesGrid"></div>
</div>
            
            <div class="watch-history">
                <h3 class="section-title">
                    <span>سجل المشاهدة</span>
                </h3>
                <div class="content-grid" id="watchHistoryGrid">
                    <!-- سيتم تحميل سجل المشاهدة ديناميكيًا -->
                </div>
            </div>
        </div>
    </div>

    <!-- مشغل الفيديو -->
    <section class="player-section" id="playerSection">
        <!-- إعلان ما قبل التشغيل -->
        <div class="ad-overlay" id="adOverlay">
            <div class="ad-content" id="adContent">
                <button class="ad-skip" id="adSkip">
                    <i class="fas fa-forward"></i> تخطي الإعلان
                </button>
                <div class="ad-countdown" id="adCountdown">الإعلان ينتهي بعد 5 ثواني</div>
            </div>
        </div>
        
        <div class="video-container">
            <iframe id="videoPlayer" src="" allowfullscreen></iframe>
            <img src="https://via.placeholder.com/100x50?text=قناة+السنافر" alt="قناة السنافر" class="channel-logo" loading="lazy">
        </div>
    </section>

    <!-- معلومات التشغيل الحالي -->
    <div class="now-playing-info" id="nowPlayingInfo">
        <h2 class="now-playing-title" id="nowPlayingTitle">
            <span id="nowPlayingTitleText">اختر حلقة للمشاهدة</span>
            <span class="badge">Free</span>
            <span class="imdb-rating">
                <i class="fas fa-star"></i>
                <span id="imdbRating">7.5</span>
            </span>
        </h2>
        <div class="now-playing-meta">
            <span id="nowPlayingNumber"></span>
            <span id="nowPlayingDuration"></span>
        </div>
        <div class="episode-stats">
            <div class="stat" id="viewsStat">
                <i class="fas fa-eye"></i>
                <span id="viewsCount">0</span> مشاهدة
            </div>
            <div class="stat interaction-btn" id="likesStat">
                <i class="fas fa-thumbs-up"></i>
                <span id="likesCount">0</span>
            </div>
            <div class="stat interaction-btn" id="dislikesStat">
                <i class="fas fa-thumbs-down"></i>
                <span id="dislikesCount">0</span>
            </div>
        </div>
    </div>

    <!-- لوحة الإدارة -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="series">إدارة المسلسلات</button>
            <button class="admin-tab" data-tab="episodes">إدارة الحلقات</button>
            <button class="admin-tab" data-tab="movies">إدارة الأفلام</button>
            <button class="admin-tab" data-tab="ads">إدارة الإعلانات</button>
            <button class="admin-tab" data-tab="stats">إحصائيات المشاهدات</button>
            <button class="admin-tab" data-tab="visitors">إحصائيات الزوار</button>
            <button class="admin-tab" data-tab="settings">الإعدادات</button>
        </div>
        
        <!-- تبويب إدارة المسلسلات -->
        <div class="admin-tab-content active" id="seriesTab">
            <h3 class="admin-title">إدارة المسلسلات</h3>
            <button id="addSeriesBtn" class="admin-btn"><i class="fas fa-plus"></i> إضافة مسلسل جديد</button>
            
            <div id="seriesForm" style="display: none; margin-top: 20px;">
                <div class="admin-controls">
                    <div class="admin-group">
                        <label class="admin-label">اسم المسلسل:</label>
                        <input type="text" id="seriesTitle" class="admin-input" placeholder="اسم المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">قصة المسلسل:</label>
                        <textarea id="seriesDescription" class="admin-textarea" placeholder="قصة المسلسل..."></textarea>
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">صورة المصغرة:</label>
                        <input type="text" id="seriesThumb" class="admin-input" placeholder="رابط الصورة المصغرة...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">صورة الخلفية:</label>
                        <input type="text" id="seriesBackdrop" class="admin-input" placeholder="رابط صورة الخلفية...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">تقييم المسلسل:</label>
                        <input type="number" id="seriesRating" class="admin-input" placeholder="تقييم المسلسل..." min="0" max="10" step="0.1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">نوع المسلسل:</label>
                        <input type="text" id="seriesGenre" class="admin-input" placeholder="نوع المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">عدد الحلقات:</label>
                        <input type="number" id="seriesEpisodes" class="admin-input" placeholder="عدد الحلقات..." min="1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">لغة المسلسل:</label>
                        <input type="text" id="seriesLanguage" class="admin-input" placeholder="لغة المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">دولة المسلسل:</label>
                        <input type="text" id="seriesCountry" class="admin-input" placeholder="دولة المسلسل...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">رقم الموسم:</label>
                        <input type="number" id="seriesSeason" class="admin-input" placeholder="رقم الموسم..." min="1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">حالة المسلسل:</label>
                        <select id="seriesStatus" class="admin-select">
                            <option value="new">جديد</option>
                            <option value="exclusive">حصري</option>
                            <option value="regular">عادي</option>
                        </select>
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">مميز:</label>
                        <select id="seriesFeatured" class="admin-select">
                            <option value="false">لا</option>
                            <option value="true">نعم</option>
                        </select>
                    </div>
                </div>
                <div class="btn-group">
                    <button id="saveSeries" class="admin-btn"><i class="fas fa-save"></i> حفظ المسلسل</button>
                    <button id="cancelSeries" class="admin-btn" style="background-color: #666;"><i class="fas fa-times"></i> إلغاء</button>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">قائمة المسلسلات</div>
            <div class="admin-list" id="seriesList">
                <!-- سيتم تحميل قائمة المسلسلات ديناميكيًا -->
            </div>
        </div>
        
        <!-- تبويب إدارة الحلقات -->
        <div class="admin-tab-content" id="episodesTab">
            <h3 class="admin-title">إدارة الحلقات</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">اختر مسلسل:</label>
                    <select id="episodeSeries" class="admin-select">
                        <option value="">اختر مسلسل...</option>
                        <!-- سيتم تحميل خيارات المسلسلات ديناميكيًا -->
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">رقم الحلقة:</label>
                    <input type="number" id="episodeNumber" class="admin-input" placeholder="رقم الحلقة..." min="1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">عنوان الحلقة:</label>
                    <input type="text" id="episodeTitle" class="admin-input" placeholder="عنوان الحلقة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">رابط الحلقة:</label>
                    <input type="text" id="episodeUrl" class="admin-input" placeholder="رابط الحلقة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">رابط الصورة المصغرة:</label>
                    <input type="text" id="episodeThumb" class="admin-input" placeholder="رابط الصورة المصغرة...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة الحلقة (دقائق):</label>
                    <input type="number" id="episodeDuration" class="admin-input" placeholder="مدة الحلقة..." min="1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تقييم IMDB:</label>
                    <input type="number" id="episodeImdb" class="admin-input" placeholder="تقييم IMDB..." min="0" max="10" step="0.1">
                </div>
                <div class="admin-group">
                    <label class="admin-label">رقم الموسم:</label>
                    <input type="number" id="episodeSeason" class="admin-input" placeholder="رقم الموسم..." min="1">
                </div>
            </div>
            <div class="btn-group">
                <button id="saveEpisode" class="admin-btn"><i class="fas fa-save"></i> حفظ الحلقة</button>
                <button id="closeAdmin" class="admin-btn" style="background-color: #666;"><i class="fas fa-times"></i> إغلاق اللوحة</button>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">قائمة الحلقات</div>
            <div class="admin-list" id="episodesList">
                <!-- سيتم تحميل قائمة الحلقات ديناميكيًا -->
            </div>
        </div>
        
        <!-- تبويب إدارة الأفلام -->
        <div class="admin-tab-content" id="moviesTab">
            <h3 class="admin-title">إدارة الأفلام</h3>
            <button id="addMovieBtn" class="admin-btn"><i class="fas fa-plus"></i> إضافة فيلم جديد</button>
            
            <div id="movieForm" style="display: none; margin-top: 20px;">
                <div class="admin-controls">
                    <div class="admin-group">
                        <label class="admin-label">عنوان الفيلم:</label>
                        <input type="text" id="movieTitle" class="admin-input" placeholder="عنوان الفيلم...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">قصة الفيلم:</label>
                        <textarea id="movieDescription" class="admin-textarea" placeholder="قصة الفيلم..."></textarea>
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">رابط الفيلم:</label>
                        <input type="text" id="movieUrl" class="admin-input" placeholder="رابط الفيلم...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">رابط الصورة المصغرة:</label>
                        <input type="text" id="movieThumb" class="admin-input" placeholder="رابط الصورة المصغرة...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">رابط صورة الخلفية:</label>
                        <input type="text" id="movieBackdrop" class="admin-input" placeholder="رابط صورة الخلفية...">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">مدة الفيلم (دقائق):</label>
                        <input type="number" id="movieDuration" class="admin-input" placeholder="مدة الفيلم..." min="1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">تقييم IMDB:</label>
                        <input type="number" id="movieImdb" class="admin-input" placeholder="تقييم IMDB..." min="0" max="10" step="0.1">
                    </div>
                    <div class="admin-group">
                        <label class="admin-label">مميز:</label>
                        <select id="movieFeatured" class="admin-select">
                            <option value="false">لا</option>
                            <option value="true">نعم</option>
                        </select>
                    </div>
                </div>
                <div class="btn-group">
                    <button id="saveMovie" class="admin-btn"><i class="fas fa-save"></i> حفظ الفيلم</button>
                    <button id="cancelMovie" class="admin-btn" style="background-color: #666;"><i class="fas fa-times"></i> إلغاء</button>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">قائمة الأفلام</div>
            <div class="admin-list" id="moviesList">
                <!-- سيتم تحميل قائمة الأفلام ديناميكيًا -->
            </div>
        </div>
        
        <!-- تبويب إدارة الإعلانات -->
        <div class="admin-tab-content" id="adsTab">
            <h3 class="admin-title">إدارة الإعلانات</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">مفتاح Adsterra:</label>
                    <input type="text" id="adsterraKey" class="admin-input" placeholder="أدخل مفتاح Adsterra...">
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة إعلان ما قبل التشغيل (ثواني):</label>
                    <input type="number" id="preRollDuration" class="admin-input" value="5" min="5">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تمكين الإعلانات في منتصف التشغيل:</label>
                    <select id="midRollEnabled" class="admin-select">
                        <option value="true">نعم</option>
                        <option value="false">لا</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة إعلان منتصف التشغيل (ثواني):</label>
                    <input type="number" id="midRollDuration" class="admin-input" value="10" min="5">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تمكين الإعلانات بعد التشغيل:</label>
                    <select id="postRollEnabled" class="admin-select">
                        <option value="true">نعم</option>
                        <option value="false">لا</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">مدة إعلان بعد التشغيل (ثواني):</label>
                    <input type="number" id="postRollDuration" class="admin-input" value="10" min="5">
                </div>
                <div class="admin-group">
                    <label class="admin-label">تمكين الإعلان الشريطي:</label>
                    <select id="bannerAdEnabled" class="admin-select">
                        <option value="true">نعم</option>
                        <option value="false">لا</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">سعر الألف ظهور (CPM):</label>
                    <input type="number" id="adCpm" class="admin-input" value="0.001" step="0.001" min="0">
                </div>
            </div>
            <div class="btn-group">
                <button id="saveAdsSettings" class="admin-btn"><i class="fas fa-save"></i> حفظ إعدادات الإعلانات</button>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">إحصائيات الإعلانات</div>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">إجمالي عائد الإعلانات</div>
                    <div class="stat-value">$<span id="totalAdRevenue">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إعلانات ما قبل التشغيل</div>
                    <div class="stat-value"><span id="preRollCount">0</span> مشاهدة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إعلانات منتصف التشغيل</div>
                    <div class="stat-value"><span id="midRollCount">0</span> مشاهدة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إعلانات بعد التشغيل</div>
                    <div class="stat-value"><span id="postRollCount">0</span> مشاهدة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">الإعلانات الشريطية</div>
                    <div class="stat-value"><span id="bannerAdCount">0</span> ظهور</div>
                </div>
            </div>
        </div>
        
        <!-- تبويب الإحصائيات -->
        <div class="admin-tab-content" id="statsTab">
            <h3 class="admin-title">إحصائيات المشاهدات</h3>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">إجمالي المشاهدات</div>
                    <div class="stat-value"><span id="totalViews">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إجمالي الإعجابات</div>
                    <div class="stat-value"><span id="totalLikes">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">إجمالي عدم الإعجاب</div>
                    <div class="stat-value"><span id="totalDislikes">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">الحلقات الأكثر مشاهدة</div>
                    <div class="stat-value"><span id="topEpisode">-</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">الأفلام الأكثر مشاهدة</div>
                    <div class="stat-value"><span id="topMovie">-</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">متوسط وقت المشاهدة</div>
                    <div class="stat-value"><span id="avgWatchTime">0</span> دقيقة</div>
                </div>
            </div>
        </div>
        
        <!-- تبويب إحصائيات الزوار -->
        <div class="admin-tab-content" id="visitorsTab">
            <h3 class="admin-title">إحصائيات الزوار</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">الفترة الزمنية:</label>
                    <select id="visitorsTimeRange" class="admin-select">
                        <option value="day">اليوم</option>
                        <option value="week">الأسبوع</option>
                        <option value="month">الشهر</option>
                        <option value="year">السنة</option>
                    </select>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">إجمالي الزوار</div>
                    <div class="stat-value"><span id="totalVisitors">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">زوار جدد</div>
                    <div class="stat-value"><span id="newVisitors">0</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">زوار متكررون</div>
                    <div class="stat-value"><span id="returningVisitors">0</span></div>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">مصادر الزوار</div>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">فيسبوك</div>
                    <div class="stat-value"><span id="facebookVisitors">0</span></div>
                    <div class="stat-details"><span id="facebookPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">جوجل</div>
                    <div class="stat-value"><span id="googleVisitors">0</span></div>
                    <div class="stat-details"><span id="googlePercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">يوتيوب</div>
                    <div class="stat-value"><span id="youtubeVisitors">0</span></div>
                    <div class="stat-details"><span id="youtubePercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">تيك توك</div>
                    <div class="stat-value"><span id="tiktokVisitors">0</span></div>
                    <div class="stat-details"><span id="tiktokPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">انستغرام</div>
                    <div class="stat-value"><span id="instagramVisitors">0</span></div>
                    <div class="stat-details"><span id="instagramPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">مصادر أخرى</div>
                    <div class="stat-value"><span id="otherVisitors">0</span></div>
                    <div class="stat-details"><span id="otherPercentage">0%</span> من إجمالي الزوار</div>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">أجهزة الزوار</div>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-title">هواتف</div>
                    <div class="stat-value"><span id="mobileVisitors">0</span></div>
                    <div class="stat-details"><span id="mobilePercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">حواسيب</div>
                    <div class="stat-value"><span id="desktopVisitors">0</span></div>
                    <div class="stat-details"><span id="desktopPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">أجهزة لوحية</div>
                    <div class="stat-value"><span id="tabletVisitors">0</span></div>
                    <div class="stat-details"><span id="tabletPercentage">0%</span> من إجمالي الزوار</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">تلفزيونات</div>
                    <div class="stat-value"><span id="tvVisitors">0</span></div>
                    <div class="stat-details"><span id="tvPercentage">0%</span> من إجمالي الزوار</div>
                </div>
            </div>
            
            <div class="admin-title" style="margin-top: 30px;">خريطة الزوار</div>
            <div id="visitorsMap" style="width: 100%; height: 400px; background-color: #333; border-radius: 5px; display: flex; justify-content: center; align-items: center; color: #ccc;">
                خريطة تفاعلية للزوار حسب البلدان
            </div>
        </div>
        
        <!-- تبويب الإعدادات -->
        <div class="admin-tab-content" id="settingsTab">
            <h3 class="admin-title">إعدادات النظام</h3>
            <div class="admin-controls">
                <div class="admin-group">
                    <label class="admin-label">عنوان الموقع:</label>
                    <input type="text" id="siteTitle" class="admin-input" placeholder="عنوان الموقع..." value="منصة السنافر">
                </div>
                <div class="admin-group">
                    <label class="admin-label">شعار الموقع:</label>
                    <input type="text" id="siteLogo" class="admin-input" placeholder="رابط الشعار..." value="https://via.placeholder.com/150x50?text=SMURFS+LOGO">
                </div>
                <div class="admin-group">
                    <label class="admin-label">شعار القناة:</label>
                    <input type="text" id="channelLogo" class="admin-input" placeholder="رابط شعار القناة..." value="https://via.placeholder.com/100x50?text=قناة+السنافر">
                </div>
                <div class="admin-group">
                    <label class="admin-label">لون الموقع الأساسي:</label>
                    <input type="color" id="primaryColor" class="admin-input" value="#E50914">
                </div>
                <div class="admin-group">
                    <label class="admin-label">وضع الموقع:</label>
                    <select id="siteMode" class="admin-select">
                        <option value="light">فاتح</option>
                        <option value="dark" selected>داكن</option>
                    </select>
                </div>
                <div class="admin-group">
                    <label class="admin-label">كلمة مرور الأدمن:</label>
                    <input type="password" id="adminPassword" class="admin-input" placeholder="كلمة مرور الأدمن..." value="password">
                </div>
            </div>
            <div class="btn-group">
                <button id="saveSettings" class="admin-btn"><i class="fas fa-save"></i> حفظ الإعدادات</button>
            </div>
        </div>
    </div>
    
    <!-- زر تبديل الإدارة -->
    <div class="admin-toggle" id="adminToggle">
        <i class="fas fa-cog"></i>
    </div>

    <!-- رسائل التحميل والأخطاء -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>
    
    <div class="error-message" id="errorMessage"></div>
    
    <div class="success-message" id="successMessage"></div>

    <!-- مكتبات JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
    <!-- amCharts for visitor map -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/worldHigh.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    
    <!-- تهيئة Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <script>
        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // تهيئة Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyYOUR_API_KEY",
                authDomain: "your-project.firebaseapp.com",
                projectId: "your-project",
                storageBucket: "your-project.appspot.com",
                messagingSenderId: "1234567890",
                appId: "1:1234567890:web:abcdef1234567890"
            };
            
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            
            // كائنات Firebase
            const auth = firebase.auth();
            const db = firebase.firestore();
            
            // إعدادات التطبيق
            const APP_CONFIG = {
                ADMIN_PASSWORD_HASH: "5e884898da28047151d0e56f8dc6292773603d0d6aabbdd62a11ef721d1542d8", // sha256 لـ "password"
                DEFAULT_LANGUAGE: "ar",
                SUPPORTED_LANGUAGES: ["ar", "en"],
                ADSTERRA_KEY: "", // سيتم جلبها من Firestore
                ADS_ENABLED: true,
                AD_CPM: 0.001 // دولار لكل 1000 ظهور
            };
            
            // إعدادات الإعلانات
            const AD_SETTINGS = {
                preRoll: {
                    enabled: true,
                    duration: 5, // ثواني
                    maxPerVideo: 1
                },
                midRoll: {
                    enabled: true,
                    duration: 10, // ثواني
                    interval: 1860, // ثانية (31 دقيقة)
                    maxPerVideo: 1
                },
                postRoll: {
                    enabled: true,
                    duration: 10, // ثواني
                    interval: 660, // ثانية (11 دقيقة)
                    maxPerVideo: 1
                },
                banner: {
                    enabled: true,
                    cpm: 0.001 // دولار لكل 1000 ظهور
                }
            };
            
            // حالة التطبيق
            const appState = {
                currentUser: null,
                series: [],
                episodes: [],
                movies: [],
                watchProgress: {},
                currentContent: null,
                isShowingAd: false,
                adStats: {
                    preRollShown: 0,
                    midRollShown: 0,
                    postRollShown: 0,
                    bannerShown: 0,
                    totalRevenue: 0
                }
            };
            
            // عناصر DOM
            const elements = {
                // شريط التنقل
                navLinks: document.querySelectorAll('.nav-link'),
                signInButton: document.getElementById('signInButton'),
                signOutButton: document.getElementById('signOutButton'),
                
                // الصفحات
                pages: {
                    home: document.getElementById('home-page'),
                    series: document.getElementById('series-page'),
                    movies: document.getElementById('movies-page'),
                    profile: document.getElementById('profile-page'),
                    seriesDetail: document.getElementById('series-detail-page')
                },
                
                // مشغل الفيديو
                playerSection: document.getElementById('playerSection'),
                videoPlayer: document.getElementById('videoPlayer'),
                nowPlayingInfo: document.getElementById('nowPlayingInfo'),
                nowPlayingTitle: document.getElementById('nowPlayingTitleText'),
                nowPlayingNumber: document.getElementById('nowPlayingNumber'),
                nowPlayingDuration: document.getElementById('nowPlayingDuration'),
                viewsCount: document.getElementById('viewsCount'),
                likesCount: document.getElementById('likesCount'),
                dislikesCount: document.getElementById('dislikesCount'),
                imdbRating: document.getElementById('imdbRating'),
                
                // الإعلانات
                adOverlay: document.getElementById('adOverlay'),
                adContent: document.getElementById('adContent'),
                adSkip: document.getElementById('adSkip'),
                adCountdown: document.getElementById('adCountdown'),
                
                // شريط البطل
                heroSlider: document.getElementById('heroSlider'),
                
                // الشبكات
                seriesGrid: document.getElementById('seriesGrid'),
                moviesGrid: document.getElementById('moviesGrid'),
                allSeriesGrid: document.getElementById('allSeriesGrid'),
                allMoviesGrid: document.getElementById('allMoviesGrid'),
                watchHistoryGrid: document.getElementById('watchHistoryGrid'),
                
                // الملف الشخصي
                profileName: document.getElementById('profileName'),
                profileEmail: document.getElementById('profileEmail'),
                watchedCount: document.getElementById('watchedCount'),
                favoritesCount: document.getElementById('favoritesCount'),
                watchlistCount: document.getElementById('watchlistCount'),
                
                // لوحة الإدارة
                adminPanel: document.getElementById('adminPanel'),
                adminToggle: document.getElementById('adminToggle'),
                
                // التحميل والأخطاء
                loadingOverlay: document.getElementById('loadingOverlay'),
                errorMessage: document.getElementById('errorMessage'),
                successMessage: document.getElementById('successMessage')
            };
            
            // تهيئة التطبيق
            initApp();
            
            // وظائف التطبيق الرئيسية
            function initApp() {
                // إعداد مستمعي الأحداث
                setupEventListeners();
                
                // مراقبة حالة المصادقة
                auth.onAuthStateChanged(user => {
    if (user) {
        appState.currentUser = user;
        elements.signInButton.style.display = 'none';
        elements.signOutButton.style.display = 'block';
        updateUserProfile(user);
        loadUserData(user.uid);
        
        // الكود الجديد - بداية
        db.collection('users').doc(user.uid).get()
            .then(doc => {
                if (doc.exists && doc.data().isAdmin) {
                    elements.adminToggle.style.display = 'block';
                } else {
                    elements.adminToggle.style.display = 'none';
                }
            });
        // الكود الجديد - نهاية
    } else {
        appState.currentUser = null;
        elements.signInButton.style.display = 'block';
        elements.signOutButton.style.display = 'none';
        resetUserProfile();
        elements.adminToggle.style.display = 'none'; // إضافة هذه السطر
    }
});
                
                // تحميل البيانات الأولية
                loadInitialData();
                
                // تحميل إعدادات الإعلانات
                loadAdSettings();
            }
            
            function setupEventListeners() {
                // شريط التنقل
                elements.navLinks.forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        const page = this.dataset.page;
        
        // الشرط الجديد
        if ((page === 'profile' || this.classList.contains('interaction-btn')) && !appState.currentUser) {
            showLoginModal();
            return;
        }
        
        showPage(page);
    });
});
                
                // تسجيل الدخول والخروج
                elements.signInButton.addEventListener('click', signInWithGoogle);
                elements.signOutButton.addEventListener('click', signOut);
                
                // لوحة الإدارة
                elements.adminToggle.addEventListener('click', toggleAdminPanel);
                
                // البحث
                document.querySelector('.search-box input').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchContent(this.value);
                    }
                });
                
                document.querySelector('.search-box button').addEventListener('click', function() {
                    const query = document.querySelector('.search-box input').value;
                    searchContent(query);
                });
                
                // إعداد تبويبات لوحة الإدارة
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.dataset.tab;
                        
                        // تحديث التبويب النشط
                        document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        // عرض المحتوى المناسب
                        document.querySelectorAll('.admin-tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.getElementById(`${tabId}Tab`).classList.add('active');
                        
                        // تحميل بيانات التبويب إذا لزم الأمر
                        if (tabId === 'visitors') {
                            loadVisitorStats();
                        }
                    });
                });
                
                // إدارة المسلسلات
                document.getElementById('addSeriesBtn').addEventListener('click', function() {
                    document.getElementById('seriesForm').style.display = 'block';
                });
                
                document.getElementById('cancelSeries').addEventListener('click', function() {
                    document.getElementById('seriesForm').style.display = 'none';
                });
                
                document.getElementById('saveSeries').addEventListener('click', saveSeries);
                
                // إدارة الحلقات
                document.getElementById('saveEpisode').addEventListener('click', saveEpisode);
                
                // إدارة الأفلام
                document.getElementById('addMovieBtn').addEventListener('click', function() {
                    document.getElementById('movieForm').style.display = 'block';
                });
                
                document.getElementById('cancelMovie').addEventListener('click', function() {
                    document.getElementById('movieForm').style.display = 'none';
                });
                
                document.getElementById('saveMovie').addEventListener('click', saveMovie);
                
                // إعدادات الإعلانات
                document.getElementById('saveAdsSettings').addEventListener('click', saveAdSettings);
                
                // إعدادات النظام
                document.getElementById('saveSettings').addEventListener('click', saveAppSettings);
                
                // إغلاق لوحة الإدارة
                document.getElementById('closeAdmin').addEventListener('click', function() {
                    elements.adminPanel.style.display = 'none';
                });
            }
            
            function showPage(page) {
                // إخفاء جميع الصفحات
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                
                // إزالة التنشيط من جميع روابط التنقل
                elements.navLinks.forEach(link => {
                    link.classList.remove('active');
                });
                
                // تنشيط الصفحة المطلوبة
                if (elements.pages[page]) {
                    elements.pages[page].classList.add('active');
                    document.querySelector(`.nav-link[data-page="${page}"]`).classList.add('active');
                    
                    // تحميل محتوى الصفحة إذا لزم الأمر
                    if (page === 'series') {
                        renderSeriesGrid(appState.series, elements.allSeriesGrid);
                    } else if (page === 'movies') {
                        renderMoviesGrid(appState.movies, elements.allMoviesGrid);
                    } else if (page === 'profile' && appState.currentUser) {
                        loadUserData(appState.currentUser.uid);
                    }
                }
            }
            
            function showLoginModal() {
    const modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
    modal.style.zIndex = '2000';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    
    modal.innerHTML = `
        <div style="background: #141414; padding: 30px; border-radius: 10px; max-width: 400px; width: 90%; text-align: center;">
            <h3 style="margin-bottom: 20px;">يجب تسجيل الدخول للمتابعة</h3>
            <button id="modalGoogleSignIn" class="auth-btn" style="width: 100%; padding: 15px;">
                <i class="fab fa-google"></i> تسجيل الدخول بحساب Google
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    document.getElementById('modalGoogleSignIn').addEventListener('click', signInWithGoogle);
    
    // إغلاق المودال بعد تسجيل الدخول
    auth.onAuthStateChanged(user => {
        if (user) {
            modal.remove();
            location.reload(); // إعادة تحميل الصفحة
        }
    });
}
            
            function signOut() {
                showLoading();
                auth.signOut()
                    .then(() => {
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء تسجيل الخروج: ' + error.message);
                    });
            }
            
            function updateUserProfile(user) {
                elements.profileName.textContent = user.displayName || 'مستخدم';
                elements.profileEmail.textContent = user.email || '';
                
                // تحديث صورة المستخدم إذا كانت متوفرة
                if (user.photoURL) {
                    const avatar = document.querySelector('.profile-avatar');
                    avatar.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = user.photoURL;
                    img.alt = user.displayName || 'صورة المستخدم';
                    avatar.appendChild(img);
                }
                
                // تحديث رابط الملف الشخصي في شريط التنقل
                const profileLink = document.querySelector('.nav-link[data-page="profile"]');
                if (profileLink) {
                    profileLink.innerHTML = `<i class="fas fa-user"></i> ${user.displayName || 'الملف الشخصي'}`;
                }
            }
            
            function resetUserProfile() {
                elements.profileName.textContent = 'زائر';
                elements.profileEmail.textContent = 'يجب تسجيل الدخول لعرض المعلومات';
                document.querySelector('.profile-avatar').innerHTML = '<i class="fas fa-user"></i>';
                
                // إعادة تعيين رابط الملف الشخصي في شريط التنقل
                const profileLink = document.querySelector('.nav-link[data-page="profile"]');
                if (profileLink) {
                    profileLink.innerHTML = '<i class="fas fa-user"></i> الملف الشخصي';
                }
            }
            
            function loadUserData(userId) {
                showLoading();
                
                // جلب بيانات المستخدم من Firestore
                db.collection('users').doc(userId).get()
                    .then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            
                            // جلب سجل المشاهدة
                            return db.collection('users').doc(userId).collection('watchHistory')
                                .orderBy('timestamp', 'desc')
                                .limit(10)
                                .get();
                        }
                        return null;
                    })
                    .then(snapshot => {
                        if (snapshot) {
                            const watchHistory = [];
                            snapshot.forEach(doc => {
                                watchHistory.push(doc.data());
                            });
                            
                            // عرض سجل المشاهدة
                            renderWatchHistory(watchHistory);
                            
                            // تحديث الإحصائيات
                            elements.watchedCount.textContent = watchHistory.length;
                            // يمكنك إضافة المزيد من الإحصائيات هنا
                        }
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ في تحميل بيانات المستخدم: ' + error.message);
                    });
            }

              // تبويبات الملف الشخصي
document.querySelectorAll('.profile-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabId = this.dataset.tab;
        
        // إزالة التنشيط من جميع الأزرار
        document.querySelectorAll('.profile-tab').forEach(t => t.classList.remove('active'));
        // تنشيط الزر الحالي
        this.classList.add('active');
        
        // إخفاء جميع محتويات التبويبات
        document.querySelectorAll('.profile-tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        // إظهار المحتوى المطلوب
        document.getElementById(`${tabId}Tab`).classList.add('active');
        
        // تحميل المحتوى عند النقر
        if (tabId === 'watchlater') {
            loadWatchLater();
        } else if (tabId === 'continue') {
            loadContinueWatching();
        } else if (tabId === 'favorites') {
            loadFavorites();
        }
    });
});

// دالة لتحميل قائمة "مشاهدة لاحقًا"
function loadWatchLater() {
    if (!appState.currentUser) return;
    
    db.collection('users').doc(appState.currentUser.uid).collection('watchLater')
        .get().then(snapshot => {
            const items = snapshot.docs.map(doc => doc.data());
            renderContentGrid(items, 'watchLaterGrid');
        });
}

// دالة لتحميل قائمة "استكمال المشاهدة"
function loadContinueWatching() {
    if (!appState.currentUser) return;
    
    db.collection('users').doc(appState.currentUser.uid).collection('watchHistory')
        .where('progress', '<', 100)
        .get().then(snapshot => {
            const items = snapshot.docs.map(doc => doc.data());
            renderContentGrid(items, 'continueWatchingGrid');
        });
}

// دالة لتحميل قائمة "المفضلة"
function loadFavorites() {
    if (!appState.currentUser) return;
    
    db.collection('users').doc(appState.currentUser.uid).collection('favorites')
        .get().then(snapshot => {
            const items = snapshot.docs.map(doc => doc.data());
            renderContentGrid(items, 'favoritesGrid');
        });
}

// دالة لعرض المحتوى في الشبكة
function renderContentGrid(items, elementId) {
    const grid = document.getElementById(elementId);
    grid.innerHTML = '';
    
    items.forEach(item => {
        const card = createContentCard(item, item.type || 'episode');
        grid.appendChild(card);
    });
}
        
            function loadInitialData() {
                showLoading();
                
                // جلب المسلسلات
                db.collection('series').where('featured', '==', true).limit(10).get()
                    .then(snapshot => {
                        appState.series = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        
                        // جلب الحلقات
                        return db.collection('episodes').limit(50).get();
                    })
                    .then(snapshot => {
                        appState.episodes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        
                        // جلب الأفلام
                        return db.collection('movies').where('featured', '==', true).limit(10).get();
                    })
                    .then(snapshot => {
                        appState.movies = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        
                        // عرض البيانات
                        initHeroSlider();
                        renderSeriesGrid(appState.series, elements.seriesGrid);
                        renderMoviesGrid(appState.movies, elements.moviesGrid);
                        
                        hideLoading();
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ في تحميل البيانات: ' + error.message);
                    });
            }
            
            function loadAdSettings() {
                db.collection('settings').doc('ads').get()
                    .then(doc => {
                        if (doc.exists) {
                            const settings = doc.data();
                            APP_CONFIG.ADSTERRA_KEY = settings.adsterraKey || '';
                            APP_CONFIG.ADS_ENABLED = true;
                            APP_CONFIG.AD_CPM = settings.cpm || 0.001;
                            
                            // تحديث واجهة المستخدم
                            document.getElementById('adsterraKey').value = settings.adsterraKey || '';
                            document.getElementById('preRollDuration').value = settings.preRollDuration || 5;
                            document.getElementById('midRollEnabled').value = settings.midRollEnabled ? 'true' : 'false';
                            document.getElementById('midRollDuration').value = settings.midRollDuration || 10;
                            document.getElementById('postRollEnabled').value = settings.postRollEnabled ? 'true' : 'false';
                            document.getElementById('postRollDuration').value = settings.postRollDuration || 10;
                            document.getElementById('bannerAdEnabled').value = settings.bannerAdEnabled ? 'true' : 'false';
                            document.getElementById('adCpm').value = settings.cpm || 0.001;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading ad settings:', error);
                    });
            }
            
            function initHeroSlider() {
                const featured = [...appState.series, ...appState.movies]
                    .filter(item => item.isFeatured)
                    .sort((a, b) => b.rating - a.rating)
                    .slice(0, 10);
                
                const slider = document.createElement('div');
                slider.className = 'hero-slider';
                
                featured.forEach(item => {
                    const slide = document.createElement('div');
                    slide.className = 'hero-slide';
                    slide.style.backgroundImage = `linear-gradient(to right, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%), url('${item.backdrop || item.thumb}')`;
                    
                    slide.innerHTML = `
                        <div class="slide-content">
                            <h1>${item.title}</h1>
                            <div class="slide-meta">
                                <span>${item.rating} ⭐</span>
                                <span>${item.year || ''}</span>
                                <span>${item.genre || ''}</span>
                            </div>
                            <p class="slide-description">${item.description || ''}</p>
                            <div class="slide-actions">
                                <button class="slide-play-btn" data-id="${item.id}" data-type="${item.number ? 'episode' : item.seriesId ? 'series' : 'movie'}">
                                    <i class="fas fa-play"></i> تشغيل
                                </button>
                                <button class="slide-info-btn" data-id="${item.id}" data-type="${item.number ? 'episode' : item.seriesId ? 'series' : 'movie'}">
                                    <i class="fas fa-info-circle"></i> تفاصيل
                                </button>
                            </div>
                        </div>
                    `;
                    
                    slider.appendChild(slide);
                });
                
                elements.heroSlider.innerHTML = '';
                elements.heroSlider.appendChild(slider);
                
                // تهيئة Slick Slider
                $(slider).slick({
                    dots: true,
                    infinite: true,
                    speed: 500,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    autoplay: true,
                    autoplaySpeed: 5000,
                    rtl: true,
                    arrows: true,
                    fade: true,
                    cssEase: 'linear'
                });
                
                // إضافة مستمعي الأحداث للأزرار
                document.querySelectorAll('.slide-play-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.dataset.id;
                        const type = this.dataset.type;
                        
                        if (type === 'series') {
                            const series = appState.series.find(s => s.id === id);
                            if (series) {
                                const firstEpisode = appState.episodes.find(ep => ep.seriesId === id);
                                if (firstEpisode) {
                                    playEpisode(firstEpisode);
                                }
                            }
                        } else if (type === 'movie') {
                            const movie = appState.movies.find(m => m.id === id);
                            if (movie) {
                                playMovie(movie);
                            }
                        } else if (type === 'episode') {
                            const episode = appState.episodes.find(ep => ep.id === id);
                            if (episode) {
                                playEpisode(episode);
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.slide-info-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.dataset.id;
                        const type = this.dataset.type;
                        
                        if (type === 'series') {
                            const series = appState.series.find(s => s.id === id);
                            if (series) {
                                showSeriesDetails(series);
                            }
                        } else if (type === 'movie') {
                            const movie = appState.movies.find(m => m.id === id);
                            if (movie) {
                                // يمكنك إضافة صفحة تفاصيل الأفلام هنا
                            }
                        }
                    });
                });
            }
            
            function showSeriesDetails(series) {
                // جلب حلقات المسلسل
                const seriesEpisodes = appState.episodes.filter(ep => ep.seriesId === series.id);
                
                // إنشاء صفحة تفاصيل المسلسل
                const seriesPage = document.getElementById('series-detail-page');
                seriesPage.innerHTML = `
                    <section class="series-detail">
                        <div class="series-backdrop" style="background-image: url('${series.backdrop || series.thumb}')">
                            <div class="backdrop-overlay"></div>
                            <div class="series-poster">
                                <img src="${series.thumb}" alt="${series.title}">
                                <button class="play-btn" data-series="${series.id}">
                                    <i class="fas fa-play"></i> تشغيل الحلقة 1
                                </button>
                            </div>
                            <div class="series-info">
                                <h1>${series.title}</h1>
                                <div class="series-meta">
                                    <span>${series.rating} ⭐</span>
                                    <span>${series.year || ''}</span>
                                    <span>${series.genre || ''}</span>
                                    <span>${series.season || 1} مواسم</span>
                                </div>
                                <p class="series-description">${series.description || ''}</p>
                            </div>
                        </div>
                        
                        <div class="container">
                            <div class="season-section">
                                <h2>الموسم ${series.season || 1}</h2>
                                <div class="episodes-grid" id="episodesGrid"></div>
                            </div>
                            
                            ${series.seasons && series.seasons.length > 1 ? `
                            <div class="other-seasons">
                                <h2>مواسم أخرى</h2>
                                <div class="seasons-carousel" id="seasonsCarousel"></div>
                            </div>
                            ` : ''}
                            
                            <div class="related-series">
                                <h2>مسلسلات مشابهة</h2>
                                <div class="content-grid" id="relatedSeries"></div>
                            </div>
                        </div>
                    </section>
                `;
                
                // عرض حلقات الموسم الحالي
                renderEpisodesBySeason(series.id, series.season || 1);
                
                // إعداد زر التشغيل
                document.querySelector('.series-poster .play-btn').addEventListener('click', function() {
                    const seriesId = this.dataset.series;
                    const firstEpisode = appState.episodes.find(ep => 
                        ep.seriesId === seriesId && ep.season === (series.season || 1)
                    );
                    
                    if (firstEpisode) {
                        playEpisode(firstEpisode);
                    }
                });
                
                // إخفاء جميع الصفحات وإظهار صفحة التفاصيل
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                seriesPage.style.display = 'block';
            }
            
            function renderEpisodesBySeason(seriesId, season) {
                const episodes = appState.episodes.filter(ep => 
                    ep.seriesId === seriesId && ep.season === season
                ).sort((a, b) => a.number - b.number);
                
                const grid = document.getElementById('episodesGrid');
                grid.innerHTML = '';
                
                episodes.forEach(ep => {
                    const card = createContentCard(ep, 'episode');
                    grid.appendChild(card);
                });
            }
            
            function renderSeriesGrid(series, gridElement = elements.seriesGrid) {
                gridElement.innerHTML = '';
                
                series.forEach(ser => {
                    const seriesCard = createContentCard(ser, 'series');
                    gridElement.appendChild(seriesCard);
                });
            }
            
            function renderMoviesGrid(movies, gridElement = elements.moviesGrid) {
                gridElement.innerHTML = '';
                
                movies.forEach(movie => {
                    const movieCard = createContentCard(movie, 'movie');
                    gridElement.appendChild(movieCard);
                });
            }
            
            function renderWatchHistory(items) {
                elements.watchHistoryGrid.innerHTML = '';
                
                items.forEach(item => {
                    const card = createContentCard(item, item.type || 'episode');
                    elements.watchHistoryGrid.appendChild(card);
                });
            }
            
            function createContentCard(item, type) {
                const card = document.createElement('div');
                card.className = 'content-card';
                card.dataset.id = item.id;
                card.dataset.type = type;
                
                const thumbnail = document.createElement('div');
                thumbnail.className = type === 'episode' ? 'episode-thumbnail' : 'content-thumbnail';
                thumbnail.style.backgroundImage = `url('${item.thumb}')`;
                
                const info = document.createElement('div');
                info.className = 'content-info';
                
                const title = document.createElement('div');
                title.className = 'content-title';
                title.textContent = item.title;
                
                const meta = document.createElement('div');
                meta.className = 'content-meta';
                
                if (type === 'episode') {
                    const episodeNum = document.createElement('div');
                    episodeNum.className = 'episode-number';
                    episodeNum.textContent = item.number;
                    thumbnail.appendChild(episodeNum);
                    
                    meta.innerHTML = `
                        <span>${item.duration || 24} دقيقة</span>
                        <span>•</span>
                        <span>${item.imdb || '7.5'} <i class="fas fa-star" style="color: #FFD700;"></i></span>
                    `;
                } else if (type === 'series') {
                    meta.innerHTML = `
                        <span>${item.rating || '7.5'} <i class="fas fa-star" style="color: #FFD700;"></i></span>
                        <span>•</span>
                        <span>${item.season || 1} موسم</span>
                    `;
                } else if (type === 'movie') {
                    meta.innerHTML = `
                        <span>${item.duration || 90} دقيقة</span>
                        <span>•</span>
                        <span>${item.imdb || '7.5'} <i class="fas fa-star" style="color: #FFD700;"></i></span>
                    `;
                }
                
                const freeBadge = document.createElement('div');
                freeBadge.className = 'free-badge';
                freeBadge.textContent = 'Free';
                thumbnail.appendChild(freeBadge);
                
                const stats = document.createElement('div');
                stats.className = 'content-stats';
                stats.innerHTML = `
                    <span><i class="fas fa-eye"></i> ${item.views || 0}</span>
                    <span><i class="fas fa-thumbs-up"></i> ${item.likes || 0}</span>
                `;
                
                // شريط التقدم
                const progressContainer = document.createElement('div');
                progressContainer.className = 'progress-container';
                
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.style.width = appState.watchProgress[item.id] ? `${appState.watchProgress[item.id].progress}%` : '0%';
                
                progressContainer.appendChild(progressBar);
                
                info.appendChild(title);
                info.appendChild(meta);
                info.appendChild(stats);
                info.appendChild(progressContainer);
                
                card.appendChild(thumbnail);
                card.appendChild(info);
                
                card.addEventListener('click', function() {
                    if (type === 'episode') {
                        playEpisode(item);
                    } else if (type === 'series') {
                        showSeriesDetails(item);
                    } else if (type === 'movie') {
                        playMovie(item);
                    }
                });
                
                return card;
            }
            
            function playEpisode(episode) {
                // تحديث حالة التطبيق
                appState.currentContent = {
                    type: 'episode',
                    data: episode
                };
                
                // تحديث واجهة المستخدم
                updateNowPlayingInfo(episode);
                
                // إخفاء جميع الصفحات وإظهار المشغل
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                elements.playerSection.style.display = 'block';
                elements.heroSlider.style.display = 'none';
                
                // تشغيل الحلقة
                playContent(episode.url, episode);
                
                // حفظ سجل المشاهدة إذا كان المستخدم مسجل الدخول
                if (appState.currentUser) {
                    saveWatchHistory(episode, 'episode');
                }
            }
            
            function playMovie(movie) {
                // تحديث حالة التطبيق
                appState.currentContent = {
                    type: 'movie',
                    data: movie
                };
                
                // تحديث واجهة المستخدم
                updateNowPlayingInfo(movie);
                
                // إخفاء جميع الصفحات وإظهار المشغل
                Object.values(elements.pages).forEach(page => {
                    page.classList.remove('active');
                });
                elements.playerSection.style.display = 'block';
                elements.heroSlider.style.display = 'none';
                
                // تشغيل الفيلم
                playContent(movie.url, movie);
                
                // حفظ سجل المشاهدة إذا كان المستخدم مسجل الدخول
                if (appState.currentUser) {
                    saveWatchHistory(movie, 'movie');
                }
            }
            
            function playContent(url, content) {
                // إعداد رابط الفيديو
                let videoUrl = url;
                const startTime = appState.watchProgress[content.id] ? Math.floor(appState.watchProgress[content.id].time) : 0;
                
                if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
                    const videoId = extractYouTubeId(videoUrl);
                    if (videoId) {
                        videoUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&start=${startTime}`;
                    }
                } else if (videoUrl.includes('vimeo.com')) {
                    const videoId = videoUrl.split('/').pop();
                    videoUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
                }
                
                elements.videoPlayer.src = videoUrl;
                
                // إظهار إعلان ما قبل التشغيل إذا لزم الأمر
                if (APP_CONFIG.ADS_ENABLED && AD_SETTINGS.preRoll.enabled) {
                    showAd('pre-roll', AD_SETTINGS.preRoll.duration);
                } else {
                    elements.nowPlayingInfo.style.display = 'block';
                }
                
                // بدء تتبع التقدم
                trackProgress(content);
            }
            
            function updateNowPlayingInfo(content) {
                elements.nowPlayingTitle.textContent = content.title;
                elements.nowPlayingNumber.textContent = content.number ? `الحلقة ${content.number}` : '';
                elements.nowPlayingDuration.textContent = content.duration ? `${content.duration} دقيقة` : '';
                elements.viewsCount.textContent = content.views || 0;
                elements.likesCount.textContent = content.likes || 0;
                elements.dislikesCount.textContent = content.dislikes || 0;
                elements.imdbRating.textContent = content.imdb || '7.5';
                
                elements.nowPlayingInfo.style.display = 'block';
                
                // إعداد أزرار التفاعل
                setupInteractionButtons(content);
            }
            
            function setupInteractionButtons(content) {
                elements.likesStat.onclick = function() {
                    content.likes = (content.likes || 0) + 1;
                    updateNowPlayingInfo(content);
                    saveContentInteraction(content, 'like');
                };
                
                elements.dislikesStat.onclick = function() {
                    content.dislikes = (content.dislikes || 0) + 1;
                    updateNowPlayingInfo(content);
                    saveContentInteraction(content, 'dislike');
                };
            }
            
            function trackProgress(content) {
                // في تطبيق حقيقي، ستحتاج إلى استخدام واجهة برمجة تطبيقات مشغل الفيديو
                // لتتبع التقدم الفعلي للمشاهدة
                
                // هذا مثال مبسط يستخدم مؤقتًا
                const duration = content.duration ? content.duration * 60 : 600; // تحويل الدقائق إلى ثواني
                let progress = appState.watchProgress[content.id]?.progress || 0;
                let lastMidRollTime = 0;
                let lastPostRollTime = 0;
                
                const progressInterval = setInterval(() => {
                    progress = Math.min(progress + 0.5, 100);
                    const currentTime = (progress / 100) * duration;
                    
                    appState.watchProgress[content.id] = {
                        progress: progress,
                        time: currentTime,
                        timestamp: new Date().getTime()
                    };
                    
                    // تحديث شريط التقدم
                    const selector = `[data-id="${content.id}"] .progress-bar`;
                    const progressBar = document.querySelector(selector);
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                    
                    // إظهار إعلان منتصف التشغيل إذا لزم الأمر
                    if (APP_CONFIG.ADS_ENABLED && AD_SETTINGS.midRoll.enabled && 
                        currentTime - lastMidRollTime >= AD_SETTINGS.midRoll.interval && 
                        !content.midRollShown) {
                        showAd('mid-roll', AD_SETTINGS.midRoll.duration);
                        content.midRollShown = true;
                        lastMidRollTime = currentTime;
                    }
                    
                    // إظهار إعلان نهاية التشغيل إذا لزم الأمر
                    if (APP_CONFIG.ADS_ENABLED && AD_SETTINGS.postRoll.enabled && 
                        currentTime - lastPostRollTime >= AD_SETTINGS.postRoll.interval && 
                        !content.postRollShown) {
                        showAd('post-roll', AD_SETTINGS.postRoll.duration);
                        content.postRollShown = true;
                        lastPostRollTime = currentTime;
                    }
                    
                    if (progress >= 100) {
                        clearInterval(progressInterval);
                    }
                }, 3000);
            }
            
            function showAd(adType, duration) {
                if (!APP_CONFIG.ADS_ENABLED) return;
                
                appState.isShowingAd = true;
                elements.adOverlay.style.display = 'flex';
                elements.adSkip.style.display = 'flex';
                elements.nowPlayingInfo.style.display = 'none';
                
                elements.adCountdown.textContent = `الإعلان ينتهي بعد ${duration} ثواني`;
                
                let seconds = duration;
                const adTimer = setInterval(() => {
                    seconds--;
                    elements.adCountdown.textContent = `الإعلان ينتهي بعد ${seconds} ثواني`;
                    
                    if (seconds <= 0) {
                        clearInterval(adTimer);
                        hideAd();
                    }
                }, 1000);
                
                // زر تخطي الإعلان
                elements.adSkip.onclick = function() {
                    clearInterval(adTimer);
                    hideAd();
                };
                
                // تحميل الإعلان
                loadAd(adType);
                
                // تحديث إحصائيات الإعلانات
                if (adType === 'pre-roll') {
                    appState.adStats.preRollShown++;
                } else if (adType === 'mid-roll') {
                    appState.adStats.midRollShown++;
                } else if (adType === 'post-roll') {
                    appState.adStats.postRollShown++;
                }
                
                // حساب الإيرادات
                appState.adStats.totalRevenue = (
                    (appState.adStats.preRollShown + 
                     appState.adStats.midRollShown + 
                     appState.adStats.postRollShown) * APP_CONFIG.AD_CPM
                ) / 1000;
                
                // حفظ إحصائيات الإعلانات
                saveAdStats();
            }
            
            function hideAd() {
                appState.isShowingAd = false;
                elements.adOverlay.style.display = 'none';
                elements.nowPlayingInfo.style.display = 'block';
            }
            
            function loadAd(adType) {
                // في تطبيق حقيقي، ستقوم بتحميل إعلان حقيقي هنا
                elements.adContent.innerHTML = `
                    <div style="color:white; font-size:1.5rem; text-align:center; width:100%; height:100%; display:flex; justify-content:center; align-items:center;">
                        <div>
                            <div style="margin-bottom:20px;">إعلان ${adType === 'pre-roll' ? 'ما قبل التشغيل' : adType === 'mid-roll' ? 'منتصف التشغيل' : 'بعد التشغيل'}</div>
                            <div style="font-size:0.8rem; color:#aaa;">هذا مكان إعلان Adsterra</div>
                        </div>
                    </div>
                `;
            }
            
            function saveAdStats() {
                db.collection('stats').doc('ads').set({
                    preRollCount: appState.adStats.preRollShown,
                    midRollCount: appState.adStats.midRollShown,
                    postRollCount: appState.adStats.postRollShown,
                    bannerAdCount: appState.adStats.bannerShown,
                    totalRevenue: appState.adStats.totalRevenue,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true })
                .catch(error => {
                    console.error('Error saving ad stats:', error);
                });
            }
            
            function searchContent(query) {
                if (!query.trim()) return;
                
                showLoading();
                
                // البحث في المسلسلات
                const seriesResults = appState.series.filter(s => 
                    s.title.toLowerCase().includes(query.toLowerCase()) || 
                    (s.description && s.description.toLowerCase().includes(query.toLowerCase()))
                );
                
                // البحث في الأفلام
                const movieResults = appState.movies.filter(m => 
                    m.title.toLowerCase().includes(query.toLowerCase()) || 
                    (m.description && m.description.toLowerCase().includes(query.toLowerCase()))
                );
                
                // عرض النتائج
                if (seriesResults.length > 0 || movieResults.length > 0) {
                    // يمكنك إنشاء صفحة نتائج بحث مخصصة أو عرض النتائج في صفحة موجودة
                    // هذا مثال مبسط يعرض النتائج في صفحة المسلسلات
                    elements.allSeriesGrid.innerHTML = '';
                    
                    seriesResults.forEach(ser => {
                        const seriesCard = createContentCard(ser, 'series');
                        elements.allSeriesGrid.appendChild(seriesCard);
                    });
                    
                    movieResults.forEach(movie => {
                        const movieCard = createContentCard(movie, 'movie');
                        elements.allSeriesGrid.appendChild(movieCard);
                    });
                    
                    showPage('series');
                } else {
                    showError('لا توجد نتائج مطابقة للبحث');
                }
                
                hideLoading();
            }
            
            function saveWatchHistory(content, type) {
                if (!appState.currentUser) return;
                
                db.collection('users').doc(appState.currentUser.uid).collection('watchHistory').add({
                    contentId: content.id,
                    title: content.title,
                    thumb: content.thumb,
                    type: type,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        progress: appState.watchProgress[content.id]?.progress || 0,
                        duration: content.duration || (type === 'movie' ? 90 : 24)
                    })
                    .then(() => {
                        // تحديث عدد المشاهدات للمحتوى
                        if (type === 'episode') {
                            return db.collection('episodes').doc(content.id).update({
                                views: firebase.firestore.FieldValue.increment(1),
                                lastWatched: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        } else if (type === 'movie') {
                            return db.collection('movies').doc(content.id).update({
                                views: firebase.firestore.FieldValue.increment(1),
                                lastWatched: firebase.firestore.FieldValue.serverTimestamp()
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error saving watch history:', error);
                    });
            }
            
            function saveContentInteraction(content, interactionType) {
                if (!appState.currentUser) return;
                
                const updateData = {};
                if (interactionType === 'like') {
                    updateData.likes = firebase.firestore.FieldValue.increment(1);
                } else if (interactionType === 'dislike') {
                    updateData.dislikes = firebase.firestore.FieldValue.increment(1);
                }
                
                let collectionName = '';
                if (content.seriesId) {
                    collectionName = 'episodes';
                } else if (content.number) {
                    collectionName = 'episodes';
                } else {
                    collectionName = 'movies';
                }
                
                db.collection(collectionName).doc(content.id).update(updateData)
                    .catch(error => {
                        console.error('Error saving interaction:', error);
                    });
            }
            
            function extractYouTubeId(url) {
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[2].length === 11) ? match[2] : null;
            }
            
            function toggleAdminPanel() {
    if (!appState.currentUser) {
        showLoginModal();
        return;
    }

    // التحقق من صلاحية المستخدم في Firestore
    db.collection('users').doc(appState.currentUser.uid).get()
        .then(doc => {
            if (doc.exists && doc.data().isAdmin) {
                elements.adminPanel.style.display = elements.adminPanel.style.display === 'block' ? 'none' : 'block';
                if (elements.adminPanel.style.display === 'block') {
                    loadAdminData();
                }
            } else {
                showError('ليس لديك صلاحية الدخول إلى لوحة التحكم');
            }
        });
}
            
            function loadAdminData() {
                // جلب أحدث الإحصائيات
                db.collection('stats').doc('views').get()
                    .then(doc => {
                        if (doc.exists) {
                            const stats = doc.data();
                            document.getElementById('totalViews').textContent = stats.totalViews || 0;
                            document.getElementById('totalLikes').textContent = stats.totalLikes || 0;
                            document.getElementById('totalDislikes').textContent = stats.totalDislikes || 0;
                            document.getElementById('topEpisode').textContent = stats.topEpisode || '-';
                            document.getElementById('topMovie').textContent = stats.topMovie || '-';
                            document.getElementById('avgWatchTime').textContent = stats.avgWatchTime || 0;
                        }
                    });
                
                // جلب إحصائيات الإعلانات
                db.collection('stats').doc('ads').get()
                    .then(doc => {
                        if (doc.exists) {
                            const stats = doc.data();
                            document.getElementById('totalAdRevenue').textContent = stats.totalRevenue?.toFixed(2) || '0';
                            document.getElementById('preRollCount').textContent = stats.preRollCount || 0;
                            document.getElementById('midRollCount').textContent = stats.midRollCount || 0;
                            document.getElementById('postRollCount').textContent = stats.postRollCount || 0;
                            document.getElementById('bannerAdCount').textContent = stats.bannerAdCount || 0;
                        }
                    });
                
                // جلب قائمة المسلسلات
                db.collection('series').orderBy('title').get()
                    .then(snapshot => {
                        const seriesList = document.getElementById('seriesList');
                        seriesList.innerHTML = '';
                        
                        snapshot.forEach(doc => {
                            const series = doc.data();
                            const item = createAdminListItem(series, doc.id, 'series');
                            seriesList.appendChild(item);
                        });
                    });
                
                // جلب قائمة الأفلام
                db.collection('movies').orderBy('title').get()
                    .then(snapshot => {
                        const moviesList = document.getElementById('moviesList');
                        moviesList.innerHTML = '';
                        
                        snapshot.forEach(doc => {
                            const movie = doc.data();
                            const item = createAdminListItem(movie, doc.id, 'movie');
                            moviesList.appendChild(item);
                        });
                    });
                
                // جلب خيارات المسلسلات للحلقات
                db.collection('series').orderBy('title').get()
                    .then(snapshot => {
                        const select = document.getElementById('episodeSeries');
                        select.innerHTML = '<option value="">اختر مسلسل...</option>';
                        
                        snapshot.forEach(doc => {
                            const option = document.createElement('option');
                            option.value = doc.id;
                            option.textContent = doc.data().title;
                            select.appendChild(option);
                        });
                    });
                
                // جلب قائمة الحلقات
                loadEpisodesList();
            }
            
            function loadEpisodesList() {
                db.collection('episodes').orderBy('seriesId').orderBy('season').orderBy('number').get()
                    .then(snapshot => {
                        const episodesList = document.getElementById('episodesList');
                        episodesList.innerHTML = '';
                        
                        snapshot.forEach(doc => {
                            const episode = doc.data();
                            const item = createAdminListItem(episode, doc.id, 'episode');
                            episodesList.appendChild(item);
                        });
                    });
            }
            
            function createAdminListItem(item, id, type) {
                const listItem = document.createElement('div');
                listItem.className = 'admin-list-item';
                
                const infoDiv = document.createElement('div');
                infoDiv.className = 'admin-item-info';
                
                const thumbImg = document.createElement('img');
                thumbImg.className = 'admin-item-thumb';
                thumbImg.src = item.thumb || 'https://via.placeholder.com/80x120?text=No+Image';
                thumbImg.alt = item.title;
                
                const detailsDiv = document.createElement('div');
                detailsDiv.innerHTML = `
                    <div style="font-weight: bold;">${item.title}</div>
                    <div style="font-size: 0.8rem; color: #ccc; margin-top: 5px;">
                        ${type === 'episode' ? `الحلقة ${item.number} - الموسم ${item.season}` : ''}
                        ${type === 'movie' ? `فيلم - ${item.duration || 90} دقيقة` : ''}
                        ${type === 'series' ? `مسلسل - ${item.season || 1} مواسم` : ''}
                    </div>
                    <div style="font-size: 0.8rem; color: #ccc; margin-top: 5px;">
                        المشاهدات: ${item.views || 0} | الإعجابات: ${item.likes || 0}
                    </div>
                `;
                
                infoDiv.appendChild(thumbImg);
                infoDiv.appendChild(detailsDiv);
                
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'admin-item-actions';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'admin-btn edit-btn';
                editBtn.innerHTML = '<i class="fas fa-edit"></i> تعديل';
                editBtn.onclick = () => editItem(id, type);
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'admin-btn delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i> حذف';
                deleteBtn.onclick = () => deleteItem(id, type);
                
                actionsDiv.appendChild(editBtn);
                actionsDiv.appendChild(deleteBtn);
                
                listItem.appendChild(infoDiv);
                listItem.appendChild(actionsDiv);
                
                return listItem;
            }
            
            function editItem(id, type) {
                if (type === 'series') {
                    // تحميل بيانات المسلسل في النموذج
                    db.collection('series').doc(id).get()
                        .then(doc => {
                            if (doc.exists) {
                                const series = doc.data();
                                document.getElementById('seriesTitle').value = series.title;
                                document.getElementById('seriesDescription').value = series.description || '';
                                document.getElementById('seriesThumb').value = series.thumb || '';
                                document.getElementById('seriesBackdrop').value = series.backdrop || '';
                                document.getElementById('seriesRating').value = series.rating || '';
                                document.getElementById('seriesGenre').value = series.genre || '';
                                document.getElementById('seriesEpisodes').value = series.episodes || '';
                                document.getElementById('seriesLanguage').value = series.language || '';
                                document.getElementById('seriesCountry').value = series.country || '';
                                document.getElementById('seriesSeason').value = series.season || 1;
                                document.getElementById('seriesStatus').value = series.status || 'new';
                                document.getElementById('seriesFeatured').value = series.featured ? 'true' : 'false';
                                
                                document.getElementById('seriesForm').style.display = 'block';
                                document.getElementById('saveSeries').dataset.id = id;
                            }
                        });
                } else if (type === 'episode') {
                    // تحميل بيانات الحلقة في النموذج
                    db.collection('episodes').doc(id).get()
                        .then(doc => {
                            if (doc.exists) {
                                const episode = doc.data();
                                document.getElementById('episodeSeries').value = episode.seriesId;
                                document.getElementById('episodeNumber').value = episode.number;
                                document.getElementById('episodeTitle').value = episode.title;
                                document.getElementById('episodeUrl').value = episode.url;
                                document.getElementById('episodeThumb').value = episode.thumb;
                                document.getElementById('episodeDuration').value = episode.duration;
                                document.getElementById('episodeImdb').value = episode.imdb;
                                document.getElementById('episodeSeason').value = episode.season;
                                
                                document.getElementById('saveEpisode').dataset.id = id;
                            }
                        });
                } else if (type === 'movie') {
                    // تحميل بيانات الفيلم في النموذج
                    db.collection('movies').doc(id).get()
                        .then(doc => {
                            if (doc.exists) {
                                const movie = doc.data();
                                document.getElementById('movieTitle').value = movie.title;
                                document.getElementById('movieDescription').value = movie.description || '';
                                document.getElementById('movieUrl').value = movie.url || '';
                                document.getElementById('movieThumb').value = movie.thumb || '';
                                document.getElementById('movieBackdrop').value = movie.backdrop || '';
                                document.getElementById('movieDuration').value = movie.duration || '';
                                document.getElementById('movieImdb').value = movie.imdb || '';
                                document.getElementById('movieFeatured').value = movie.featured ? 'true' : 'false';
                                
                                document.getElementById('movieForm').style.display = 'block';
                                document.getElementById('saveMovie').dataset.id = id;
                            }
                        });
                }
            }
            
            function deleteItem(id, type) {
                if (confirm('هل أنت متأكد من حذف هذا العنصر؟ لا يمكن التراجع عن هذه العملية.')) {
                    showLoading();
                    
                    let collectionName = '';
                    if (type === 'series') {
                        collectionName = 'series';
                    } else if (type === 'episode') {
                        collectionName = 'episodes';
                    } else if (type === 'movie') {
                        collectionName = 'movies';
                    }
                    
                    db.collection(collectionName).doc(id).delete()
                        .then(() => {
                            hideLoading();
                            showSuccess('تم حذف العنصر بنجاح');
                            loadAdminData(); // تحديث القائمة
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء حذف العنصر: ' + error.message);
                        });
                }
            }
            
            function saveSeries() {
                const id = this.dataset.id;
                const seriesData = {
                    title: document.getElementById('seriesTitle').value,
                    description: document.getElementById('seriesDescription').value,
                    thumb: document.getElementById('seriesThumb').value,
                    backdrop: document.getElementById('seriesBackdrop').value,
                    rating: parseFloat(document.getElementById('seriesRating').value) || 0,
                    genre: document.getElementById('seriesGenre').value,
                    episodes: parseInt(document.getElementById('seriesEpisodes').value) || 0,
                    language: document.getElementById('seriesLanguage').value,
           country: document.getElementById('seriesCountry').value,
                    season: parseInt(document.getElementById('seriesSeason').value) || 1,
                    status: document.getElementById('seriesStatus').value,
                    featured: document.getElementById('seriesFeatured').value === 'true',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading();
                
                if (id) {
                    // تحديث مسلسل موجود
                    db.collection('series').doc(id).update(seriesData)
                        .then(() => {
                            hideLoading();
                            showSuccess('تم تحديث المسلسل بنجاح');
                            document.getElementById('seriesForm').style.display = 'none';
                            loadAdminData(); // تحديث القائمة
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء تحديث المسلسل: ' + error.message);
                        });
                } else {
                    // إضافة مسلسل جديد
                    seriesData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    seriesData.views = 0;
                    seriesData.likes = 0;
                    seriesData.dislikes = 0;
                    
                    db.collection('series').add(seriesData)
                        .then(() => {
                            hideLoading();
                            showSuccess('تم إضافة المسلسل بنجاح');
                            document.getElementById('seriesForm').style.display = 'none';
                            loadAdminData(); // تحديث القائمة
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء إضافة المسلسل: ' + error.message);
                        });
                }
            }
            
            function saveEpisode() {
                const id = this.dataset.id;
                const episodeData = {
                    seriesId: document.getElementById('episodeSeries').value,
                    number: parseInt(document.getElementById('episodeNumber').value) || 1,
                    title: document.getElementById('episodeTitle').value,
                    url: document.getElementById('episodeUrl').value,
                    thumb: document.getElementById('episodeThumb').value,
                    duration: parseInt(document.getElementById('episodeDuration').value) || 24,
                    imdb: parseFloat(document.getElementById('episodeImdb').value) || 0,
                    season: parseInt(document.getElementById('episodeSeason').value) || 1,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                if (!episodeData.seriesId) {
                    showError('يجب اختيار مسلسل للحلقة');
                    return;
                }
                
                showLoading();
                
                if (id) {
                    // تحديث حلقة موجودة
                    db.collection('episodes').doc(id).update(episodeData)
                        .then(() => {
                            hideLoading();
                            showSuccess('تم تحديث الحلقة بنجاح');
                            loadEpisodesList(); // تحديث قائمة الحلقات
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء تحديث الحلقة: ' + error.message);
                        });
                } else {
                    // إضافة حلقة جديدة
                    episodeData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    episodeData.views = 0;
                    episodeData.likes = 0;
                    episodeData.dislikes = 0;
                    
                    db.collection('episodes').add(episodeData)
                        .then(() => {
                            hideLoading();
                            showSuccess('تم إضافة الحلقة بنجاح');
                            loadEpisodesList(); // تحديث قائمة الحلقات
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء إضافة الحلقة: ' + error.message);
                        });
                }
            }
            
            function saveMovie() {
                const id = this.dataset.id;
                const movieData = {
                    title: document.getElementById('movieTitle').value,
                    description: document.getElementById('movieDescription').value,
                    url: document.getElementById('movieUrl').value,
                    thumb: document.getElementById('movieThumb').value,
                    backdrop: document.getElementById('movieBackdrop').value,
                    duration: parseInt(document.getElementById('movieDuration').value) || 90,
                    imdb: parseFloat(document.getElementById('movieImdb').value) || 0,
                    featured: document.getElementById('movieFeatured').value === 'true',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading();
                
                if (id) {
                    // تحديث فيلم موجود
                    db.collection('movies').doc(id).update(movieData)
                        .then(() => {
                            hideLoading();
                            showSuccess('تم تحديث الفيلم بنجاح');
                            document.getElementById('movieForm').style.display = 'none';
                            loadAdminData(); // تحديث القائمة
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء تحديث الفيلم: ' + error.message);
                        });
                } else {
                    // إضافة فيلم جديد
                    movieData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    movieData.views = 0;
                    movieData.likes = 0;
                    movieData.dislikes = 0;
                    
                    db.collection('movies').add(movieData)
                        .then(() => {
                            hideLoading();
                            showSuccess('تم إضافة الفيلم بنجاح');
                            document.getElementById('movieForm').style.display = 'none';
                            loadAdminData(); // تحديث القائمة
                        })
                        .catch(error => {
                            hideLoading();
                            showError('حدث خطأ أثناء إضافة الفيلم: ' + error.message);
                        });
                }
            }
            
            function saveAdSettings() {
                const settings = {
                    adsterraKey: document.getElementById('adsterraKey').value,
                    preRollDuration: parseInt(document.getElementById('preRollDuration').value) || 5,
                    midRollEnabled: document.getElementById('midRollEnabled').value === 'true',
                    midRollDuration: parseInt(document.getElementById('midRollDuration').value) || 10,
                    postRollEnabled: document.getElementById('postRollEnabled').value === 'true',
                    postRollDuration: parseInt(document.getElementById('postRollDuration').value) || 10,
                    bannerAdEnabled: document.getElementById('bannerAdEnabled').value === 'true',
                    cpm: parseFloat(document.getElementById('adCpm').value) || 0.001,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading();
                
                db.collection('settings').doc('ads').set(settings, { merge: true })
                    .then(() => {
                        hideLoading();
                        showSuccess('تم حفظ إعدادات الإعلانات بنجاح');
                        
                        // تحديث إعدادات التطبيق
                        APP_CONFIG.ADSTERRA_KEY = settings.adsterraKey;
                        APP_CONFIG.AD_CPM = settings.cpm;
                        AD_SETTINGS.preRoll.enabled = true;
                        AD_SETTINGS.preRoll.duration = settings.preRollDuration;
                        AD_SETTINGS.midRoll.enabled = settings.midRollEnabled;
                        AD_SETTINGS.midRoll.duration = settings.midRollDuration;
                        AD_SETTINGS.postRoll.enabled = settings.postRollEnabled;
                        AD_SETTINGS.postRoll.duration = settings.postRollDuration;
                        AD_SETTINGS.banner.enabled = settings.bannerAdEnabled;
                        AD_SETTINGS.banner.cpm = settings.cpm;
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء حفظ إعدادات الإعلانات: ' + error.message);
                    });
            }
            
            function saveAppSettings() {
                const settings = {
                    siteTitle: document.getElementById('siteTitle').value,
                    siteLogo: document.getElementById('siteLogo').value,
                    channelLogo: document.getElementById('channelLogo').value,
                    primaryColor: document.getElementById('primaryColor').value,
                    siteMode: document.getElementById('siteMode').value,
                    adminPassword: sha256(document.getElementById('adminPassword').value),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                showLoading();
                
                db.collection('settings').doc('app').set(settings, { merge: true })
                    .then(() => {
                        hideLoading();
                        showSuccess('تم حفظ إعدادات النظام بنجاح');
                        
                        // تحديث إعدادات التطبيق
                        APP_CONFIG.ADMIN_PASSWORD_HASH = settings.adminPassword;
                        
                        // تطبيق التغييرات الفورية
                        document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
                        
                        if (settings.siteMode === 'light') {
                            document.body.classList.add('light-mode');
                        } else {
                            document.body.classList.remove('light-mode');
                        }
                        
                        // تحديث الشعار
                        document.querySelector('.logo-img').src = settings.siteLogo;
                        document.querySelector('.channel-logo').src = settings.channelLogo;
                    })
                    .catch(error => {
                        hideLoading();
                        showError('حدث خطأ أثناء حفظ إعدادات النظام: ' + error.message);
                    });
            }
            
            function loadVisitorStats() {
                // هذه وظيفة تجميلية فقط في هذا المثال
                // في تطبيق حقيقي، ستقوم بجلب البيانات من Firebase أو خدمة التحليلات
                
                // إحصائيات الزوار
                document.getElementById('totalVisitors').textContent = '1,245';
                document.getElementById('newVisitors').textContent = '856';
                document.getElementById('returningVisitors').textContent = '389';
                
                // مصادر الزوار
                document.getElementById('facebookVisitors').textContent = '420';
                document.getElementById('facebookPercentage').textContent = '34%';
                document.getElementById('googleVisitors').textContent = '380';
                document.getElementById('googlePercentage').textContent = '31%';
                document.getElementById('youtubeVisitors').textContent = '210';
                document.getElementById('youtubePercentage').textContent = '17%';
                document.getElementById('tiktokVisitors').textContent = '120';
                document.getElementById('tiktokPercentage').textContent = '10%';
                document.getElementById('instagramVisitors').textContent = '85';
                document.getElementById('instagramPercentage').textContent = '7%';
                document.getElementById('otherVisitors').textContent = '30';
                document.getElementById('otherPercentage').textContent = '2%';
                
                // أجهزة الزوار
                document.getElementById('mobileVisitors').textContent = '720';
                document.getElementById('mobilePercentage').textContent = '58%';
                document.getElementById('desktopVisitors').textContent = '380';
                document.getElementById('desktopPercentage').textContent = '31%';
                document.getElementById('tabletVisitors').textContent = '120';
                document.getElementById('tabletPercentage').textContent = '10%';
                document.getElementById('tvVisitors').textContent = '25';
                document.getElementById('tvPercentage').textContent = '2%';
                
                // تهيئة خريطة الزوار (amCharts)
                initVisitorMap();
            }
            
            function initVisitorMap() {
                // هذا مثال تجميلي فقط
                // في تطبيق حقيقي، ستستخدم amCharts لعرض بيانات حقيقية
                const mapElement = document.getElementById('visitorsMap');
                mapElement.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 1.2rem; margin-bottom: 10px;">خريطة تفاعلية للزوار حسب البلدان</div>
                        <div style="font-size: 0.9rem; color: #aaa;">
                            هذه خريطة تجميلية توضح توزيع الزوار حسب البلدان<br>
                            في تطبيق حقيقي، ستستخدم مكتبة amCharts لعرض البيانات الفعلية
                        </div>
                    </div>
                `;
            }
            
            function showLoading() {
                elements.loadingOverlay.style.display = 'flex';
            }
            
            function hideLoading() {
                elements.loadingOverlay.style.display = 'none';
            }
            
            function showError(message) {
                elements.errorMessage.textContent = message;
                elements.errorMessage.style.display = 'block';
                
                setTimeout(() => {
                    elements.errorMessage.style.display = 'none';
                }, 5000);
            }
            
            function showSuccess(message) {
                elements.successMessage.textContent = message;
                elements.successMessage.style.display = 'block';
                
                setTimeout(() => {
                    elements.successMessage.style.display = 'none';
                }, 5000);
            }
        });
    </script>
</body>
</html> 
